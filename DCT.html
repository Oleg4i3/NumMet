<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCT Visualizer + Audio</title>
    <style>
        :root {
            --bg: #121212;
            --panel: #1e1e1e;
            --accent: #00bcd4; /* Cyan for Frequency */
            --signal: #ffffff;
            --product-pos: #4caf50; /* Green */
            --product-neg: #f44336; /* Red */
            --text: #e0e0e0;
            --grid: #333;
            --active-play: #ffeb3b; /* Yellow for play state */
        }

        body {
            font-family: 'Segoe UI', Consolas, monospace;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1, h2, h3 { margin: 0 0 10px 0; font-weight: 300; }
        h1 { color: var(--accent); text-align: center; }
        p { color: #aaa; max-width: 900px; text-align: center; margin-bottom: 20px; }

        /* Layout */
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            max-width: 1200px;
            width: 100%;
        }

        .panel {
            background: var(--panel);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .full-width { grid-column: span 2; }

        /* Canvas */
        canvas {
            background: #000;
            border-radius: 4px;
            width: 100%;
            cursor: crosshair;
            display: block;
        }
        
        .spectrum-canvas { cursor: pointer; } 

        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
            background: #252525;
            padding: 10px;
            border-radius: 8px;
        }

        button, select {
            background: #37474f;
            color: white;
            border: 1px solid #555;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            transition: 0.2s;
        }

        button:hover { background: #455a64; border-color: var(--accent); }
        button.active { background: var(--accent); color: black; font-weight: bold; }
        
        /* Audio Button Specifics */
        button.audio-on {
            background: var(--active-play);
            color: black;
            font-weight: bold;
            border-color: #fff;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 235, 59, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 235, 59, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 235, 59, 0); }
        }

        /* Legend & Info */
        .legend {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            margin-bottom: 5px;
            color: #bbb;
        }
        .dot { width: 10px; height: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }

        .math-block {
            background: #000;
            padding: 10px;
            border-left: 4px solid var(--accent);
            font-family: 'Courier New', monospace;
            margin-top: 10px;
            color: #81d4fa;
            font-size: 0.9rem;
        }

        /* Analysis Grid inside the bottom panel */
        .analysis-layout {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 10px;
        }
        .sum-box {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #2a2a2a;
            border-radius: 6px;
            text-align: center;
        }
        .big-number { font-size: 1.8rem; font-weight: bold; margin: 10px 0; }
        .pos-val { color: var(--product-pos); }
        .neg-val { color: var(--product-neg); }

        @media (max-width: 800px) {
            .container { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
            .analysis-layout { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <h1>–î–∏—Å–∫—Ä–µ—Ç–Ω–µ –∫–æ—Å–∏–Ω—É—Å–Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è (DCT)</h1>
    <p>
        –ú—ñ–Ω—è–π—Ç–µ –≥—Ä–∞—Ñ—ñ–∫ —ñ <b>—Å–ª—É—Ö–∞–π—Ç–µ</b> —Å–ø–µ–∫—Ç—Ä! 1-—à–∞ –≥–∞—Ä–º–æ–Ω—ñ–∫–∞ = 110–ì—Ü (–ë–∞—Å).<br>
        –î–∏—Å–∫—Ä–µ—Ç–Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è ‚Äî —Ü–µ —Ä–æ–∑–∫–ª–∞–¥–∞–Ω–Ω—è –∑–≤—É–∫—É –Ω–∞ —á–∏—Å—Ç—ñ —Ç–æ–Ω–∏.
    </p>

</details>
   <details style="background: #1a1a1a; border: 1px solid #333; border-radius: 8px; margin: 20px 0; width: 100%; max-width: 800px; overflow: hidden;">
    <summary style="padding: 15px; cursor: pointer; background: #222; font-weight: bold; color: #00E5FF; user-select: none;">
        –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞
    </summary>
    
    <div style="padding: 20px; line-height: 1.6; color: #ddd; font-family: 'Segoe UI', sans-serif;">
        <style>
            /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥ MathJax/LaTeX */
            .math-font { font-family: 'Times New Roman', Times, serif; font-size: 1.1em; }
            .math-var { font-style: italic; }
            .math-vec { font-weight: bold; font-style: italic; }
            .math-block { 
                display: block; 
                background: #111; 
                padding: 15px; 
                border-radius: 4px; 
                text-align: center; 
                margin: 10px 0; 
                border-left: 3px solid #4CAF50;
                font-family: 'Times New Roman', serif;
                font-size: 1.2em;
            }
            .sum-symbol { font-size: 1.2em; position: relative; top: 2px; }
            .sub { font-size: 0.7em; vertical-align: sub; margin-left: 1px; }
            .sup { font-size: 0.7em; vertical-align: super; margin-left: 1px; }
            .fraction { display: inline-block; text-align: center; vertical-align: middle; margin: 0 5px; font-size: 0.9em; }
            .fraction > span { display: block; padding: 0 2px; }
            .fraction span.bottom { border-top: 1px solid #ddd; }
            
            .comparison-box {
                background: #2a2a2a;
                padding: 15px;
                border-left: 4px solid #FFC107;
                margin-top: 20px;
            }
            .comparison-title { color: #FFC107; font-weight: bold; margin-bottom: 10px; display: block; }
        </style>
		
      
	   <h3>1. –ê–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è –≤ –æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–æ–º—É –±–∞–∑–∏—Å—ñ</h3>
        <p>
            –ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É —á–∏—Å–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É, –∞—É–¥—ñ–æ—Å–∏–≥–Ω–∞–ª ‚Äî —Ü–µ –¥–∏—Å–∫—Ä–µ—Ç–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è (–≤–µ–∫—Ç–æ—Ä). –ü–æ–¥—ñ–±–Ω–æ –¥–æ —Ç–æ–≥–æ, —è–∫ <b>—Ä—è–¥ –¢–µ–π–ª–æ—Ä–∞</b> –Ω–∞–±–ª–∏–∂–∞—î —Ñ—É–Ω–∫—Ü—ñ—é —á–µ—Ä–µ–∑ —Å—É–º—É —Å—Ç–µ–ø–µ–Ω–µ–≤–∏—Ö –æ–¥–Ω–æ—á–ª–µ–Ω—ñ–≤ (1, <i>x</i>, <i>x</i><sup>2</sup>...), –∫–æ–¥–µ–∫–∏ (MP3, AAC) –≤–∏–∫–æ–Ω—É—é—Ç—å —Ä–æ–∑–∫–ª–∞–¥ –∑–∞ —ñ–Ω—à–æ—é —Å–∏—Å—Ç–µ–º–æ—é —Ñ—É–Ω–∫—Ü—ñ–π ‚Äî —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–Ω–æ—é.
        </p>
        <p>
            –ó–∞–º—ñ—Å—Ç—å —Ä—è–¥—ñ–≤ –§—É—Ä'—î —Ç—É—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è <b>MDCT (–ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–µ –î–∏—Å–∫—Ä–µ—Ç–Ω–µ –ö–æ—Å–∏–Ω—É—Å–Ω–µ –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è)</b>. –¶–µ –ø–µ—Ä–µ—Ö—ñ–¥ –≤—ñ–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —Å–∏–≥–Ω–∞–ª—É –≤ "—á–∞—Å–æ–≤–æ–º—É –±–∞–∑–∏—Å—ñ" (–∞–º–ø–ª—ñ—Ç—É–¥–∏ <i>x<sub>n</sub></i>) –¥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –≤ "—á–∞—Å—Ç–æ—Ç–Ω–æ–º—É –±–∞–∑–∏—Å—ñ" (–∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ <i>X<sub>k</sub></i>).
        </p>
        
        <div style="background:#222; padding:15px; border-left:3px solid var(--accent); margin: 15px 0; overflow-x: auto;">
            <math xmlns="http://www.w3.org/1998/Math/MathML" display="block" style="font-family: 'Times New Roman', serif; font-size: 1.2rem; color: #e0e0e0;">
                <msub>
                    <mi>X</mi>
                    <mi>k</mi>
                </msub>
                <mo>=</mo>
                <munderover>
                    <mo>&sum;</mo>
                    <mrow>
                        <mi>n</mi>
                        <mo>=</mo>
                        <mn>0</mn>
                    </mrow>
                    <mrow>
                        <mi>N</mi>
                        <mo>-</mo>
                        <mn>1</mn>
                    </mrow>
                </munderover>
                <msub>
                    <mi>x</mi>
                    <mi>n</mi>
                </msub>
                <mo>&sdot;</mo>
                <mi>cos</mi>
                <mfenced open="[" close="]">
                    <mrow>
                        <mfrac>
                            <mi>&pi;</mi>
                            <mi>N</mi>
                        </mfrac>
                        <mfenced>
                            <mrow>
                                <mi>n</mi>
                                <mo>+</mo>
                                <mfrac>
                                    <mn>1</mn>
                                    <mn>2</mn>
                                </mfrac>
                                <mo>+</mo>
                                <mfrac>
                                    <mi>N</mi>
                                    <mn>2</mn>
                                </mfrac>
                            </mrow>
                        </mfenced>
                        <mfenced>
                            <mrow>
                                <mi>k</mi>
                                <mo>+</mo>
                                <mfrac>
                                    <mn>1</mn>
                                    <mn>2</mn>
                                </mfrac>
                            </mrow>
                        </mfenced>
                    </mrow>
                </mfenced>
            </math>
        </div>

        <h3>2. –û—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ –ü—Ä–æ–µ–∫—Ü—ñ—ó</h3>
        <p>
            –ß–æ–º—É —Å–∞–º–µ –∫–æ—Å–∏–Ω—É—Å–∏? –ù–∞–±—ñ—Ä —Ñ—É–Ω–∫—Ü—ñ–π <i>cos(...)</i> —É —Ñ–æ—Ä–º—É–ª—ñ –≤–∏—â–µ —É—Ç–≤–æ—Ä—é—î <b>–æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∏–π –±–∞–∑–∏—Å</b>. –¶–µ –∞–Ω–∞–ª–æ–≥ –±–∞–∑–∏—Å–Ω–∏—Ö –≤–µ–∫—Ç–æ—Ä—ñ–≤ 
            <math display="inline"><mover><mi>i</mi><mo>&rarr;</mo></mover></math>, 
            <math display="inline"><mover><mi>j</mi><mo>&rarr;</mo></mover></math>, 
            <math display="inline"><mover><mi>k</mi><mo>&rarr;</mo></mover></math> 
            —É —Ç—Ä–∏–≤–∏–º—ñ—Ä–Ω–æ–º—É –ø—Ä–æ—Å—Ç–æ—Ä—ñ, –∞–ª–µ —É –ø—Ä–æ—Å—Ç–æ—Ä—ñ —Ä–æ–∑–º—ñ—Ä–Ω–æ—Å—Ç—ñ <i>N</i>.
        </p>
        <ul>
            <li>
                <b>–°–∫–∞–ª—è—Ä–Ω–∏–π –¥–æ–±—É—Ç–æ–∫:</b> –§–æ—Ä–º—É–ª–∞ –≤–∏—â–µ —î —Ñ–∞–∫—Ç–∏—á–Ω–æ —Å–∫–∞–ª—è—Ä–Ω–∏–º –¥–æ–±—É—Ç–∫–æ–º –≤—Ö—ñ–¥–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞ —Å–∏–≥–Ω–∞–ª—É 
                <math display="inline"><mover><mi>x</mi><mo>&rarr;</mo></mover></math> 
                –Ω–∞ <i>k</i>-–π –±–∞–∑–∏—Å–Ω–∏–π –≤–µ–∫—Ç–æ—Ä.
            </li>
            <li>
                <b>–í–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ:</b> –°–∫–∞–ª—è—Ä–Ω–∏–π –¥–æ–±—É—Ç–æ–∫ –¥–≤–æ—Ö —Ä—ñ–∑–Ω–∏—Ö –±–∞–∑–∏—Å–Ω–∏—Ö –∫–æ—Å–∏–Ω—É—Å—ñ–≤ –¥–æ—Ä—ñ–≤–Ω—é—î –Ω—É–ª—é. –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ <i>X<sub>k</sub></i> –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ –æ–¥–∏–Ω –≤—ñ–¥ –æ–¥–Ω–æ–≥–æ. –ú–∏ –º–æ–∂–µ–º–æ –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏ –∞–±–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –æ–¥–∏–Ω –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç, –Ω–µ –≤–ø–ª–∏–≤–∞—é—á–∏ –Ω–∞ —ñ–Ω—à—ñ.
            </li>
            <li>
                <b>–ù–∞–π–∫—Ä–∞—â–µ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è:</b> –Ø–∫—â–æ –º–∏ –≤–∏—Ä—ñ—à–∏–º–æ –≤—ñ–¥–∫–∏–Ω—É—Ç–∏ —á–∞—Å—Ç–∏–Ω—É –±–∞–∑–∏—Å–Ω–∏—Ö –≤–µ–∫—Ç–æ—Ä—ñ–≤ (–∑–∞–Ω—É–ª–∏—Ç–∏ —á–∞—Å—Ç–∏–Ω—É <i>X<sub>k</sub></i>), —Ç–æ –ø–æ—Ö–∏–±–∫–∞ –∞–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—ó –±—É–¥–µ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é –≤ —Å–µ–Ω—Å—ñ –º–µ—Ç–æ–¥—É –Ω–∞–π–º–µ–Ω—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤.
            </li>
        </ul>
	  
	  
	  
		<p  style="text-align:left">
            –°–ø–µ–∫—Ç—Ä ‚Äî —Ü–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–∏–≥–Ω–∞–ª—É –≤ —ñ–Ω—à—ñ–π —Å–∏—Å—Ç–µ–º—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –≤ –Ω–æ–≤–æ–º—É –±–∞–∑–∏—Å—ñ, –∞–±–æ –≤ —Ç–∞–∫ –∑–≤–∞–Ω–æ–º—É —á–∞—Å—Ç–æ—Ç–Ω–æ–º—É –¥–æ–º–µ–Ω—ñ). –¢–µ, —è–∫ –≤—ñ–Ω –≤–∏–≥–ª—è–¥–∞—î, –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ "–Ø–¥—Ä–∞" (—Ñ—É–Ω–∫—Ü—ñ—ó, –Ω–∞ —è–∫—É –º–∏ –º–Ω–æ–∂–∏–º–æ —Å–∏–≥–Ω–∞–ª):
        </p>
        <ul style="padding-left: 20px;">
            <li style="margin-bottom:10px;"><b>–Ø–¥—Ä–æ DFT (–û–±–µ—Ä—Ç–∞–Ω–Ω—è):</b> –ë–∞–∑–∏—Å ‚Äî —Å–ø—ñ—Ä–∞–ª—ñ –≤ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ñ–π –ø–ª–æ—â–∏–Ω—ñ. –Ü–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ (—Ñ—ñ–∑–∏–∫–∞ —Ö–≤–∏–ª—å). –ê–ª–µ –Ω–∞ –∫—Ä–∞—è—Ö –±–ª–æ–∫—ñ–≤ –≤–∏–Ω–∏–∫–∞—é—Ç—å —Ä–æ–∑—Ä–∏–≤–∏ ("—Å—Ö–æ–¥–∏–Ω–∫–∏"), —â–æ –ø–æ—Ä–æ–¥–∂—É—î –ø–∞—Ä–∞–∑–∏—Ç–Ω—ñ —á–∞—Å—Ç–æ—Ç–∏.</li>
            <li style="margin-bottom:10px;"><b>–Ø–¥—Ä–æ DCT (–°—Ç–æ—è—á—ñ —Ö–≤–∏–ª—ñ):</b> –ë–∞–∑–∏—Å ‚Äî –∫–æ—Å–∏–Ω—É—Å–∏. –ó–∞–≤–¥—è–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–æ–º—É" –µ—Ñ–µ–∫—Ç—É, DCT –∑–∞–±–µ–∑–ø–µ—á—É—î <b>–ø–ª–∞–≤–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥</b> –Ω–∞ –∫—Ä–∞—è—Ö –±–ª–æ–∫—ñ–≤. –¶–µ –¥–æ–∑–≤–æ–ª—è—î —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä—É–≤–∞—Ç–∏ –≤—Å—é –µ–Ω–µ—Ä–≥—ñ—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó —É –ª—ñ–≤–æ–º—É –∫—É—Ç—ñ —Å–ø–µ–∫—Ç—Ä—É (–Ω–∏–∑—å–∫—ñ —á–∞—Å—Ç–æ—Ç–∏).</li>
            <li><b>–Ø–¥—Ä–æ Wavelet (–°–ø–ª–µ—Å–∫–∏):</b> –ë–∞–∑–∏—Å ‚Äî –∫–æ—Ä–æ—Ç–∫—ñ —ñ–º–ø—É–ª—å—Å–∏. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —Å–∏–Ω—É—Å—ñ–≤, —è–∫—ñ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—ñ —É —á–∞—Å—ñ, –≤–µ–π–≤–ª–µ—Ç–∏ –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ. –í–æ–Ω–∏ –ø–æ–∫–∞–∑—É—é—Ç—å <i>–¥–µ —Å–∞–º–µ</i> —Å—Ç–∞–≤—Å—è —Å—Ç—Ä–∏–±–æ–∫ —Å–∏–≥–Ω–∞–ª—É. (JPEG 2000).</li>
        </ul>
        <div class="comparison-box">
            <span class="comparison-title">–í–≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å DCT—ñ  DFT?</span>
            <p>
                –ö–æ–ª–∏ –≤–∏ –ø–æ—á–Ω–µ—Ç–µ –≤–∏–≤—á–∞—Ç–∏ <b>DFT (–î–∏—Å–∫—Ä–µ—Ç–Ω–µ –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –§—É—Ä'—î)</b>, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ñ —á–∏—Å–ª–∞ (<span class="math-font">e<sup style="font-size:0.7em">-iœât</sup></span>). –û—Å—å —è–∫ –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Å–≤–æ—é —ñ–Ω—Ç—É—ó—Ü—ñ—é:
            </p>
            <ul style="padding-left: 20px; margin: 0;">
                <li style="margin-bottom: 10px;">
                    <b></b> DCT –ø—Ä–∞—Ü—é—î –ª–∏—à–µ –∑ <i>–¥—ñ–π—Å–Ω–∏–º–∏</i> —á–∏—Å–ª–∞–º–∏ (—Ç—ñ–ª—å–∫–∏ –∫–æ—Å–∏–Ω—É—Å–∏). DFT –ø—Ä–∞—Ü—é—î –∑ <i>–∫–æ–º–ø–ª–µ–∫—Å–Ω–∏–º–∏</i> (—Å–∏–Ω—É—Å + –∫–æ—Å–∏–Ω—É—Å).
                    <br><small style="color:#aaa">–£ DCT –º–∏ –º–æ–∂–µ–º–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ª–∏—à–µ –∞–º–ø–ª—ñ—Ç—É–¥—É —Ö–≤–∏–ª—ñ. –£ DFT –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–∞—Ä—É —á–∏—Å–µ–ª (Re, Im), —â–æ–± –∫—Ä—É—Ç–∏—Ç–∏ "—Ñ–∞–∑—É" (–∑—Å—É–≤–∞—Ç–∏ —Ö–≤–∏–ª—é –≤–ª—ñ–≤–æ-–≤–ø—Ä–∞–≤–æ).</small>
                </li>
                <li style="margin-bottom: 10px;">
                    <b>–ü–∞—Ä–Ω—ñ—Å—Ç—å:</b> 
                    –ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ DCT –ø–µ—Ä–µ–¥–±–∞—á–∞—î, —â–æ —Å–∏–≥–Ω–∞–ª <b>–ø–∞—Ä–Ω–æ –≤—ñ–¥–¥–∑–µ—Ä–∫–∞–ª–µ–Ω–∏–π</b> –∑–∞ –º–µ–∂–∞–º–∏ —Å–≤–æ–≥–æ –≤—ñ–∫–Ω–∞ (mirroring). –¶–µ –¥–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–Ω—É—Ç–∏ —Ä—ñ–∑–∫–∏—Ö —Å—Ç—Ä–∏–±–∫—ñ–≤ –Ω–∞ –∫—Ä–∞—è—Ö.
                    <br>
                    DFT –∂ –≤–≤–∞–∂–∞—î, —â–æ —Å–∏–≥–Ω–∞–ª –ø—Ä–æ—Å—Ç–æ <b>–ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è</b> (periodic wrapping), —á–µ—Ä–µ–∑ —â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å —Ä–æ–∑—Ä–∏–≤–∏ (–≤—ñ–¥–æ–º—ñ —è–∫ spectral leakage), —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –≤—ñ–∫–æ–Ω–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π.
                </li>
                <li>
                    <b>–ú–µ—Ç–∞ –≤ IT:</b> DCT –∫—Ä–∞—â–µ "–ø–∞–∫—É—î" –µ–Ω–µ—Ä–≥—ñ—é —Ä–µ–∞–ª—å–Ω–∏—Ö —Å–∏–≥–Ω–∞–ª—ñ–≤ (—Ñ–æ—Ç–æ, –∑–≤—É–∫) —É –º–µ–Ω—à—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤, —Ç–æ–º—É –≤–æ–Ω–æ —î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–ª—è JPEG —Ç–∞ MP3. DFT –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç–∞–º, –¥–µ –≤–∞–∂–ª–∏–≤–∞ —Ñ–∞–∑–∞ —Ç–∞ —Ñ—ñ–∑–∏–∫–∞ –ø—Ä–æ—Ü–µ—Å—ñ–≤.
                </li>
				 <span class="warning-title">–ê—Ä—Ç–µ—Ñ–∞–∫—Ç–∏ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –∑ –≤—Ç—Ä–∞—Ç–∞–º–∏ (Lossy Compression)</span>
            <p style="margin:0; text-align:left">
                –ö–æ–ª–∏ –º–∏ –≤–∏–¥–∞–ª—è—î–º–æ —á–∞—Å—Ç–∏–Ω—É —Å–ø–µ–∫—Ç—Ä—É (–≥–∞—Ä–º–æ–Ω—ñ–∫–∏ –Ω–∏–∑—å–∫–æ—ó –∞–º–ø–ª—ñ—Ç—É–¥–∏) –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –º—ñ—Å—Ü—è, –≤–∏–Ω–∏–∫–∞—é—Ç—å:
                <br>
                1. <b>Ringing (–î–∑–≤—ñ–Ω):</b> –†—ñ–∑–∫—ñ –º–µ–∂—ñ –æ–±'—î–∫—Ç—ñ–≤ "–æ–±—Ä–æ—Å—Ç–∞—é—Ç—å" —Ö–≤–∏–ª—è–º–∏ (–µ—Ñ–µ–∫—Ç –ì—ñ–±–±—Å–∞), –±–æ –º–∏ –ø—Ä–∏–±—Ä–∞–ª–∏ –≥–∞—Ä–º–æ–Ω—ñ–∫–∏, —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∏ –∑–∞ –≥–æ—Å—Ç—Ä–æ—Ç—É –∫—É—Ç–∞.
                <br>
                2. <b>Blocking (–ö–≤–∞–¥—Ä–∞—Ç–∏–∫–∏):</b> –û—Å–∫—ñ–ª—å–∫–∏ –º–∏ –æ–±—Ä–æ–±–ª—è—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à–º–∞—Ç–∫–∞–º–∏ –ø–æ 8 —Ç–æ—á–æ–∫ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ, –ø–æ–º–∏–ª–∫–∏ –∫–≤–∞–Ω—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏–∑–≤–æ–¥—è—Ç—å –¥–æ —Ç–æ–≥–æ, —â–æ —è—Å–∫—Ä–∞–≤—ñ—Å—Ç—å –Ω–∞ —Å—Ç–∏–∫—É —Å—É—Å—ñ–¥–Ω—ñ—Ö –±–ª–æ–∫—ñ–≤ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—î. –ú–∏ –±–∞—á–∏–º–æ —Ü–µ —è–∫ "—Å—ñ—Ç–∫—É" –Ω–∞ –ø–µ—Ä–µ—Ç–∏—Å–Ω–µ–Ω–∏—Ö JPEG.
            </p>
            </ul>
        </div>
    </div>
</details>

    <div class="controls">
        <div style="display:flex; align-items:center; gap:10px; margin-right:20px; border-right:1px solid #555; padding-right:20px;">
            <label>–†–æ–∑–º—ñ—Ä (N):</label>
            <select id="nSelect" onchange="changeN()">
                <option value="4">4 (Lo-Fi)</option>
                <option value="8" >8 (JPEG)</option>
                <option value="16"selected>16 (Rich)</option>
                <option value="32">32 (Smooth)</option>
            </select>
        </div>
        
        <button id="btnAudio" onclick="toggleAudio()" style="min-width: 140px;">üîà Play (110Hz)</button>
        <div style="border-right:1px solid #555; height: 30px; margin: 0 10px;"></div>

        <button onclick="setPreset('zero')">–Ü–º–ø—É–ª—å—Å</button>
        <button onclick="setPreset('cosine1')">–ß–∏—Å—Ç–∏–π —Ç–æ–Ω</button>
        <button onclick="setPreset('cosineMix')">–ê–∫–æ—Ä–¥</button>
        <button onclick="setPreset('square')">–ú–µ–∞–Ω–¥—Ä</button>
        <button onclick="setPreset('saw')">–ü–∏–ª–∫–∞ (Saw)</button>
        <button onclick="setPreset('random')">–®—É–º</button>
    </div>

    <div class="container">
        
        <div class="panel">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>1. –î–∏—Å–∫—Ä–µ—Ç–∏–∑–æ–≤–∞–Ω–∞ —Ö–≤–∏–ª—è</h3>
                <button onclick="animateSynthesis()" id="animBtn" style="font-size:0.8rem; padding:4px 10px;">‚ñ∂ –ê–Ω—ñ–º–∞—Ü—ñ—è (IDCT)</button>
            </div>
            <div class="legend">
                <span><span class="dot" style="background:white"></span>–í—Ö—ñ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª x[n]</span>
                <span><span class="dot" style="background:#FFC107"></span>–°–∏–Ω—Ç–µ–∑–æ–≤–∞–Ω–∞ —Ö–≤–∏–ª—è</span>
            </div>
            <canvas id="canvasInput" height="220"></canvas>
            <div style="font-size:0.8rem; color:#777; margin-top:5px;">–ú–∞–ª—é–π—Ç–µ –º–∏—à–∫–æ—é, —â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º–±—Ä –∑–≤—É–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ!</div>
        </div>

        <div class="panel">
            <h3>2. –°–ø–µ–∫—Ç—Ä (–ê–º–ø–ª—ñ—Ç—É–¥–∏ –∫–æ—Å–∏–Ω—É—Å—ñ–≤ - –≥–∞—Ä–º–æ–Ω—ñ–∫–∏)</h3>
            <div class="legend">
                <span><span class="dot" style="background:var(--accent)"></span>–ì—É—á–Ω—ñ—Å—Ç—å —á–∞—Å—Ç–æ—Ç–∏ X[k]</span>
            </div>
            <canvas id="canvasFreq" class="spectrum-canvas" height="220"></canvas>
            <div style="font-size:0.8rem; color:#777; margin-top:5px;">–ö–æ–∂–µ–Ω —Å—Ç–æ–≤–ø—á–∏–∫ ‚Äî —Ü–µ –æ–∫—Ä–µ–º–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—É–∫—É (Oscillator).</div>
        </div>

        <div class="panel full-width" id="analysisPanel">
            <h3>3. –î–µ–∫–æ–º–ø–æ–∑–∏—Ü—ñ—è: –Ø–∫ –∑–Ω–∞–π–¥–µ–Ω–æ X[<span id="lblK">0</span>]? (–∫–ª—ñ–∫–∞–π—Ç–µ –Ω–∞ –≥–∞—Ä–º–æ–Ω—ñ–∫–∏ –≤ —Å–ø–µ–∫—Ç—Ä—ñ)</h3>
            <div class="analysis-layout">
                <div>
                    <canvas id="canvasAnal" height="300"></canvas>
                </div>
                <div class="sum-box">
                    <div style="font-size:0.9rem; color:#bbb">–°–∫–∞–ª—è—Ä–Ω–∏–π –¥–æ–±—É—Ç–æ–∫</div>
                    <div class="math-block" style="width:90%; box-sizing:border-box; background:#111; text-align:center;">
                        sum += x[n] * cos[n]
                    </div>
                    <div style="margin-top:15px; color:#888; font-size:0.8rem;">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
                    <div class="big-number" id="lblSum">0.00</div>
                    <div id="lblSumDesc" style="font-size:0.8rem;"></div>
                </div>
            </div>
        </div>
    </div>

<script>
    // --- Config & State ---
    let N = 16;
    let signal = [];
    let dctCoeffs = [];
    let selectedK = 1; // –¢–µ, —â–æ –≤–∏–±—Ä–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É
    
    // Canvas Contexts
    const cvIn = document.getElementById('canvasInput');
    const ctxIn = cvIn.getContext('2d');
    const cvFreq = document.getElementById('canvasFreq');
    const ctxFreq = cvFreq.getContext('2d');
    const cvAnal = document.getElementById('canvasAnal');
    const ctxAnal = cvAnal.getContext('2d');

    // UI Elements
    const lblK = document.getElementById('lblK');
    const lblSum = document.getElementById('lblSum');
    const lblSumDesc = document.getElementById('lblSumDesc');

    // Animation State
    let isAnimating = false;
    let animStep = -1; 

    // --- AUDIO ENGINE STATE ---
    let audioCtx = null;
    let oscillators = [];
    let isAudioPlaying = false;
    const BASE_FREQ = 110;
    const MASTER_VOL = 0.005; 

    // --- Initialization ---
    function init() {
        [cvIn, cvFreq, cvAnal].forEach(c => {
            c.width = c.clientWidth;
        });
        
        if (signal.length !== N) {
            signal = new Array(N).fill(0).map((_, i) => Math.cos((Math.PI/N)*(i+0.5)*1) * 80); 
        }
        updateAll();
    }

    function changeN() {
        stopAudio();
        N = parseInt(document.getElementById('nSelect').value);
        signal = [];
        selectedK = 1;
        if(selectedK >= N) selectedK = N-1;
        init();
    }

    function setPreset(type) {
        signal = new Array(N).fill(0);
        for(let i=0; i<N; i++) {
            let val = 0;
            if(type === 'zero') val = (i === Math.floor(N/3)) ? 150 : 0;
            else if(type === 'cosine1') val = Math.cos((Math.PI/N)*(i+0.5)*3) * 100;
            else if(type === 'cosineMix') val = (Math.cos((Math.PI/N)*(i+0.5)*1) * 40)*0.6 + (Math.cos((Math.PI/N)*(i+0.5)*3) * 40)*0.2 +(Math.cos((Math.PI/N)*(i+0.5)*4) * 40)*0.3 +(Math.cos((Math.PI/N)*(i+0.5)*5) * 40)*0.5 ;
            else if(type === 'square') val = (i < N/2) ? 80 : -80;
            else if(type === 'saw') val = (i<(N/2)) ? -80 + (160 * i/N):-160 + (160 * i/N);
            else if(type === 'random') val = (Math.random()-0.5)*200;
            signal[i] = val;
        }
        updateAll();
    }

    // --- Math Core (DCT-II) ---
    function computeDCT() {
        let X = new Array(N).fill(0);
        for(let k=0; k<N; k++) {
            let sum = 0;
            let alpha = (k===0) ? 1/Math.sqrt(N) : Math.sqrt(2/N);
            for(let n=0; n<N; n++) {
                let basis = Math.cos((Math.PI/N)*(n+0.5)*k);
                sum += signal[n] * basis;
            }
            X[k] = sum * alpha;
        }
        return X;
    }

    // --- AUDIO FUNCTIONS ---
    function toggleAudio() {
        if (isAudioPlaying) stopAudio(); else startAudio();
    }

    function startAudio() {
        if (!window.AudioContext && !window.webkitAudioContext) {
            alert("Web Audio API –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è"); return;
        }
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        const btn = document.getElementById('btnAudio');
        btn.classList.add('audio-on');
        btn.innerText = "üîä Stop Audio";
        isAudioPlaying = true;
        oscillators = [];

        const compressor = audioCtx.createDynamicsCompressor();
        compressor.threshold.value = -10;
        compressor.connect(audioCtx.destination);

        const real = new Float32Array([0, 1]); 
        const imag = new Float32Array([0, 0]); 
        const cosineWave = audioCtx.createPeriodicWave(real, imag);

        for(let k=1; k<N; k++) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            gain.gain.value = 0; 
            osc.setPeriodicWave(cosineWave);
            osc.frequency.value = k * BASE_FREQ;
            
            osc.connect(gain);
            gain.connect(compressor);
            osc.start();
            
            oscillators.push({ osc: osc, gain: gain, k: k });
        }
        updateAudioEngine();
    }

    function stopAudio() {
        isAudioPlaying = false;
        oscillators.forEach(o => {
            try {
                o.gain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.05);
                o.osc.stop(audioCtx.currentTime + 0.1);
            } catch(e) {}
        });
        oscillators = [];
        const btn = document.getElementById('btnAudio');
        btn.classList.remove('audio-on');
        btn.innerText = "üîà Play (110Hz)";
    }

    function updateAudioEngine() {
        if (!isAudioPlaying) return;
        oscillators.forEach(item => {
            let val = dctCoeffs[item.k];
            let targetGain = val * MASTER_VOL;
            item.gain.gain.setTargetAtTime(targetGain, audioCtx.currentTime, 0.1);
        });
    }

    // --- Drawing Functions ---

    function drawGrid(ctx, w, h) {
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        ctx.setLineDash([]);
        ctx.beginPath();
        ctx.moveTo(0, h/2); ctx.lineTo(w, h/2);
        let step = w / N;
        for(let i=1; i<N; i++) {
            ctx.moveTo(i*step, 0); ctx.lineTo(i*step, h);
        }
        ctx.stroke();
    }

    function drawInput() {
        const w = cvIn.width;
        const h = cvIn.height;
        ctxIn.clearRect(0,0,w,h);
        drawGrid(ctxIn, w, h);
        let step = w / N;

        // 1. –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—Ç–æ—á–Ω–æ—ó –≥–∞—Ä–º–æ–Ω—ñ–∫–∏ (–ü—É–Ω–∫—Ç–∏—Ä)
        if (isAnimating && animStep >= 0 && animStep < N) {
            ctxIn.beginPath();
            ctxIn.strokeStyle = '#00E5FF';
            ctxIn.lineWidth = 2;
            ctxIn.setLineDash([5, 5]); 
            
            for(let px=0; px<=w; px+=2) {
                let n_continuous = (px/w)*N - 0.5;
                let k = animStep; 
                let alpha = (k===0) ? 1/Math.sqrt(N) : Math.sqrt(2/N);
                let component = alpha * dctCoeffs[k] * Math.cos((Math.PI/N)*(n_continuous+0.5)*k);
                
                let py = h/2 - component;
                if(px===0) ctxIn.moveTo(px, py); else ctxIn.lineTo(px, py);
            }
            ctxIn.stroke();
            ctxIn.setLineDash([]); 

            ctxIn.fillStyle = '#00E5FF';
            ctxIn.font = '12px monospace';
            ctxIn.fillText(`+ Add Harmonic k=${animStep}`, 10, 20);
        }

        // 2. –°—É–º–∞ (–ñ–æ–≤—Ç–∞)
        let limit = isAnimating ? animStep : N-1; 
        ctxIn.beginPath();
        ctxIn.strokeStyle = '#FFC107';
        ctxIn.lineWidth = 3;
        for(let px=0; px<=w; px+=2) {
            let n_continuous = (px/w)*N - 0.5;
            let y_val = 0;
            for(let k=0; k <= limit; k++) {
                let alpha = (k===0) ? 1/Math.sqrt(N) : Math.sqrt(2/N);
                let basis = Math.cos((Math.PI/N)*(n_continuous+0.5)*k);
                y_val += alpha * dctCoeffs[k] * basis;
            }
            let py = h/2 - y_val; 
            if(px===0) ctxIn.moveTo(px, py); else ctxIn.lineTo(px, py);
        }
        ctxIn.stroke();

        // 3. –í—Ö—ñ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª (–ë—ñ–ª—ñ —Ç–æ—á–∫–∏)
        for(let i=0; i<N; i++) {
            let x = i*step + step/2;
            let y = h/2 - signal[i];
            
            ctxIn.beginPath(); ctxIn.moveTo(x, h/2); ctxIn.lineTo(x, y);
            ctxIn.strokeStyle = 'rgba(255,255,255,0.3)'; ctxIn.lineWidth = 2; ctxIn.stroke();

            ctxIn.beginPath(); ctxIn.arc(x, y, 4, 0, Math.PI*2);
            ctxIn.fillStyle = 'white'; ctxIn.fill();
        }
    }

    function drawSpectrum() {
        const w = cvFreq.width;
        const h = cvFreq.height;
        ctxFreq.clearRect(0,0,w,h);
        ctxFreq.strokeStyle = '#444';
        ctxFreq.setLineDash([]);
        ctxFreq.beginPath(); ctxFreq.moveTo(0, h/2); ctxFreq.lineTo(w, h/2); ctxFreq.stroke();

        let step = w / N;
        let barW = step * 0.7;

        for(let k=0; k<N; k++) {
            let val = dctCoeffs[k];
            let x = k*step + (step - barW)/2;
            let y = h/2 - val;
            
            // –õ–æ–≥—ñ–∫–∞ –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è
            let isSelected = (k === selectedK); // –¢–µ, —â–æ –≤–∏–±—Ä–∞–≤ —é–∑–µ—Ä (–¥–ª—è –Ω–∏–∂–Ω—å–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫–∞)
            let isPlaying = isAnimating && (k === animStep); // –¢–µ, —â–æ –∑–∞—Ä–∞–∑ –≥—Ä–∞—î (–¥–ª—è –≤–µ—Ä—Ö–Ω—å–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫–∞)

            ctxFreq.fillStyle = (val >= 0) ? 'rgba(0, 188, 212, 0.5)' : 'rgba(244, 67, 54, 0.5)'; // Cyan / Red

            // –Ø–∫—â–æ —Ü–µ –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ - –º–∞–ª—é—î–º–æ —è—Å–∫—Ä–∞–≤–∏–º
            if (isSelected) {
                ctxFreq.fillStyle = '#FF4081'; 
                // –ë—ñ–ª–∞ —Ä–∞–º–∫–∞ –≤–∏–±–æ—Ä—É
                ctxFreq.strokeStyle = 'white';
                ctxFreq.lineWidth = 2;
                ctxFreq.strokeRect(x-2, Math.min(y, h/2)-2, barW+4, Math.abs(val)+4);
            }

            // –Ø–∫—â–æ —Ü–µ –∑–∞—Ä–∞–∑ –∞–Ω—ñ–º—É—î—Ç—å—Å—è - –∂–æ–≤—Ç–∏–π –º–∞—Ä–∫–µ—Ä
            if (isPlaying) {
                ctxFreq.fillStyle = '#FFEB3B'; // Yellow
            }

            // –ú–∞–ª—é—î–º–æ —Å–∞–º —Å—Ç–æ–≤–ø—á–∏–∫
            if(val >= 0) ctxFreq.fillRect(x, y, barW, val);
            else ctxFreq.fillRect(x, h/2, barW, -val);

            // –¢–µ–∫—Å—Ç
            ctxFreq.fillStyle = '#888';
            ctxFreq.font = '10px sans-serif';
            ctxFreq.textAlign = 'center';
            let freqLabel = (k===0) ? "DC" : (k*110)+"Hz";
            ctxFreq.fillText(k, x + barW/2, h - 15);
            if(N <= 16) ctxFreq.fillText(freqLabel, x + barW/2, h - 3);
        }
    }

    function drawAnalysis() {
        // –í–ê–ñ–õ–ò–í–û: –¢—É—Ç –º–∏ –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ selectedK.
        // –ê–Ω—ñ–º–∞—Ü—ñ—è –≤–µ—Ä—Ö–Ω—å–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫–∞ –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ –∑–±–∏–≤–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –Ω–∏–∂–Ω—å–æ–≥–æ.
        let kToShow = selectedK;
        
        const w = cvAnal.width;
        const hTotal = cvAnal.height;
        const hRow = hTotal / 3;
        const step = w / N;
        
        ctxAnal.clearRect(0,0,w,hTotal);
        ctxAnal.font = "12px sans-serif"; ctxAnal.textBaseline = "top"; ctxAnal.fillStyle = "#aaa";
        ctxAnal.fillText("1. Signal[n]", 5, 5);
        ctxAnal.fillText(`2. Basis k=${kToShow} (Correlation)`, 5, hRow + 5);
        ctxAnal.fillText("3. Product", 5, hRow*2 + 5);

        let alpha = (kToShow===0) ? 1/Math.sqrt(N) : Math.sqrt(2/N);

        for(let i=0; i<N; i++) {
            let basisVal = Math.cos((Math.PI/N)*(i+0.5)*kToShow);
            let prodVal = signal[i] * basisVal; 
            let cx = i*step + step/2;

            // Row 1: Signal
            let y1 = hRow/2 - signal[i]*0.4;
            ctxAnal.beginPath(); ctxAnal.arc(cx, y1, 3, 0, Math.PI*2); ctxAnal.fillStyle='white'; ctxAnal.fill();
            ctxAnal.strokeStyle='#333'; ctxAnal.beginPath(); ctxAnal.moveTo(0, hRow/2); ctxAnal.lineTo(w, hRow/2); ctxAnal.stroke();
			ctxAnal.beginPath(); 
            ctxAnal.moveTo(cx, hRow/2); // –ü–æ—á–∏–Ω–∞—î–º–æ –≤—ñ–¥ —Ü–µ–Ω—Ç—Ä—É (–Ω—É–ª—è)
            ctxAnal.lineTo(cx, y1);     // –í–µ–¥–µ–º–æ –ª—ñ–Ω—ñ—é –¥–æ —Ç–æ—á–∫–∏
            ctxAnal.strokeStyle = 'rgba(255,255,255,0.9)'; // –ù–∞–ø—ñ–≤–ø—Ä–æ–∑–æ—Ä–∏–π –±—ñ–ª–∏–π
            ctxAnal.stroke()
            // Row 2: Basis Function (–•–≤–∏–ª—è)
            let y2Base = hRow + hRow/2;
            ctxAnal.strokeStyle='#333'; ctxAnal.beginPath(); ctxAnal.moveTo(0, y2Base); ctxAnal.lineTo(w, y2Base); ctxAnal.stroke();
            ctxAnal.beginPath(); ctxAnal.strokeStyle = '#00bcd4'; ctxAnal.lineWidth = 1;
            for(let px=0; px<=w; px++) {
                let n_c = (px/w)*N - 0.5;
                let b = Math.cos((Math.PI/N)*(n_c+0.5)*kToShow);
                ctxAnal.lineTo(px, y2Base - b*40);
            }
            ctxAnal.stroke();
            
            // –¢–æ—á–∫–∞ –Ω–∞ —Ö–≤–∏–ª—ñ
            let y2 = y2Base - basisVal*40;
            ctxAnal.beginPath(); ctxAnal.arc(cx, y2, 3, 0, Math.PI*2); ctxAnal.fillStyle='#00bcd4'; ctxAnal.fill();

            // Row 3: –î–æ–±—É—Ç–æ–∫
            let y3Base = hRow*2 + hRow/2;
            ctxAnal.strokeStyle='#333'; ctxAnal.beginPath(); ctxAnal.moveTo(0, y3Base); ctxAnal.lineTo(w, y3Base); ctxAnal.stroke();
            let pH = prodVal * 0.5; 
            let pY = y3Base - pH;
            ctxAnal.fillStyle = prodVal >= 0 ? '#4caf50' : '#f44336'; 
            let bw = step * 0.6;
            if(prodVal >= 0) ctxAnal.fillRect(cx - bw/2, pY, bw, pH);
            else ctxAnal.fillRect(cx - bw/2, y3Base, bw, -pH);
        }

        lblK.innerText = kToShow;
        let finalVal = dctCoeffs[kToShow];
        lblSum.innerText = finalVal ? finalVal.toFixed(2) : "0.00";
        lblSumDesc.innerText = (Math.abs(finalVal) < 5) ? "–ú–∞–ª–∞ –µ–Ω–µ—Ä–≥—ñ—è" : "–ó–Ω–∞—á–Ω–∏–π –≤–∫–ª–∞–¥!";
    }

    function updateAll() {
        dctCoeffs = computeDCT();
        drawInput();
        drawSpectrum();
        drawAnalysis();
        updateAudioEngine();
    }

    // --- Interactive Handlers ---
    let isDragging = false;
    cvIn.addEventListener('mousedown', (e) => { isDragging = true; handleInput(e); });
    window.addEventListener('mouseup', () => isDragging = false);
    cvIn.addEventListener('mousemove', (e) => { if(isDragging) handleInput(e); });

    function handleInput(e) {
        if(isAnimating) return;
        const rect = cvIn.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const idx = Math.floor((x / cvIn.width) * N);
        if(idx >= 0 && idx < N) {
            let val = (cvIn.height/2 - y); 
            if(val > 100) val = 100; if(val < -100) val = -100;
            signal[idx] = val;
            updateAll();
            // –ú–∏ –ù–ï –∑–º—ñ–Ω—é—î–º–æ selectedK —Ç—É—Ç, —â–æ–± –Ω–∏–∂–Ω—ñ–π –≥—Ä–∞—Ñ—ñ–∫ –Ω–µ —Å—Ç—Ä–∏–±–∞–≤ –ø—ñ–¥ —á–∞—Å –º–∞–ª—é–≤–∞–Ω–Ω—è
        }
    }

    cvFreq.addEventListener('mousedown', (e) => {
        const rect = cvFreq.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const idx = Math.floor((x / cvFreq.width) * N);
        if(idx >= 0 && idx < N) {
            selectedK = idx;
            updateAll();
            // –¢—É—Ç –º–∏ —è–≤–Ω–æ –æ–Ω–æ–≤–ª—é—î–º–æ –Ω–∏–∂–Ω—ñ–π –≥—Ä–∞—Ñ—ñ–∫, –±–æ —é–∑–µ—Ä –∫–ª—ñ–∫–Ω—É–≤ –Ω–∞ —Å–ø–µ–∫—Ç—Ä
        }
    });

    window.animateSynthesis = () => {
        if(isAnimating) return;
        isAnimating = true;
        animStep = 0;
        
        const btn = document.getElementById('animBtn');
        btn.disabled = true;
        
        updateAll();

        let interval = setInterval(() => {
            animStep++;
            if(animStep >= N) {
                clearInterval(interval);
                isAnimating = false;
                animStep = -1; 
                btn.disabled = false;
            }
            updateAll(); 
        }, 1000); 
    }

    setTimeout(init, 100);
    window.addEventListener('resize', init);
</script>

</body>
</html>
