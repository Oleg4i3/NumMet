<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCA</title>
    
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; max-width: 1280px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; }
        
        /* Layout */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .container { display: flex; gap: 20px; align-items: flex-start; }
        .control-panel { flex: 1; min-width: 380px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); max-height: 90vh; overflow-y: auto; }
        .viz-panel { flex: 2; min-width: 500px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }

        /* Buttons & Inputs */
        button.btn-primary { background-color: #2c3e50; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; transition: 0.2s; font-weight: 600; }
        button.btn-primary:hover { background-color: #34495e; }
        button.btn-nav { background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; }
        button.btn-nav:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        button.btn-action { background-color: #27ae60; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; margin-top: 5px; font-size: 0.9em; }
        
        input[type="number"] { padding: 5px; width: 70px; border: 1px solid #ccc; border-radius: 4px; }
        
        /* Elements */
        .step-title { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; }
        .formula-box { background: #f8f9fa; border-left: 4px solid #3498db; padding: 10px 15px; margin: 15px 0; font-size: 0.95em; }
        .interactive-box { background: #e8f6f3; border: 1px solid #d1f2eb; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .calc-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .feedback { font-weight: bold; margin-left: 10px; }
        .feedback.correct { color: #27ae60; }
        .feedback.wrong { color: #c0392b; }
        .hidden-answer { display: none; background: #fff; padding: 10px; border: 1px dashed #999; margin-top: 10px; }

        .slider-group { margin-top: 20px; background: #ecf0f1; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="header">
    <div>
        <h1 style="margin:0;">–ú–µ—Ç–æ–¥ –≥–æ–ª–æ–≤–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ (PCA)</h1>
        
    </div>
    <div>
        <button class="btn-primary" onclick="downloadCSV()">üì• –ó–±–µ—Ä–µ–≥—Ç–∏ —Å–∏—Ä—ñ –¥–∞–Ω—ñ (.csv)</button>
    </div>
</div>

<div class="container">
    <div class="control-panel">
    <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
            <label><b>–û–±–µ—Ä—ñ—Ç—å —Å—Ü–µ–Ω–∞—Ä—ñ–π –¥–∞–Ω–∏—Ö:</b></label><br>
            <button class="btn-action" style="background:#3498db" onclick="setPreset('server')">üñ•Ô∏è –°–µ—Ä–≤–µ—Ä (CPU vs Watts)</button>
            <button class="btn-action" style="background:#9b59b6" onclick="setPreset('traffic')">üìâ –¢—Ä–∞—Ñ—ñ–∫ (–ù–µ–≥–∞—Ç–∏–≤–Ω–∞ –∫–æ—Ä.)</button>
            <button class="btn-action" style="background:#e67e22" onclick="setPreset('cluster')">üß© –ö–ª–∞—Å—Ç–µ—Ä–∏ (CPU vs GPU)</button>
        </div>

        <div id="explanation-area">Loading...</div>

        <div style="margin-top: 30px; display: flex; justify-content: space-between;">
            <button id="prevBtn" class="btn-nav" onclick="changeStep(-1)">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
            <div id="step-indicator" style="align-self: center; font-weight: bold; color: #7f8c8d;">1 / 7</div>
            <button id="nextBtn" class="btn-nav" onclick="changeStep(1)">–î–∞–ª—ñ ‚û°Ô∏è</button>
        </div>
    </div>

    <div class="viz-panel">
        <div id="plotDiv" style="width:100%; height:600px;"></div>
    </div>
</div>

<div id="steps-data" style="display:none;">
    
<div data-step="0">
        <h2 class="step-title">1. –ê–Ω–∞–ª—ñ–∑ –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö</h2>
        
        <div id="step0-dynamic"></div>

        <div class="formula-box">
            <b>–ó–∞–≤–¥–∞–Ω–Ω—è:</b> –û—Ü—ñ–Ω—ñ—Ç—å –≤—ñ–∑—É–∞–ª—å–Ω–æ, —á–∏ –º–æ–∂–Ω–∞ —Å—Ç–∏—Å–Ω—É—Ç–∏ —Ü—ñ –¥–∞–Ω—ñ –¥–æ –æ–¥–Ω—ñ—î—ó –∑–º—ñ–Ω–Ω–æ—ó, –Ω–µ –≤—Ç—Ä–∞—á–∞—é—á–∏ –±–∞–≥–∞—Ç–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó?
        </div>
        <p><i>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–±–µ—Ä–µ–≥—Ç–∏ —Å–∏—Ä—ñ –¥–∞–Ω—ñ", —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ CSV –¥–ª—è —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.</i></p>
    </div>

    <div data-step="1">
        <h2 class="step-title">2. –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö</h2>
        <p>–£ –ª—ñ–Ω—ñ–π–Ω—ñ–π –∞–ª–≥–µ–±—Ä—ñ –≤–µ–∫—Ç–æ—Ä–∏ –≤–∏—Ö–æ–¥—è—Ç—å –∑ $(0,0)$. –©–æ–± –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ –∞–ª–≥–µ–±—Ä–∏ (–≤–ª–∞—Å–Ω—ñ –≤–µ–∫—Ç–æ—Ä–∏), –º–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ —Ü–µ–Ω—Ç—Ä —Ö–º–∞—Ä–∏ —Ç–æ—á–æ–∫ —É –Ω—É–ª—å.</p>
        <div class="formula-box">
            $$ \mu = \frac{1}{N} \sum_{i=1}^N x^{(i)} $$
            $$ x_{centered} = x_{raw} - \mu $$
        </div>
        <p>–¢–µ–ø–µ—Ä —Å–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∫–æ–∂–Ω–æ—é –≤—ñ—Å—Å—é –¥–æ—Ä—ñ–≤–Ω—é—î 0. –§–æ—Ä–º–∞ —Ö–º–∞—Ä–∏ –Ω–µ –∑–º—ñ–Ω–∏–ª–∞—Å—è.</p>
    </div>

  <div data-step="2">
        <h2 class="step-title">3. –ü—Ä–∞–∫—Ç–∏–∫—É–º: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –ª—ñ–Ω—ñ–π–Ω–∞ –∞–ª–≥–µ–±—Ä–∞</h2>
        
        <div style="background: #fff8e1; border-left: 4px solid #f1c40f; padding: 10px 15px; margin-bottom: 15px;">
            <p style="margin:0"><b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b></p>
            <ul style="margin-top:5px; padding-left: 20px; font-size: 0.95em;">
                <li><b>–î–∏—Å–ø–µ—Ä—Å—ñ—è (Variance, $\sigma^2$):</b> –ú—ñ—Ä–∞ —Ç–æ–≥–æ, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Å–∏–ª—å–Ω–æ –¥–∞–Ω—ñ "—Ä–æ–∑–∫–∏–¥–∞–Ω—ñ" –Ω–∞–≤–∫–æ–ª–æ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ.</li>
                <li><b>–ö–æ–≤–∞—Ä—ñ–∞—Ü—ñ—è (Covariance):</b> –ú—ñ—Ä–∞ —Ç–æ–≥–æ, —è–∫ –¥–≤—ñ –≤–∏–ø–∞–¥–∫–æ–≤—ñ –≤–µ–ª–∏—á–∏–Ω–∏ –∑–º—ñ–Ω—é—é—Ç—å—Å—è <i>—Ä–∞–∑–æ–º</i>. 
                    <br><i>–ü–æ–∑–∏—Ç–∏–≤–Ω–∞</i> ‚Äî —Ä–æ—Å—Ç—É—Ç—å —Ä–∞–∑–æ–º. <i>–ù–µ–≥–∞—Ç–∏–≤–Ω–∞</i> ‚Äî –æ–¥–Ω–∞ —Ä–æ—Å—Ç–µ, —ñ–Ω—à–∞ —Å–ø–∞–¥–∞—î. <i>–ù—É–ª—å</i> ‚Äî –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ.</li>
            </ul>
        </div>

        <p>–£ "—Å–∏—Ä–∏—Ö" –¥–∞–Ω–∏—Ö (CSV, —è–∫–∏–π –≤–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–∏) –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ —Ü–µ–Ω—Ç—Ä–æ–≤–∞–Ω—ñ. –¢–æ–º—É —Ñ–æ—Ä–º—É–ª–∏ –≤–∏–≥–ª—è–¥–∞—é—Ç—å —Ç–∞–∫:</p>

        <div class="formula-box">
            $$ Var(x) = \frac{1}{N-1} \sum_{i=1}^N (x_i - \bar{x})^2 $$
            $$ Cov(x,y) = \frac{1}{N-1} \sum_{i=1}^N (x_i - \bar{x})(y_i - \bar{y}) $$
        </div>

        <p><b>–ó–≤'—è–∑–æ–∫ –∑ –ª—ñ–Ω—ñ–π–Ω–æ—é –∞–ª–≥–µ–±—Ä–æ—é:</b></p>
        <p>–Ø–∫—â–æ –º–∏ –≤–∂–µ –∑—Ä–æ–±–∏–ª–∏ —Ü–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è (–≤—ñ–¥–Ω—è–ª–∏ —Å–µ—Ä–µ–¥–Ω—î, –æ—Ç—Ä–∏–º–∞–≤—à–∏ –≤–µ–∫—Ç–æ—Ä–∏ $\mathbf{v}_x$ —Ç–∞ $\mathbf{v}_y$), —Ç–æ —Ñ–æ—Ä–º—É–ª–∏ —Å—Ç–∞—é—Ç—å –µ–ª–µ–≥–∞–Ω—Ç–Ω–∏–º–∏:</p>
        <ul>
            <li><b>–î–∏—Å–ø–µ—Ä—Å—ñ—è</b> ‚Äî —Ü–µ –∫–≤–∞–¥—Ä–∞—Ç –¥–æ–≤–∂–∏–Ω–∏ –≤–µ–∫—Ç–æ—Ä–∞ (–º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∏–π): $$Var(x) \approx \frac{1}{N-1} ||\mathbf{v}_x||^2$$</li>
            <li><b>–ö–æ–≤–∞—Ä—ñ–∞—Ü—ñ—è</b> ‚Äî —Ü–µ —Å–∫–∞–ª—è—Ä–Ω–∏–π –¥–æ–±—É—Ç–æ–∫ (Dot Product): $$Cov(x,y) \approx \frac{1}{N-1} (\mathbf{v}_x \cdot \mathbf{v}_y)$$</li>
        </ul>
        
        <div class="interactive-box">
            <p><b>–ó–∞–≤–¥–∞–Ω–Ω—è:</b> –†–æ–∑—Ä–∞—Ö—É–π—Ç–µ –º–∞—Ç—Ä–∏—Ü—é –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—ó $C$. <br>
            –ü—ñ–¥–∫–∞–∑–∫–∞: –∫–≤–∞–¥—Ä–∞—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—å (—á–∏—Å–µ–ª—å–Ω–∏–∫–∏ —Ñ–æ—Ä–º—É–ª)</p>
            
            <ul style="font-size:0.9em; font-family:monospace; background:white; padding:10px; border-radius:4px;">
                <li>$\sum (x_i - \bar{x})^2 = $ <span id="val-sxx">0</span></li>
                <li>$\sum (y_i - \bar{y})^2 = $ <span id="val-syy">0</span></li>
                <li>$\sum (x_i - \bar{x})(y_i - \bar{y}) = $ <span id="val-sxy">0</span></li>
                <li>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–º—ñ—Ä—ñ–≤ $N = $ <span id="val-n-raw">0</span> (–¥—ñ–ª–∏–º–æ –Ω–∞ $N-1$)</li>
            </ul>
            
            <div class="calc-row">
                <label><b>$Var(x_1)$</b> (–î–∏—Å–ø–µ—Ä—Å—ñ—è CPU):</label> 
                <div><input type="number" id="inp-cxx" placeholder="?"> <span id="res-cxx" class="feedback"></span></div>
            </div>
            <div class="calc-row">
                <label><b>$Cov(x_1, x_2)$</b> (–ö–æ–≤–∞—Ä—ñ–∞—Ü—ñ—è):</label> 
                <div><input type="number" id="inp-cxy" placeholder="?"> <span id="res-cxy" class="feedback"></span></div>
            </div>
            <div class="calc-row">
                <label><b>$Var(x_2)$</b> (–î–∏—Å–ø–µ—Ä—Å—ñ—è Power):</label> 
                <div><input type="number" id="inp-cyy" placeholder="?"> <span id="res-cyy" class="feedback"></span></div>
            </div>

            <button class="btn-action" onclick="checkCovariance()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</button>
            <button class="btn-action" style="background:#7f8c8d" onclick="showCovarianceAnswer()">–ü–æ–∫–∞–∑–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è</button>
            
            <div id="cov-answer" class="hidden-answer"></div>
        </div>
    </div>

    <div data-step="3">
        <h2 class="step-title">4. –ì–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∞ —ñ–Ω—Ç—É—ó—Ü—ñ—è (–ü—Ä–æ–µ–∫—Ü—ñ—ó)</h2>
        <p><b>–ì–æ–ª–æ–≤–Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (PC1)</b> ‚Äî —Ü–µ –ª—ñ–Ω—ñ—è, —è–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∫—Ä—ñ–∑—å –¥–∞–Ω—ñ —Ç–∞–∫, —â–æ:</p>
        <ol>
            <li>–°—É–º–∞ –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ –≤—ñ–¥—Å—Ç–∞–Ω–µ–π –≤—ñ–¥ —Ç–æ—á–æ–∫ –¥–æ –ª—ñ–Ω—ñ—ó (–æ—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–æ) —î <b>–º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é</b>.</li>
            <li>–ê–ë–û: –°—É–º–∞ –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ –ø—Ä–æ–µ–∫—Ü—ñ–π —Ç–æ—á–æ–∫ –Ω–∞ –ª—ñ–Ω—ñ—é (Variance) —î <b>–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—é</b>.</li>
        </ol>
        <p>–¶–µ –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω—ñ —Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è (—Ç–µ–æ—Ä–µ–º–∞ –ü—ñ—Ñ–∞–≥–æ—Ä–∞).</p>
        
        <div class="slider-group">
            <label>
    <b>–ö—É—Ç: <span id="angleVal">0</span>¬∞</b>
    <span style="color: #666; font-weight: normal; margin-left: 15px; font-size: 0.9em;">
        –ù–∞—Ö–∏–ª ($\tan \alpha$): <span id="tanVal" style="font-family: monospace; font-weight: bold;">0.00</span>
    </span>
</label>
<input type="range" id="angleSlider" min="0" max="180" value="0" style="width:100%">


            <div style="margin-top:10px; font-weight:bold; color: #c0392b;">
                Variance (—Ä–æ–∑–∫–∏–¥ –ø—Ä–æ–µ–∫—Ü—ñ–π): <span id="varVal">0</span>
            </div>
            <p><small>–ó–Ω–∞–π–¥—ñ—Ç—å –∫—É—Ç, –¥–µ Variance –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π.</small></p>
        </div>
    </div>

    <div data-step="4">
        <h2 class="step-title">5. PCA $\neq$ –õ—ñ–Ω—ñ–π–Ω–∞ –†–µ–≥—Ä–µ—Å—ñ—è</h2>
        <p>–¶–µ –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∞ –ø–æ–º–∏–ª–∫–∞. –ü–æ—Ä—ñ–≤–Ω—è—î–º–æ:</p>
        <ul>
            <li><span style="color:green; font-weight:bold">–†–µ–≥—Ä–µ—Å—ñ—è (–ó–µ–ª–µ–Ω–∞)</span>: –ú—ñ–Ω—ñ–º—ñ–∑—É—î <b>–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É</b> –ø–æ–º–∏–ª–∫—É ($y - \hat{y}$). –ü—Ä–æ–≥–Ω–æ–∑—É—î $y$ –Ω–∞ –æ—Å–Ω–æ–≤—ñ $x$.</li>
            <li><span style="color:red; font-weight:bold">PCA (–ß–µ—Ä–≤–æ–Ω–∞)</span>: –ú—ñ–Ω—ñ–º—ñ–∑—É—î <b>–ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—É</b> –≤—ñ–¥—Å—Ç–∞–Ω—å. –®—É–∫–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–∏—Ö ($x$ —ñ $y$ —Ä—ñ–≤–Ω–æ–ø—Ä–∞–≤–Ω—ñ).</li>
        </ul>

        <div class="formula-box">
            <b>–†–µ–≥—Ä–µ—Å—ñ—è:</b> –Ω–∞—Ö–∏–ª $\beta = \frac{Cov(x,y)}{Var(x)}$. <br>
            <b>PCA:</b> –Ω–∞—Ö–∏–ª –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –≤–ª–∞—Å–Ω–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º.
        </div>

        <div class="interactive-box">
            <button class="btn-action" onclick="showRegVsPCA()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–∏ –ª—ñ–Ω—ñ—ó</button>
            <div id="reg-pca-results" class="hidden-answer" style="display:none; margin-top:10px;">
                <p><b>–†—ñ–≤–Ω—è–Ω–Ω—è —Ä–µ–≥—Ä–µ—Å—ñ—ó:</b> $y = \beta x$ (–¥–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤–∞–Ω–∏—Ö)<br>
                $\beta = \frac{C_{12}}{C_{11}} = $ <span id="val-reg-slope"></span></p>
                
                <hr>
                
                <p><b>PCA (–í–ª–∞—Å–Ω–∏–π –≤–µ–∫—Ç–æ—Ä):</b><br>
                –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏—á–Ω–µ —Ä—ñ–≤–Ω—è–Ω–Ω—è: $\det(C - \lambda I) = 0 \Rightarrow \lambda^2 - \text{Tr}(C)\lambda + \det(C) = 0$.<br>
                –ú–∞–∫—Å. –≤–ª–∞—Å–Ω–µ —á–∏—Å–ª–æ $\lambda_1 = $ <span id="val-lambda1"></span>.<br>
                –í–ª–∞—Å–Ω–∏–π –≤–µ–∫—Ç–æ—Ä $v_1$ (Slope) $\approx$ <span id="val-pca-slope"></span>.
                </p>
                
                <p style="background: #fff3cd; padding: 5px;">
                    –ë–∞—á–∏—Ç–µ —Ä—ñ–∑–Ω–∏—Ü—é? –†–µ–≥—Ä–µ—Å—ñ—è "—Ç—è–∂—ñ—î" –¥–æ –æ—Å—ñ X, —è–∫—â–æ –∫–æ—Ä–µ–ª—è—Ü—ñ—è –Ω–µ —ñ–¥–µ–∞–ª—å–Ω–∞. PCA –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–æ—Å–µ—Ä–µ–¥–∏–Ω—ñ "–µ–ª—ñ–ø—Å–∞".
                </p>
            </div>
        </div>
    </div>

    <div data-step="5">
        <h2 class="step-title">6. –ó–º—ñ–Ω–∞ –±–∞–∑–∏—Å—É (–†–µ–∑—É–ª—å—Ç–∞—Ç)</h2>
        <p>–ú–∏ –∑–Ω–∞–π—à–ª–∏ –≤–ª–∞—Å–Ω—ñ –≤–µ–∫—Ç–æ—Ä–∏ –º–∞—Ç—Ä–∏—Ü—ñ –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—ó. –¶–µ —ñ —î –Ω–∞—à—ñ –Ω–æ–≤—ñ –æ—Å—ñ.</p>
        <ul>
            <li><b>PC1 (–í—ñ—Å—å X):</b> –ù–∞–ø—Ä—è–º–æ–∫ –º–∞–∫—Å. –¥–∏—Å–ø–µ—Ä—Å—ñ—ó. –ú—ñ—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é ("–ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è").</li>
            <li><b>PC2 (–í—ñ—Å—å Y):</b> –û—Ä—Ç–æ–≥–æ–Ω–∞–ª—å–Ω–∏–π –Ω–∞–ø—Ä—è–º–æ–∫. –ú—ñ—Å—Ç–∏—Ç—å —à—É–º.</li>
        </ul>
        <p>–ú–∏ "–ø–æ–≤–µ—Ä–Ω—É–ª–∏" –¥–∞–Ω—ñ. –¢–µ–ø–µ—Ä –º–∏ –º–æ–∂–µ–º–æ –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥–∫–∏–Ω—É—Ç–∏ –≤—ñ—Å—å PC2.</p>
    </div>

    <div data-step="6">
        <h2 class="step-title">7. Low Rank Approximation & SVD</h2>
        <p>–£ —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ —É –≤–∞—Å 1000 –æ–∑–Ω–∞–∫ (—Å—Ç–æ–≤–ø—Ü—ñ–≤). PCA –¥–æ–∑–≤–æ–ª—è—î –∑–∞–ª–∏—à–∏—Ç–∏, —Å–∫–∞–∂—ñ–º–æ, 10.</p>
        <p>–¶–µ —Ç—ñ—Å–Ω–æ –ø–æ–≤'—è–∑–∞–Ω–æ –∑ <b>Singular Value Decomposition (SVD)</b>:</p>
        <div class="formula-box">
            $$ X = U \Sigma V^T $$
        </div>
        <p>
            –ó–∞–ª–∏—à–∞—é—á–∏ —Ç—ñ–ª—å–∫–∏ $k$ –Ω–∞–π–±—ñ–ª—å—à–∏—Ö —Å–∏–Ω–≥—É–ª—è—Ä–Ω–∏—Ö —á–∏—Å–µ–ª –≤ $\Sigma$, –º–∏ –æ—Ç—Ä–∏–º—É—î–º–æ $X_k$ ‚Äî <b>–Ω–∞–π–∫—Ä–∞—â–µ –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è —Ä–∞–Ω–≥—É $k$</b> –¥–ª—è –º–∞—Ç—Ä–∏—Ü—ñ $X$ (–∑–∞ –Ω–æ—Ä–º–æ—é –§—Ä–æ–±–µ–Ω—ñ—É—Å–∞).
        </p>
        <p>–¶–µ –æ—Å–Ω–æ–≤–∞ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π–Ω–∏—Ö —Å–∏—Å—Ç–µ–º —Ç–∞ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ –ø–æ—à—É–∫—É.</p>
    </div>
	
	<div data-step="7">
        <h2 class="step-title">8. –ü—Ä–∞–∫—Ç–∏–∫–∞: –©–æ –Ω–∞–º —Ü–µ –¥–∞—î?</h2>
        <p>–ö–æ–ª–∏ –º–∏ –∫–∞–∂–µ–º–æ "–º–∏ –ø–æ–≤–µ—Ä–Ω—É–ª–∏ —Å–∏—Å—Ç–µ–º—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç", —Ü–µ –∑–≤—É—á–∏—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ. –ù–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –º–∏ <b>—Å—Ç–≤–æ—Ä–∏–ª–∏ –Ω–æ–≤—É —Ñ–æ—Ä–º—É–ª—É</b> –¥–ª—è –æ–ø–∏—Å—É –¥–∞–Ω–∏—Ö.</p>

        <div style="background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-top:0">1. –ú–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ "–°—É–ø–µ—Ä-–∑–º—ñ–Ω–Ω—É"</h3>
            <p>–£—è–≤—ñ—Ç—å, —â–æ PCA –∑–Ω–∞–π—à–æ–≤ –≥–æ–ª–æ–≤–Ω–∏–π –≤–µ–∫—Ç–æ—Ä (PC1) –∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ $(0.8, 0.6)$. –¶–µ –¥–∞—î –Ω–∞–º —Ä–µ—Ü–µ–ø—Ç:</p>
            <div class="formula-box" style="text-align:center; margin: 10px 0;">
                $$ \text{ServerIndex} = 0.8 \cdot \text{CPU} + 0.6 \cdot \text{Power} $$
            </div>
            <p>–ú–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏ –Ω–æ–≤—É —Å–∏–Ω—Ç–µ—Ç–∏—á–Ω—É –æ–∑–Ω–∞–∫—É ‚Äî <b>"–Ü–Ω–¥–µ–∫—Å –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è"</b>.</p>
        </div>

        <div style="margin-bottom: 20px;">
            <h3 style="margin-top:0">2. –°—Ç–∏—Å–Ω–µ–Ω–Ω—è (–í—ñ–¥–∫–∏–¥–∞–Ω–Ω—è –∑–∞–π–≤–æ–≥–æ)</h3>
            <p>–Ø–∫ —Ü–µ –≤–∏–≥–ª—è–¥–∞—î –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö:</p>
            <ul style="font-family: monospace; background: #f8f9fa; padding: 10px 20px; border-radius: 5px;">
                <li><b>–î–û PCA:</b> { cpu: 80, power: 300 } <span style="color:#999">// –ó–±–µ—Ä—ñ–≥–∞—î–º–æ 2 —á–∏—Å–ª–∞</span></li>
                <li><b>–ü–Ü–°–õ–Ø:</b> &nbsp;{ server_index: 244 } <span style="color:#27ae60">// –ó–±–µ—Ä—ñ–≥–∞—î–º–æ 1 —á–∏—Å–ª–æ</span></li>
            </ul>
            <p><i>–ù–∞–≤—ñ—â–æ?</i> –£—è–≤—ñ—Ç—å, —â–æ —É –≤–∞—Å <b>500 –º–µ—Ç—Ä–∏–∫</b> (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ —è–¥–µ—Ä, –∫–µ—à, –≤–æ–ª—å—Ç–∞–∂...). PCA –∫–∞–∂–µ: "–¢–æ–±—ñ –Ω–µ —Ç—Ä–µ–±–∞ 500 –≥—Ä–∞—Ñ—ñ–∫—ñ–≤. –¢–æ–±—ñ —Ç—Ä–µ–±–∞ —Å—Ç–µ–∂–∏—Ç–∏ –ª–∏—à–µ –∑–∞ 3 –≥–æ–ª–æ–≤–Ω–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏".</p>
        </div>

        <div style="border-left: 5px solid #e74c3c; background: #fdedec; padding: 15px; border-radius: 0 5px 5px 0;">
            <h3 style="margin-top:0; color: #c0392b;">3. –†–µ–∞–ª—å–Ω–∏–π –∫–µ–π—Å: –ê–Ω–æ–º–∞–ª—ñ—ó (DevOps)</h3>
            <p>–ú–∏ –∑–Ω–∞—î–º–æ, —â–æ CPU —ñ Power –∫–æ—Ä–µ–ª—é—é—Ç—å (—Ü–µ –≤—ñ—Å—å PC1). –ê —â–æ —Ç–∞–∫–µ PC2 (—è–∫—É –º–∏ –∑–∞–∑–≤–∏—á–∞–π —ñ–≥–Ω–æ—Ä—É—î–º–æ)?</p>
            <ul>
                <li><b>PC1 (–í–µ–ª–∏–∫–∞ –≤—ñ—Å—å):</b> –ù–æ—Ä–º–∞–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è ‚Äî –Ω–∞–≥—Ä—ñ–≤—Å—è).</li>
                <li><b>PC2 (–ú–∞–ª–∞ –≤—ñ—Å—å):</b> –ü–æ—Ä—É—à–µ–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏.</li>
            </ul>
            <p><b>üö® –ü—Ä–∞–∫—Ç–∏—á–Ω–µ –ø—Ä–∞–≤–∏–ª–æ:</b> –Ø–∫—â–æ –∑–Ω–∞—á–µ–Ω–Ω—è <code>PC2 > 0</code> (—Å—Ç–∞—î –≤–µ–ª–∏–∫–∏–º) ‚Äî —Ü–µ —Ç—Ä–∏–≤–æ–≥–∞! <br>
            –¶–µ –æ–∑–Ω–∞—á–∞—î: <i>CPU –Ω–∏–∑—å–∫–∏–π, –∞ Power –≤–∏—Å–æ–∫–∏–π</i> (–∞–±–æ –Ω–∞–≤–ø–∞–∫–∏). –ö–æ—Ä–µ–ª—è—Ü—ñ—è –∑–ª–∞–º–∞–ª–∞—Å—å. –©–æ—Å—å –≥–æ—Ä–∏—Ç—å –∞–±–æ "–∫–æ—Ä–æ—Ç–∏—Ç—å".</p>
			
			
			
        </div>
    </div>

</div>
<script>
    // --- –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ---
    let currentStep = 0;
    const TOTAL_STEPS = 8;
    let dataState = {
        raw: [],      
        centered: [], 
        n: 0,
        mean: {x:0, y:0},
        sums: {xx:0, yy:0, xy:0}, 
        cov: {xx:0, yy:0, xy:0},
        pca: {lambda1:0, lambda2:0, v1:{x:0,y:0}, v2:{x:0,y:0}, angle:0},
        reg: {slope: 0}
    };
    let currentAngle = 0;
    let currentPresetConfig = {}; 

    // --- –ü–†–ï–°–ï–¢–ò (–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∞–¥–∞–ø—Ç–æ–≤–∞–Ω—ñ –ø—ñ–¥ –ì–∞—É—Å—Å–∞) ---
    // xCenter/yCenter - —Ü–µ–Ω—Ç—Ä "—Ö–º–∞—Ä–∏"
    // spread - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è (–Ω–∞—Å–∫—ñ–ª—å–∫–∏ —à–∏—Ä–æ–∫–æ —Ä–æ–∑–∫–∏–¥–∞–Ω—ñ —Ç–æ—á–∫–∏)
  const presets = {
        server: { 
            type: 'linear', n: 100, slope: 1.6, noise: 15, 
            xCenter: 60, xSpread: 15, yBase: 20,
            labels: { x: "CPU Load (%)", y: "Power (Watts)" },
            // –ù–æ–≤–µ –ø–æ–ª–µ context
            context: "–£—è–≤—ñ—Ç—å, —â–æ —Ü–µ <b>–ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞</b>:",
            desc: "–ú–∏ –±–∞—á–∏–º–æ —è–≤–Ω—É <b>–ø–æ–∑–∏—Ç–∏–≤–Ω—É –∫–æ—Ä–µ–ª—è—Ü—ñ—é</b>. –ß–∏–º –≤–∏—â–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ –ø—Ä–æ—Ü–µ—Å–æ—Ä, —Ç–∏–º –±—ñ–ª—å—à–µ –µ–Ω–µ—Ä–≥—ñ—ó —Å–ø–æ–∂–∏–≤–∞—î —Å–∏—Å—Ç–µ–º–∞."
        },
        traffic: { 
            type: 'linear', n: 120, slope: -0.5, noise: 15, 
            xCenter: 50, xSpread: 18, yBase: 80,
            labels: { x: "Inbound (Mbps)", y: "Outbound (Mbps)" },
            context: "–£—è–≤—ñ—Ç—å, —â–æ –º–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–º–æ <b>—ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-—à–ª—é–∑</b>:",
            desc: "–¢—É—Ç <b>–Ω–µ–≥–∞—Ç–∏–≤–Ω–∞ –∫–æ—Ä–µ–ª—è—Ü—ñ—è</b>. –ö–æ–ª–∏ –∫–∞–Ω–∞–ª –∑–∞–±–∏—Ç–∏–π –≤—Ö—ñ–¥–Ω–∏–º —Ç—Ä–∞—Ñ—ñ–∫–æ–º (–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è), –≤–∏—Ö—ñ–¥–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å (–≤—ñ–¥–¥–∞—á–∞) —á–∞—Å—Ç–æ –ø–∞–¥–∞—î –∞–±–æ –ø–æ–≤–æ–¥–∏—Ç—å—Å—è –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ."
        },
        cluster: { 
            type: 'clusters', n: 150, noise: 11,
            labels: { x: "CPU Load (%)", y: "GPU Load (%)" },
            context: "–£—è–≤—ñ—Ç—å, —â–æ —Ü–µ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞–¥–∞—á –Ω–∞ <b>HPC –∫–ª–∞—Å—Ç–µ—Ä—ñ</b>:",
            desc: "–î–∞–Ω—ñ <b>–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–Ω—ñ</b>. –ó–∞–¥–∞—á—ñ –¥—ñ–ª—è—Ç—å—Å—è –Ω–∞ —Ç–∏–ø–∏: '–ë–∞–∑–∏ –¥–∞–Ω–∏—Ö' (High CPU), 'ML Training' (High GPU) —Ç–∞ 'Idle'. –ö–æ—Ä–µ–ª—è—Ü—ñ—è —Å–ª–∞–±–∫–∞, –∞–ª–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —î."
        }
    };

    // --- –•–ï–õ–ü–ï–†: –ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª (Box-Muller transform) ---
    // –ü–æ–≤–µ—Ä—Ç–∞—î —á–∏—Å–ª–æ –∑ ~ N(0, 1)
    function randn_bm() {
        let u = 0, v = 0;
        while(u === 0) u = Math.random(); //Converting [0,1) to (0,1)
        while(v === 0) v = Math.random();
        return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
    }

    // --- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ---
    function init() {
        setPreset('server');
    }

    function setPreset(name) {
        currentPresetConfig = presets[name];
        generateData(currentPresetConfig);
        currentStep = 0;
        currentAngle = 0;
        document.getElementById('angleSlider').value = 0;
        
        document.querySelectorAll('input').forEach(i => i.value = '');
        document.querySelectorAll('.feedback').forEach(s => s.innerText = '');
        document.querySelectorAll('.hidden-answer').forEach(d => d.style.display = 'none');
        
        updateUI();
    }

   // --- –ì–ï–ù–ï–†–ê–¶–Ü–Ø –î–ê–ù–ò–• ---
    function generateData(config) {
        let raw = [];
        let sx = 0, sy = 0;
        
        // –•–µ–ª–ø–µ—Ä–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
        const isXPercent = config.labels.x.includes('%');
        const isYPercent = config.labels.y.includes('%');

        if (config.type === 'clusters') {
            // --- –ì–ï–ù–ï–†–ê–¶–Ü–Ø –ö–õ–ê–°–¢–ï–†–Ü–í ---
            const centers = [
                {cx: 15, cy: 15, count: 50}, 
                {cx: 80, cy: 30, count: 30}, 
                {cx: 70, cy: 89, count: 70}  
            ];
            
            centers.forEach(c => {
                for(let i=0; i<c.count; i++) {
                    let x = c.cx + randn_bm() * config.noise;
                    let y = c.cy + randn_bm() * config.noise;
                    
                    // === –§–Ü–ö–° –¢–£–¢ ===
                    // 1. –°–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –º—ñ–Ω—É—Å–∏ (–¥–ª—è –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö)
                    x = Math.max(0, x);
                    y = Math.max(0, y);

                    // 2. –Ø–∫—â–æ —Ü–µ –≤—ñ–¥—Å–æ—Ç–∫–∏, –æ–±—Ä—ñ–∑–∞—î–º–æ –∑–≤–µ—Ä—Ö—É –¥–æ 100
                    if (isXPercent) x = Math.min(x, 100);
                    if (isYPercent) y = Math.min(y, 100);
                    // ===============

                    raw.push({x, y});
                    sx += x; sy += y;
                }
            });
            dataState.n = 150;

        } else {
            // --- –ì–ï–ù–ï–†–ê–¶–Ü–Ø –õ–Ü–ù–Ü–ô–ù–ê / –¢–†–ê–§–Ü–ö ---
            for(let i=0; i<config.n; i++) {
                let x = config.xCenter + randn_bm() * config.xSpread;
                let noise = randn_bm() * config.noise;
                let y = (x * config.slope) + config.yBase + noise;
                
                // === –§–Ü–ö–° –¢–£–¢ ===
                // 1. –°–ø–æ—á–∞—Ç–∫—É –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –º—ñ–Ω—É—Å–∏ (—Ñ—ñ–∑–∏–∫–∞: —Ç—Ä–∞—Ñ—ñ–∫ –Ω–µ –±—É–≤–∞—î < 0)
                x = Math.max(0, x);
                y = Math.max(0, y);

                // 2. –Ø–∫—â–æ —Ü–µ –≤—ñ–¥—Å–æ—Ç–∫–∏, –æ–±—Ä—ñ–∑–∞—î–º–æ –∑–≤–µ—Ä—Ö—É –¥–æ 100
                if (isXPercent) x = Math.min(x, 100);
                if (isYPercent) y = Math.min(y, 100);
                // ===============

                raw.push({x, y});
                sx += x; sy += y;
            }
            dataState.n = config.n;
        }
        
        // –î–∞–ª—ñ –±–µ–∑ –∑–º—ñ–Ω...
        dataState.mean = { x: sx/dataState.n, y: sy/dataState.n };
        dataState.raw = raw;

        dataState.centered = [];
        let sxx=0, syy=0, sxy=0;
        
        raw.forEach(p => {
            let cx = p.x - dataState.mean.x;
            let cy = p.y - dataState.mean.y;
            dataState.centered.push({x: cx, y: cy});
            sxx += cx*cx;
            syy += cy*cy;
            sxy += cx*cy;
        });

        dataState.sums = {xx: sxx, yy: syy, xy: sxy};
        
        let div = dataState.n - 1;
        dataState.cov = {
            xx: sxx / div,
            yy: syy / div,
            xy: sxy / div
        };

        dataState.reg.slope = dataState.cov.xy / dataState.cov.xx;

        let a = dataState.cov.xx;
        let c = dataState.cov.yy;
        let b = dataState.cov.xy; 
        
        let trace = a + c;
        let det = a*c - b*b;
        let delta = Math.sqrt(trace*trace - 4*det);
        
        let l1 = (trace + delta) / 2;
        let l2 = (trace - delta) / 2;
        
        dataState.pca.lambda1 = l1;
        dataState.pca.lambda2 = l2;
        
        let theta = 0.5 * Math.atan2(2*b, a-c);
        dataState.pca.angle = theta; 
        
        dataState.pca.v1 = { x: Math.cos(theta), y: Math.sin(theta) };
        dataState.pca.v2 = { x: -Math.sin(theta), y: Math.cos(theta) };
    }
	
	
    // --- –õ–û–ì–Ü–ö–ê UI (–ó–∞–ª–∏—à–∏–ª–∞—Å—å –±–µ–∑ –∑–º—ñ–Ω) ---
    function changeStep(delta) {
        let newStep = currentStep + delta;
        if (newStep < 0 || newStep >= TOTAL_STEPS) return;
        currentStep = newStep;
        updateUI();
    }

   
   
   
   function updateUI() {
        // 1. –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó
        document.getElementById('prevBtn').disabled = (currentStep === 0);
        document.getElementById('nextBtn').disabled = (currentStep === TOTAL_STEPS - 1);
        document.getElementById('step-indicator').innerText = `${currentStep + 1} / ${TOTAL_STEPS}`;

        // 2. –û—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É –∑ HTML-—à–∞–±–ª–æ–Ω—ñ–≤
        // –ú–∏ –±–µ—Ä–µ–º–æ —à–º–∞—Ç–æ–∫ HTML, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø–æ—Ç–æ—á–Ω–æ–º—É –∫—Ä–æ–∫—É, —ñ –≤—Å—Ç–∞–≤–ª—è—î–º–æ –π–æ–≥–æ –≤ –ø–∞–Ω–µ–ª—å
        const content = document.querySelector(`div[data-step="${currentStep}"]`).innerHTML;
        const explDiv = document.getElementById('explanation-area');
        explDiv.innerHTML = content;

        // 3. –°–ü–ï–¶–Ü–ê–õ–¨–ù–ê –õ–û–ì–Ü–ö–ê –î–õ–Ø –ö–†–û–ö–£ 0 (–î–∏–Ω–∞–º—ñ—á–Ω–∏–π –æ–ø–∏—Å –¥–∞–Ω–∏—Ö)
        if (currentStep === 0) {
            const p = currentPresetConfig; // –ë–µ—Ä–µ–º–æ –∫–æ–Ω—Ñ—ñ–≥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–µ—Å–µ—Ç—É
            
            // –§–æ—Ä–º—É—î–º–æ HTML –Ω–∞ –æ—Å–Ω–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å (CPU vs Traffic vs Cluster)
            const dynamicHTML = `
                <p>${p.context}</p>
                <ul>
                    <li><b>$x_1$ (–≤—ñ—Å—å X):</b> ${p.labels.x}</li>
                    <li><b>$x_2$ (–≤—ñ—Å—å Y):</b> ${p.labels.y}</li>
                </ul>
                <div style="background:#eef6fc; padding:10px; border-left:4px solid #3498db; margin-bottom:15px;">
                    ${p.desc}
                </div>
            `;
            
            // –í—Å—Ç–∞–≤–ª—è—î–º–æ —Ü–µ–π HTML —É —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —è–∫–∏–π –º–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ
            const container = document.getElementById('step0-dynamic');
            if (container) {
                container.innerHTML = dynamicHTML;
            }
        }

        // 4. –ó–∞–ø—É—Å–∫ MathJax (—â–æ–± —Ñ–æ—Ä–º—É–ª–∏ $$...$$ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏–ª–∏—Å—å –Ω–∞ –∫—Ä–∞—Å–∏–≤—É –º–∞—Ç–µ–º–∞—Ç–∏–∫—É)
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ü–µ –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ innerHTML, —ñ–Ω–∞–∫—à–µ –Ω–æ–≤—ñ —Ñ–æ—Ä–º—É–ª–∏ –Ω–µ –≤—ñ–¥—Ä–µ–Ω–¥–µ—Ä—è—Ç—å—Å—è
        if(window.MathJax && MathJax.typesetPromise) {
            MathJax.typesetPromise([explDiv]).catch(err => console.log(err));
        }

        // 5. –°–ü–ï–¶–Ü–ê–õ–¨–ù–ê –õ–û–ì–Ü–ö–ê –î–õ–Ø –ö–†–û–ö–£ 2 (–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ–≤–∞—Ä—ñ–∞—Ü—ñ—ó)
        // –ù–∞–º —Ç—Ä–µ–±–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ –ø–æ—Ä–∞—Ö–æ–≤–∞–Ω—ñ —Å—É–º–∏ —É –ø—ñ–¥–∫–∞–∑–∫–∏ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞
        if (currentStep === 2) {
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —ñ—Å–Ω—É—é—Ç—å –µ–ª–µ–º–µ–Ω—Ç–∏ (—â–æ–± –Ω–µ –±—É–ª–æ –ø–æ–º–∏–ª–æ–∫, —è–∫—â–æ html –∑–º—ñ–Ω–∏–≤—Å—è)
            if(document.getElementById('val-sxx')) {
                document.getElementById('val-sxx').innerText = dataState.sums.xx.toFixed(2);
                document.getElementById('val-syy').innerText = dataState.sums.yy.toFixed(2);
                document.getElementById('val-sxy').innerText = dataState.sums.xy.toFixed(2);
                // –¢—É—Ç –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤–Ω–µ N (–∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ—á–æ–∫), –±–æ —Ñ–æ—Ä–º—É–ª–∞ –¥—ñ–ª–∏—Ç—å –Ω–∞ N-1
                document.getElementById('val-n-raw').innerText = dataState.n; 
            }
        }

        // 6. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫–∞
        renderPlot();
    }
   
   
   
   
   
   
    function checkCovariance() {
        const tol = 1.0; 
        const check = (id, correct) => {
            let el = document.getElementById(id);
            let val = parseFloat(el.value);
            let res = document.getElementById(id.replace('inp', 'res'));
            if (Math.abs(val - correct) < tol) {
                res.innerText = "‚úÖ"; res.className = "feedback correct";
            } else {
                res.innerText = "‚ùå"; res.className = "feedback wrong";
            }
        };
        check('inp-cxx', dataState.cov.xx);
        check('inp-cxy', dataState.cov.xy);
        check('inp-cyy', dataState.cov.yy);
    }

    function showCovarianceAnswer() {
        const div = document.getElementById('cov-answer');
        div.style.display = 'block';
        div.innerHTML = `
            <b>–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:</b><br>
            $$ C = \\begin{pmatrix} 
            ${dataState.cov.xx.toFixed(2)} & ${dataState.cov.xy.toFixed(2)} \\\\ 
            ${dataState.cov.xy.toFixed(2)} & ${dataState.cov.yy.toFixed(2)} 
            \\end{pmatrix} $$
        `;
        MathJax.typesetPromise([div]);
        document.getElementById('inp-cxx').value = dataState.cov.xx.toFixed(2);
        document.getElementById('inp-cxy').value = dataState.cov.xy.toFixed(2);
        document.getElementById('inp-cyy').value = dataState.cov.yy.toFixed(2);
    }

    function showRegVsPCA() {
        const div = document.getElementById('reg-pca-results');
        div.style.display = 'block';
        
        document.getElementById('val-reg-slope').innerText = dataState.reg.slope.toFixed(3);
        document.getElementById('val-lambda1').innerText = dataState.pca.lambda1.toFixed(2);
        
        let pcaSlope = dataState.pca.v1.y / dataState.pca.v1.x;
        document.getElementById('val-pca-slope').innerText = pcaSlope.toFixed(3);

        MathJax.typesetPromise([div]);
        renderPlot(true); 
    }

    function downloadCSV() {
        let csvContent = "data:text/csv;charset=utf-8,";
        const xLbl = currentPresetConfig.labels.x.replace(/,/g, "");
        const yLbl = currentPresetConfig.labels.y.replace(/,/g, "");
        csvContent += `Index,${xLbl},${yLbl},Centered_X,Centered_Y\n`;
        
        dataState.raw.forEach((p, i) => {
            let c = dataState.centered[i];
            csvContent += `${i+1},${p.x.toFixed(4)},${p.y.toFixed(4)},${c.x.toFixed(4)},${c.y.toFixed(4)}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "pca_data.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

 // --- –°–õ–ê–ô–î–ï–† (–û–ù–û–í–õ–ï–ù–ò–ô) ---
    document.addEventListener('input', function(e){
        if(e.target.id === 'angleSlider'){
            currentAngle = parseFloat(e.target.value);
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –≥—Ä–∞–¥—É—Å–∏
            document.getElementById('angleVal').innerText = currentAngle;

            // --- –î–û–î–ê–ù–û: –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞–Ω–≥–µ–Ω—Å–∞ ---
            let rad = currentAngle * Math.PI / 180;
            let tanValue = Math.tan(rad);
            
            // –ö—Ä–∞—Å–∏–≤–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
            let tanDisplay;
            if (Math.abs(tanValue) > 100) {
                tanDisplay = "‚àû"; // –î–ª—è 90 –≥—Ä–∞–¥—É—Å—ñ–≤
            } else {
                // toFixed(2) –æ–∫—Ä—É–≥–ª—é—î –¥–æ 2 –∑–Ω–∞–∫—ñ–≤
                // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ parseFloat, —â–æ–± –ø—Ä–∏–±—Ä–∞—Ç–∏ –∑–∞–π–≤—ñ –Ω—É–ª—ñ (–Ω–∞–ø—Ä. 1.00 -> 1)
                tanDisplay = parseFloat(tanValue.toFixed(2));
            }

            document.getElementById('tanVal').innerText = tanDisplay;
            // ------------------------------------

            renderPlot();
        }
    });

    // --- –í–Ü–ó–£–ê–õ–Ü–ó–ê–¶–Ü–Ø (–ê–¥–∞–ø—Ç–æ–≤–∞–Ω–∞ –¥–ª—è –ì–∞—É—Å—Å–∞) ---
    function renderPlot(showComparison = false) {
        let traces = [];
        let shapes = [];
        let labels = currentPresetConfig.labels;
        
        let layout = {
            hovermode: 'closest',
            showlegend: true,
            legend: {x: 0, y: 1},
            xaxis: { title: labels.x, zeroline: false },
            yaxis: { title: labels.y, scaleanchor: "x", scaleratio: 1, zeroline: false },
            margin: {l:60, r:20, t:30, b:50}
        };

        // –ê–≤—Ç–æ-–¥—ñ–∞–ø–∞–∑–æ–Ω–∏
        const allX = dataState.raw.map(p => p.x);
        const allY = dataState.raw.map(p => p.y);
        const minX = Math.min(...allX), maxX = Math.max(...allX);
        const minY = Math.min(...allY), maxY = Math.max(...allY);
        
        // –î–æ–¥–∞—î–º–æ –±—ñ–ª—å—à–µ "–ø–æ–≤—ñ—Ç—Ä—è", —â–æ–± –µ–ª—ñ–ø—Å–∏ –Ω–µ –æ–±—Ä—ñ–∑–∞–ª–∏—Å—å
        const padX = (maxX - minX) * 0.3; 
        const padY = (maxY - minY) * 0.3;

        let rangeX_Raw = [Math.max(0, minX - padX), maxX + padX];
        let rangeY_Raw = [Math.max(0, minY - padY), maxY + padY];
        
        const maxAbs = Math.max(
            Math.abs(minX - dataState.mean.x), Math.abs(maxX - dataState.mean.x),
            Math.abs(minY - dataState.mean.y), Math.abs(maxY - dataState.mean.y)
        ) * 1.3;
        let rangeCentered = [-maxAbs, maxAbs];

        if (currentStep === 0) {
            traces.push({
                x: dataState.raw.map(p => p.x),
                y: dataState.raw.map(p => p.y),
                mode: 'markers', name: '–î–∞–Ω—ñ',
                marker: { color: '#34495e', size: 8, opacity: 0.7 }
            });
            layout.xaxis.range = rangeX_Raw;
            layout.yaxis.range = rangeY_Raw;
        }
        else {
            traces.push({
                x: dataState.centered.map(p => p.x),
                y: dataState.centered.map(p => p.y),
                mode: 'markers', name: '–¶–µ–Ω—Ç—Ä–æ–≤–∞–Ω—ñ',
                marker: { color: currentStep >= 5 ? '#bdc3c7' : '#3498db', opacity: currentStep>=5?0.3:0.7, size: 8 }
            });
            layout.xaxis.range = rangeCentered;
            layout.yaxis.range = rangeCentered;
            layout.xaxis.title = labels.x + " (centered)";
            layout.yaxis.title = labels.y + " (centered)";
            
            shapes.push(
                { type: 'line', x0: rangeCentered[0], y0: 0, x1: rangeCentered[1], y1: 0, line: {color:'#ddd'} },
                { type: 'line', x0: 0, y0: rangeCentered[0], x1: 0, y1: rangeCentered[1], line: {color:'#ddd'} }
            );

            if (currentStep === 3) {
                let rad = currentAngle * Math.PI / 180;
                let ux = Math.cos(rad);
                let uy = Math.sin(rad);
                let L = maxAbs; 

                shapes.push({
                    type: 'line',
                    x0: -ux*L, y0: -uy*L, x1: ux*L, y1: uy*L,
                    line: { color: '#e74c3c', width: 3 }
                });

                let variance = 0;
                let px = [], py = [];
                let linesX = [], linesY = [];
                
                dataState.centered.forEach(p => {
                    let dot = p.x*ux + p.y*uy;
                    variance += dot*dot;
                    let projX = dot*ux;
                    let projY = dot*uy;
                    px.push(projX); py.push(projY);
                    linesX.push(p.x, projX, null);
                    linesY.push(p.y, projY, null);
                });
                
                document.getElementById('varVal').innerText = Math.round(variance);

                traces.push({
                    x: px, y: py, mode: 'markers', name: '–ü—Ä–æ–µ–∫—Ü—ñ—ó',
                    marker: { color: '#e74c3c', size: 6 }
                });
                traces.push({
                    x: linesX, y: linesY, mode: 'lines', showlegend: false,
                    line: { color: '#e74c3c', width: 0.5, dash: 'dot' }, opacity: 0.5
                });
            }

            if (currentStep === 4 && showComparison) {
                let L = maxAbs;
                let yReg1 = dataState.reg.slope * (-L);
                let yReg2 = dataState.reg.slope * (L);
                traces.push({
                    x: [-L, L], y: [yReg1, yReg2],
                    mode: 'lines', name: '–†–µ–≥—Ä–µ—Å—ñ—è',
                    line: { color: '#27ae60', width: 3 }
                });

                let pcaSlope = dataState.pca.v1.y / dataState.pca.v1.x;
                let yPca1 = pcaSlope * (-L);
                let yPca2 = pcaSlope * (L);
                traces.push({
                    x: [-L, L], y: [yPca1, yPca2],
                    mode: 'lines', name: 'PCA',
                    line: { color: '#e74c3c', width: 3, dash: 'dash' }
                });
            }

            if (currentStep >= 5) {
                let ux = dataState.pca.v1.x;
                let uy = dataState.pca.v1.y;

                let rotX = [], rotY = [];
                dataState.centered.forEach(p => {
                    rotX.push(p.x * ux + p.y * uy);      
                    rotY.push(-p.x * uy + p.y * ux);     
                });

                traces.push({
                    x: rotX, y: rotY,
                    mode: 'markers', name: 'PCA Transformed',
                    marker: { color: '#2ecc71', size: 7 }
                });

                layout.title = "–ü—Ä–æ—Å—Ç—ñ—Ä –ì–æ–ª–æ–≤–Ω–∏—Ö –ö–æ–º–ø–æ–Ω–µ–Ω—Ç";
                layout.xaxis.title = "PC1";
                layout.yaxis.title = "PC2";
                
                const noiseY = maxAbs * 0.25; 
                shapes.push({
                    type: 'rect', x0: -maxAbs, x1: maxAbs, y0: -noiseY, y1: noiseY,
                    fillcolor: 'rgba(46, 204, 113, 0.1)', line: {width: 0}
                });
            }
        }

        layout.shapes = shapes;
        Plotly.newPlot('plotDiv', traces, layout, {staticPlot: false, responsive: true});
    }

    init();
</script>

</body>
</html>