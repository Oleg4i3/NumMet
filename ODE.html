<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODE Simulator</title>
    
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']]
        },
        options: { ignoreHtmlClass: 'tex2jax_ignore', processHtmlClass: 'tex2jax_process' },
        chtml: { scale: 1.0 }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #2980b9;
            --bg-light: #f4f7f9;
            --text-color: #333;
            --border-color: #dce4ec;
        }

        body {
            font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-light);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: var(--text-color);
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h2 { margin: 0; font-size: 1.3rem; font-weight: 600; }
        .badge { background: #e74c3c; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }

        .main-container { display: flex; flex: 1; overflow: hidden; }

        /* Sidebar */
        .sidebar {
            width: 380px;
            background: #fff;
            border-right: 1px solid var(--border-color);
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 4px 0 10px rgba(0,0,0,0.03);
            flex-shrink: 0;
            z-index: 2;
        }

        .control-group { display: flex; flex-direction: column; gap: 8px; }
        label { font-weight: 700; font-size: 0.85rem; color: #555; text-transform: uppercase; }
        
        select {
            padding: 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            font-size: 0.95rem;
            background: white;
        }

        .slider-container { display: flex; flex-direction: column; gap: 8px; }
        .slider-header { display: flex; justify-content: space-between; align-items: baseline; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--accent-color); }
        
        .val-display {
            font-family: "Consolas", monospace;
            font-weight: bold;
            color: var(--accent-color);
            font-size: 1rem;
        }

        .math-display {
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            border-left: 5px solid var(--accent-color);
            font-size: 1rem;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #hintBox {
            font-size: 0.9rem; 
            color: #7f6000; 
            background: #fff8db; 
            padding: 15px; 
            border-radius: 6px; 
            border-left: 4px solid #f1c40f;
            display: none;
            line-height: 1.5;
        }

        .content-wrapper { flex: 1; display: flex; flex-direction: column; overflow-y: auto; background: #fff; }

        .plot-area {
            height: 55vh; 
            min-height: 400px;
            width: 100%;
            background: white;
            position: relative;
        }

        .theory-section { padding: 30px 50px; background-color: #fdfdfd; border-top: 1px solid var(--border-color); }

        details {
            background: #fff;
            border-radius: 8px;
            padding: 0;
            border: 1px solid #e1e8ed;
            overflow: hidden;
        }

        summary {
            cursor: pointer;
            font-weight: bold;
            color: var(--primary-color);
            padding: 15px 20px;
            font-size: 1.1rem;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        
        .theory-content { padding: 25px 30px; line-height: 1.7; color: #2c3e50; font-size: 0.95rem; }
        .theory-content h3 { color: var(--accent-color); margin-top: 1.5em; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        .theory-content h4 { color: #2c3e50; margin-top: 1.5em; font-weight: 700; }

        .formula-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #eee;
            margin: 15px 0;
            text-align: center;
            font-family: "Times New Roman", serif;
            font-size: 1.1rem;
        }

        .formula-expl {
            font-size: 0.9rem;
            color: #555;
            background: #eef2f5;
            padding: 10px;
            border-radius: 4px;
            margin-top: 5px;
        }

        .stats-panel {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            justify-content: space-between;
            padding: 8px 10px;
            background: #f1f3f5;
            border-radius: 6px;
            font-family: monospace;
        }
    </style>
</head>
<body>

<header>
    <h2>–ß–∏—Å–µ–ª—å–Ω—ñ –º–µ—Ç–æ–¥–∏ —Ä–æ–∑–≤'—è–∑—É–≤–∞–Ω–Ω—è –∑–≤–∏—á–∞–π–Ω–∏—Ö –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª—å–Ω–∏—Ö —Ä—ñ–≤–Ω—è–Ω—å <span class="badge"></span></h2>
</header>

<div class="main-container">
    <aside class="sidebar">
        <div class="control-group">
            <label for="presetSelect">1. –ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –º–æ–¥–µ–ª—å</label>
            <select id="presetSelect">
                <option value="decay">–°–ø–∞–¥–Ω–∞ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞</option>
                <option value="growth">–ó—Ä–æ—Å—Ç–∞—é—á–∞ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞</option>
                <option value="damped_osc">–ó–∞–≥–∞—Å–∞—é—á–∏–π –æ—Å—Ü–∏–ª—è—Ç–æ—Ä</option>
				<option value="logistic">–õ–æ–≥—ñ—Å—Ç–∏—á–Ω–µ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è</option>
                <option value="vanderpol">–û—Å—Ü–∏–ª—è—Ç–æ—Ä –í–∞–Ω –¥–µ—Ä –ü–æ–ª—è (–ñ–æ—Ä—Å—Ç–∫–∏–π!)</option>
                <option value="stiff_decay">–®–≤–∏–¥–∫–∞ —Ä–µ–ª–∞–∫—Å–∞—Ü—ñ—è (–ñ–æ—Ä—Å—Ç–∫–∏–π!)</option>
                               <option value="hyperbola">–ì—ñ–ø–µ—Ä–±–æ–ª–∞ (–°–∏–Ω–≥—É–ª—è—Ä–Ω—ñ—Å—Ç—å)</option>
            </select>
        </div>

        <div id="formulaDisplay" class="math-display"></div>

        <div class="control-group">
            <label for="methodSelect">2. –ß–∏—Å–µ–ª—å–Ω–∏–π –º–µ—Ç–æ–¥</label>
            <select id="methodSelect">
                <option value="euler_explicit">–Ø–≤–Ω–∏–π –º–µ—Ç–æ–¥ –ï–π–ª–µ—Ä–∞ (Euler Explicit)</option>
                <option value="euler_implicit">–ù–µ—è–≤–Ω–∏–π –º–µ—Ç–æ–¥ –ï–π–ª–µ—Ä–∞ (Euler Implicit)</option>
                <option value="rk4">–†—É–Ω–≥–µ-–ö—É—Ç—Ç–∞ 4 (RK4)</option>
                <option value="rk_adaptive">RK –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π (RK45 / Embedded)</option>
            </select>
        </div>

        <div class="control-group slider-container">
            <div class="slider-header">
                <label id="stepLabel" for="stepSlider">–ö—Ä–æ–∫ ($h$)</label>
                <span id="stepValDisplay" class="val-display">0.1000</span>
            </div>
            <input type="range" id="stepSlider" min="0" max="100" value="50">
        </div>

        <div class="control-group slider-container">
            <div class="slider-header">
                <label for="durationSlider">–Ü–Ω—Ç–µ—Ä–≤–∞–ª ($T_{max}$)</label>
                <span id="durationDisplay" class="val-display">10.0</span>
            </div>
            <input type="range" id="durationSlider" min="1" max="50" step="0.5" value="10">
        </div>

        <div class="stats-panel">
            <span>–ö—Ä–æ–∫–∏: <b id="stepCount">0</b></span>
            <span>Max Err: <b id="maxError">-</b></span>
        </div>
        
        <div id="hintBox"></div>
    </aside>

    <div class="content-wrapper">
        <div id="plotDiv" class="plot-area"></div>

        <section class="theory-section">
			  <details>
                <summary>–í—Å—Ç—É–ø –¥–æ —á–∏—Å–µ–ª—å–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è –ó–î–†</summary>
                <div class="theory-content">
                    <h3>1. –ß–æ–º—É –º–∏ —Ä–æ–∑–≤'—è–∑—É—î–º–æ —Ä—ñ–≤–Ω—è–Ω–Ω—è —á–∏—Å–µ–ª—å–Ω–æ?</h3>
                    <p>
                        –£ –∫—É—Ä—Å—ñ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –≤–∏ –≤–∏–≤—á–∞–ª–∏ –º–µ—Ç–æ–¥–∏ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–≤—ñ—Å–Ω–∏—Ö. –ü—Ä–æ—Ç–µ, –≤–∏ –≤–∂–µ –∑–Ω–∞—î—Ç–µ, —â–æ —ñ—Å–Ω—É—é—Ç—å "—ñ–Ω—Ç–µ–≥—Ä–∞–ª–∏, —â–æ –Ω–µ –±–µ—Ä—É—Ç—å—Å—è" –≤ –µ–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ—è—Ö, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ $\int e^{-x^2} dx$ (—ñ–Ω—Ç–µ–≥—Ä–∞–ª –ü—É–∞—Å—Å–æ–Ω–∞).
                    </p>
                    <p>
                        –£ –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª—å–Ω–∏—Ö —Ä—ñ–≤–Ω—è–Ω–Ω—è—Ö —Å–∏—Ç—É–∞—Ü—ñ—è –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∞, –∞–ª–µ –º–∞—Å—à—Ç–∞–±–Ω—ñ—à–∞. –ë—ñ–ª—å—à—ñ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π (—Ä—É—Ö –Ω–µ–±–µ—Å–Ω–∏—Ö —Ç—ñ–ª, —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω—ñ—Å—Ç—å —Ä—ñ–¥–∏–Ω–∏, –¥–∏–Ω–∞–º—ñ–∫–∞ –ø–æ–ø—É–ª—è—Ü—ñ–π, –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—ñ) –æ–ø–∏—Å—É—é—Ç—å—Å—è –Ω–µ–ª—ñ–Ω—ñ–π–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏, –¥–ª—è —è–∫–∏—Ö <b>–∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–æ—ó —Ñ–æ—Ä–º—É–ª–∏ —Ä–æ–∑–≤'—è–∑–∫—É –Ω–µ —ñ—Å–Ω—É—î –≤ –ø—Ä–∏–Ω—Ü–∏–ø—ñ</b>. –Ñ–¥–∏–Ω–∏–π —Å–ø–æ—Å—ñ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –ø–æ–≤–µ–¥—ñ–Ω–∫—É —Å–∏—Å—Ç–µ–º–∏ ‚Äî "–ø—Ä–æ–º–æ–¥–µ–ª—é–≤–∞—Ç–∏" —ó—ó –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º. –¶–µ —ñ —Ä–æ–±–ª—è—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–∏, —è–∫—ñ –≤–∏ –±–∞—á–∏—Ç–µ –≤ —Ü—å–æ–º—É —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ.
                    </p>

                    <h3>2. –ê–Ω–∞–ª–æ–≥—ñ—ó –∑ –≤–∏–∑–Ω–∞—á–µ–Ω–∏–º —ñ–Ω—Ç–µ–≥—Ä–∞–ª–æ–º</h3>
                    <p>
                        –†–æ–∑–≤'—è–∑–∞–Ω–Ω—è –¥–∏—Ñ. —Ä—ñ–≤–Ω—è–Ω–Ω—è $y' = f(t,y)$ –¥—É–∂–µ —Å—Ö–æ–∂–µ –Ω–∞ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –≤–∏–∑–Ω–∞—á–µ–Ω–æ–≥–æ —ñ–Ω—Ç–µ–≥—Ä–∞–ª—É $\int_a^b f(t) dt$. –†—ñ–∑–Ω–∏—Ü—è –ª–∏—à–µ –≤ —Ç–æ–º—É, —â–æ –≤ –¥–∏—Ñ. —Ä—ñ–≤–Ω—è–Ω–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó $f$ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Å–∞–º–æ–≥–æ $y$, —è–∫–∏–π –º–∏ —â–µ –Ω–µ –∑–Ω–∞–π—à–ª–∏.
                    </p>

                    <table class="comparison-table">
                        <tr>
                            <th>–ß–∏—Å–µ–ª—å–Ω–µ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞–Ω–Ω—è </th>
                            <th>–†–æ–∑–≤'—è–∑–∞–Ω–Ω—è ODE (–ß–∏—Å–µ–ª—å–Ω—ñ –º–µ—Ç–æ–¥–∏)</th>
                            <th>–ì–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∏–π –∑–º—ñ—Å—Ç</th>
                        </tr>
                        <tr>
                            <td><b>–ú–µ—Ç–æ–¥ –ª—ñ–≤–∏—Ö –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫—ñ–≤</b><br> $S \approx \sum f(x_i) \Delta x$</td>
                            <td><b>–Ø–≤–Ω–∏–π –º–µ—Ç–æ–¥ –ï–π–ª–µ—Ä–∞</b><br> $y_{n+1} = y_n + h \cdot f(t_n, y_n)$</td>
                            <td>–ê–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è –∫—Ä–∏–≤–æ—ó –¥–æ—Ç–∏—á–Ω–æ—é. –ü—Ä–∏–ø—É—Å–∫–∞—î–º–æ, —â–æ —à–≤–∏–¥–∫—ñ—Å—Ç—å –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ –≤—Å—å–æ–º—É —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ –∫—Ä–æ–∫—É. –¢–æ—á–Ω—ñ—Å—Ç—å $O(h)$.</td>
                        </tr>
                        <tr>
                            <td><b>–ú–µ—Ç–æ–¥ —Ç—Ä–∞–ø–µ—Ü—ñ–π</b><br> $S \approx \sum \frac{f(x_i)+f(x_{i+1})}{2} \Delta x$</td>
                            <td><b>–ù–µ—è–≤–Ω–∏–π –º–µ—Ç–æ–¥ –ï–π–ª–µ—Ä–∞ / –ì—é–Ω–∞</b><br> –í—Ä–∞—Ö–æ–≤—É—î –Ω–∞—Ö–∏–ª –Ω–∞ –ø–æ—á–∞—Ç–∫—É —ñ –≤ –∫—ñ–Ω—Ü—ñ –∫—Ä–æ–∫—É.</td>
                            <td>–ê–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è —Ö–æ—Ä–¥–æ—é. –ë—ñ–ª—å—à —Å—Ç—ñ–π–∫–∞ –¥–æ –∫–æ–ª–∏–≤–∞–Ω—å.</td>
                        </tr>
                        <tr>
                            <td><b>–ú–µ—Ç–æ–¥ –°—ñ–º–ø—Å–æ–Ω–∞</b><br> –ê–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—è –ø–∞—Ä–∞–±–æ–ª–æ—é</td>
                            <td><b>–ú–µ—Ç–æ–¥ –†—É–Ω–≥–µ-–ö—É—Ç—Ç–∞ 4 (RK4)</b></td>
                            <td>–ú–∏ –±–µ—Ä–µ–º–æ 4 "–ø—Ä–æ–±–∏" –Ω–∞—Ö–∏–ª—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫—Ä–æ–∫—É, —â–æ–± —ñ–¥–µ–∞–ª—å–Ω–æ –≤—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫—Ä–∏–≤–∏–∑–Ω—É —Ñ—É–Ω–∫—Ü—ñ—ó. –¢–æ—á–Ω—ñ—Å—Ç—å $O(h^4)$.</td>
                        </tr>
                    </table>

                    <h3>3. –ñ–æ—Ä—Å—Ç–∫—ñ—Å—Ç—å (Stiffness) —Ç–∞ –°—Ç—ñ–π–∫—ñ—Å—Ç—å</h3>
                    <p>
                        –¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–µ –ø–æ–Ω—è—Ç—Ç—è –¥–ª—è CS. –Ü—Å–Ω—É—é—Ç—å —Å–∏—Å—Ç–µ–º–∏, –¥–µ –ø—Ä–æ—Ü–µ—Å–∏ –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –∑ —Ä—ñ–∑–Ω–æ—é —à–≤–∏–¥–∫—ñ—Å—Ç—é (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —à–≤–∏–¥–∫–∞ —Ä–æ–∑—Ä—è–¥–∫–∞ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä–∞ –∑–∞ –º—ñ–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∏ —ñ –ø–æ–≤—ñ–ª—å–Ω–∏–π —Ä–æ–∑—Ä—è–¥ –±–∞—Ç–∞—Ä–µ—ó –∑–∞ –≥–æ–¥–∏–Ω–∏).
                    </p>
                    <ul>
                        <li><b>–Ø–≤–Ω—ñ –º–µ—Ç–æ–¥–∏ (–ï–π–ª–µ—Ä, RK4):</b> –ú–∞—é—Ç—å –æ–±–º–µ–∂–µ–Ω—É <i>–æ–±–ª–∞—Å—Ç—å —Å—Ç—ñ–π–∫–æ—Å—Ç—ñ</i>. –Ø–∫—â–æ –∫—Ä–æ–∫ $h$ –∑–∞–≤–µ–ª–∏–∫–∏–π –¥–ª—è "—à–≤–∏–¥–∫–æ–≥–æ" –ø—Ä–æ—Ü–µ—Å—É, —á–∏—Å–µ–ª—å–Ω–∞ –ø–æ–º–∏–ª–∫–∞ —Ä–µ–∑–æ–Ω—É—î —ñ –Ω–∞–∫–æ–ø–∏—á—É—î—Ç—å—Å—è ‚Äî —Ä–æ–∑–≤'—è–∑–æ–∫ "–≤–∏–±—É—Ö–∞—î" (–π–¥–µ –≤ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—ñ—Å—Ç—å).</li>
                        <li><b>–ù–µ—è–≤–Ω—ñ –º–µ—Ç–æ–¥–∏ (Implicit Euler):</b> –Ñ <i>–∞–±—Å–æ–ª—é—Ç–Ω–æ —Å—Ç—ñ–π–∫–∏–º–∏</i>. –í–æ–Ω–∏ –≤–∏–º–∞–≥–∞—é—Ç—å —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è–Ω–Ω—è –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ (–∑–∞–∑–≤–∏—á–∞–π –º–µ—Ç–æ–¥–æ–º –ù—å—é—Ç–æ–Ω–∞), –∞–ª–µ –¥–æ–∑–≤–æ–ª—è—é—Ç—å —Ä–æ–±–∏—Ç–∏ –≥—ñ–≥–∞–Ω—Ç—Å—å–∫—ñ –∫—Ä–æ–∫–∏ –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ.</li>
                    </ul>
                    <p>
                        <i>–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç:</i> –í–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–µ—Å–µ—Ç <b>"–ñ–æ—Ä—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–∞"</b>. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∫—Ä–æ–∫ $h \approx 0.05$. –ú–µ—Ç–æ–¥ –ï–π–ª–µ—Ä–∞ –ø–æ–∫–∞–∂–µ —Ö–∞–æ—Å ("–ø–∏–ª–∫—É"), –∞ –Ω–µ—è–≤–Ω–∏–π –º–µ—Ç–æ–¥ –¥–∞—Å—Ç—å –ø–ª–∞–≤–Ω—É –ª—ñ–Ω—ñ—é.
                    </p>
                </div>
            </details>
			
			<details open>
                <summary> –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞</summary>
                <div class="theory-content">
                    <p>–ú–∏ —Ä–æ–∑–≤'—è–∑—É—î–º–æ –∑–∞–¥–∞—á—É –ö–æ—à—ñ –¥–ª—è –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª—å–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è–Ω–Ω—è (–∞–±–æ —Å–∏—Å—Ç–µ–º–∏):
                    $$y' = f(t, y), \quad y(t_0) = y_0$$</p>

                    <h3>1. –Ø–≤–Ω–∏–π –º–µ—Ç–æ–¥ –ï–π–ª–µ—Ä–∞ (Explicit Euler)</h3>
                    <div class="method-card explicit">
                        <p>–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π –º–µ—Ç–æ–¥ 1-–≥–æ –ø–æ—Ä—è–¥–∫—É —Ç–æ—á–Ω–æ—Å—Ç—ñ. –ú–∏ –ø—Ä–æ–≥–Ω–æ–∑—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –¥–æ—Ç–∏—á–Ω–æ—é.</p>
                        <div class="formula-box">$$y_{n+1} = y_n + h \cdot f(t_n, y_n)$$</div>
                        <p><b>–ü—Ä–æ–±–ª–µ–º–∞:</b> –£–º–æ–≤–Ω–∞ —Å—Ç—ñ–π–∫—ñ—Å—Ç—å. –Ø–∫—â–æ –∫—Ä–æ–∫ $h$ –∑–∞–≤–µ–ª–∏–∫–∏–π –¥–ª—è "—à–≤–∏–¥–∫–∏—Ö" –ø—Ä–æ—Ü–µ—Å—ñ–≤ (–∂–æ—Ä—Å—Ç–∫—ñ –∑–∞–¥–∞—á—ñ), –ø–æ—Ö–∏–±–∫–∞ –∑—Ä–æ—Å—Ç–∞—î –ª–∞–≤–∏–Ω–æ–ø–æ–¥—ñ–±–Ω–æ ("–≤–∏–±—É—Ö").</p>
                    </div>

                    <h3>2. –ù–µ—è–≤–Ω–∏–π –º–µ—Ç–æ–¥ –ï–π–ª–µ—Ä–∞ (Implicit Euler)</h3>
                    <div class="method-card implicit">
                        <p>–¢–∞–∫–æ–∂ 1-–π –ø–æ—Ä—è–¥–æ–∫, –∞–ª–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ —Å—Ç—ñ–π–∫–∏–π. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –Ω–∞—Ö–∏–ª —É <i>–º–∞–π–±—É—Ç–Ω—ñ–π</i> —Ç–æ—á—Ü—ñ.</p>
                        <div class="formula-box">$$y_{n+1} = y_n + h \cdot f(t_{n+1}, y_{n+1})$$</div>
                        
                        <h4>–ß–æ–º—É —Ü–µ —Å–∫–ª–∞–¥–Ω–æ? (Non-linear Solver)</h4>
                        <p>–ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ —Ñ–æ—Ä–º—É–ª—É –≤–∏—â–µ. –ù–µ–≤—ñ–¥–æ–º–∞ –≤–µ–ª–∏—á–∏–Ω–∞ $y_{n+1}$ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —ñ –∑–ª—ñ–≤–∞, —ñ —Å–ø—Ä–∞–≤–∞ (–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó $f$).</p>
                        <ul>
                            <li>–Ø–∫—â–æ $f$ –ª—ñ–Ω—ñ–π–Ω–∞ ($f = Ay$), –º–∏ –º–æ–∂–µ–º–æ –≤–∏—Ä–∞–∑–∏—Ç–∏ $y_{n+1}$ –∞–ª–≥–µ–±—Ä–∞—ó—á–Ω–æ: $y_{n+1} = (I - hA)^{-1}y_n$.</li>
                            <li>–Ø–∫—â–æ $f$ <b>–Ω–µ–ª—ñ–Ω—ñ–π–Ω–∞</b> (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, $y^2$, $\sin(y)$, —è–∫ —É –í–∞–Ω –¥–µ—Ä –ü–æ–ª—è), –∞–ª–≥–µ–±—Ä–∞—ó—á–Ω–æ –∑–Ω–∞–π—Ç–∏ $y_{n+1}$ –Ω–µ–º–æ–∂–ª–∏–≤–æ.</li>
                        </ul>
                        <p>–¢–æ–º—É –Ω–∞ <b>–∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ</b> –∫–æ–º–ø'—é—Ç–µ—Ä —Ä–æ–∑–≤'—è–∑—É—î —Ä—ñ–≤–Ω—è–Ω–Ω—è $G(z) = 0$ —á–∏—Å–µ–ª—å–Ω–æ (–∑–∞–∑–≤–∏—á–∞–π –º–µ—Ç–æ–¥–æ–º –ù—å—é—Ç–æ–Ω–∞):
                        $$z - y_n - h \cdot f(t_{n+1}, z) = 0$$
                        –¶–µ –≤–∏–º–∞–≥–∞—î –±—ñ–ª—å—à–µ —á–∞—Å—É –Ω–∞ –∫—Ä–æ–∫, –∞–ª–µ –¥–æ–∑–≤–æ–ª—è—î —Ä–æ–±–∏—Ç–∏ –∫—Ä–æ–∫ $h$ –¥—É–∂–µ –≤–µ–ª–∏–∫–∏–º –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ —Å—Ç—ñ–π–∫–æ—Å—Ç—ñ.</p>
                    </div>

                    <h3>3. –ú–µ—Ç–æ–¥ –†—É–Ω–≥–µ-–ö—É—Ç—Ç–∞ 4 (RK4)</h3>
                    <div class="method-card">
                        <p>–ó–æ–ª–æ—Ç–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç (4-–π –ø–æ—Ä—è–¥–æ–∫). –†–æ–±–∏—Ç—å 4 –ø—Ä–æ–±–Ω—ñ –∫—Ä–æ–∫–∏:</p>
                        <div class="formula-box">
                            $k_1 = f(t_n, y_n)$<br>
                            $k_2 = f(t_n + \frac{h}{2}, y_n + \frac{h}{2}k_1)$<br>
                            $k_3 = f(t_n + \frac{h}{2}, y_n + \frac{h}{2}k_2)$<br>
                            $k_4 = f(t_n + h, y_n + h k_3)$<br>
                            $y_{n+1} = y_n + \frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4)$
                        </div>
                    </div>

                    <h3>4. –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫ (Adaptive Step)</h3>
                    <p>–ó–∞–º—ñ—Å—Ç—å —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ–≥–æ $h$, –∞–ª–≥–æ—Ä–∏—Ç–º –æ–±—á–∏—Å–ª—é—î –ø–æ—Ö–∏–±–∫—É –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ (–ø–æ—Ä—ñ–≤–Ω—é—é—á–∏ —Ä—ñ—à–µ–Ω–Ω—è RK4 —ñ RK5, –∞–±–æ –ø–æ–¥–≤–æ—î–Ω–∏–π –∫—Ä–æ–∫). 
                    $$h_{new} = h_{old} \cdot 0.9 \cdot \left( \frac{\text{Tolerance}}{\text{Error}} \right)^{1/5}$$
                    –î–ª—è –∂–æ—Ä—Å—Ç–∫–∏—Ö –∑–∞–¥–∞—á (–í–∞–Ω –¥–µ—Ä –ü–æ–ª—å) –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π –º–µ—Ç–æ–¥ –±—É–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–º–µ–Ω—à—É–≤–∞—Ç–∏ –∫—Ä–æ–∫ –¥–æ –º—ñ–∫—Ä–æ—Å–∫–æ–ø—ñ—á–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å ($10^{-5}$) –Ω–∞ –∫—Ä—É—Ç–∏—Ö –¥—ñ–ª—è–Ω–∫–∞—Ö.</p>
                </div>
            </details>
			
            <details open>
                <summary>–î–æ–¥–∞—Ç–∫–æ–≤–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞: –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫ —Ç–∞ –ñ–æ—Ä—Å—Ç–∫—ñ—Å—Ç—å</summary>
                <div class="theory-content">
                    <h3>1. –Ø–∫ –ø—Ä–∞—Ü—é—î –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫?</h3>
                    <p>–Ü–¥–µ—è: –Ω–∞ –∫–æ–∂–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –º–∏ —Ä–æ–±–∏–º–æ –æ–¥–∏–Ω –≤–µ–ª–∏–∫–∏–π –∫—Ä–æ–∫ $h$ —ñ –¥–≤–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö –∫—Ä–æ–∫–∏ $h/2$. –†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –æ—Ç—Ä–∏–º–∞–Ω–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ ‚Äî —Ü–µ –Ω–∞—à–∞ –æ—Ü—ñ–Ω–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ—ó –ø–æ–º–∏–ª–∫–∏ ($E$).</p>
                    
                    <div class="formula-box">
                        $$h_{new} = h_{old} \cdot S \cdot \left( \frac{Tol}{E} \right)^{\frac{1}{p+1}}$$
                    </div>
                    
                    <div class="formula-expl">
                        <ul>
                            <li><b>$h_{old}$</b> ‚Äî –ø–æ—Ç–æ—á–Ω–∏–π –∫—Ä–æ–∫.</li>
                            <li><b>$S = 0.9$</b> ‚Äî "—Ñ–∞–∫—Ç–æ—Ä —Å—Ç—Ä–∞—Ö—É" (safety factor). –ú–∏ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –±–µ—Ä–µ–º–æ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π –º–∞–∫—Å–∏–º—É–º, –∑–∞–ª–∏—à–∞—î–º–æ 10% –∑–∞–ø–∞—Å—É.</li>
                            <li><b>$Tol$</b> ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å (Tolerance, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ $10^{-4}$).</li>
                            <li><b>$E$</b> ‚Äî —Ä–µ–∞–ª—å–Ω–∞ –æ–±—á–∏—Å–ª–µ–Ω–∞ –ø–æ—Ö–∏–±–∫–∞ –Ω–∞ –ø–æ—Ç–æ—á–Ω–æ–º—É –∫—Ä–æ—Ü—ñ.</li>
                            <li><b>$p=4$</b> ‚Äî –ø–æ—Ä—è–¥–æ–∫ –º–µ—Ç–æ–¥—É (–¥–ª—è RK4). –°—Ç–µ–ø—ñ–Ω—å $1/5$ –æ–∑–Ω–∞—á–∞—î: —è–∫—â–æ –ø–æ–º–∏–ª–∫–∞ –∑–º–µ–Ω—à–∏–ª–∞—Å—å —É $10^5$ —Ä–∞–∑—ñ–≤, –∫—Ä–æ–∫ –º–æ–∂–Ω–∞ –∑–±—ñ–ª—å—à–∏—Ç–∏ –ª–∏—à–µ —É 10 —Ä–∞–∑—ñ–≤.</li>
                        </ul>
                    </div>

                    <h3>2. –ß–æ–º—É –∫—Ä–æ–∫ –Ω–µ –∑—Ä–æ—Å—Ç–∞—î –Ω–∞ –ø—Ä—è–º–∏—Ö (–ñ–æ—Ä—Å—Ç–∫—ñ –∑–∞–¥–∞—á—ñ)?</h3>
                    <p>–í–∏ –º–æ–≥–ª–∏ –ø–æ–º—ñ—Ç–∏—Ç–∏: —É –∑–∞–¥–∞—á—ñ <b>–í–∞–Ω –¥–µ—Ä –ü–æ–ª—è</b> –∞–±–æ <b>–®–≤–∏–¥–∫–æ—ó —Ä–µ–ª–∞–∫—Å–∞—Ü—ñ—ó</b> –≥—Ä–∞—Ñ—ñ–∫ —Å—Ç–∞—î –º–∞–π–∂–µ —Ä—ñ–≤–Ω–∏–º, –∞–ª–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π –º–µ—Ç–æ–¥ (Explicit RK) –Ω–µ –∑–±—ñ–ª—å—à—É—î –∫—Ä–æ–∫. –¶–µ –Ω–µ –ø–æ–º–∏–ª–∫–∞, —Ü–µ —Ñ—ñ–∑–∏–∫–∞!</p>
                    <p><b>–ü—Ä–∏—á–∏–Ω–∞: –°—Ç—ñ–π–∫—ñ—Å—Ç—å (Stability).</b></p>
                    <p>–ù–∞–≤—ñ—Ç—å —è–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–≥–ª—è–¥–∞—î —è–∫ –ø—Ä—è–º–∞ –ª—ñ–Ω—ñ—è, –∂–æ—Ä—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–∞ –º–∞—î –¥—É–∂–µ –≤–µ–ª–∏–∫—É "–ø—Ä—É–∂–∏–Ω—É" –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ (–≤–µ–ª–∏–∫–µ –≤–ª–∞—Å–Ω–µ —á–∏—Å–ª–æ $\lambda$). –î–ª—è —è–≤–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ —ñ—Å–Ω—É—î –∂–æ—Ä—Å—Ç–∫–∏–π –ª—ñ–º—ñ—Ç:
                    $$h < \frac{C}{|\lambda|}$$
                    –Ø–∫—â–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–±—ñ–ª—å—à–∏—Ç–∏ –∫—Ä–æ–∫ –≤–∏—â–µ —Ü—å–æ–≥–æ –ª—ñ–º—ñ—Ç—É (–±–æ –≥—Ä–∞—Ñ—ñ–∫ —Ä—ñ–≤–Ω–∏–π), —á–∏—Å–µ–ª—å–Ω–∏–π —Ä–æ–∑–≤'—è–∑–æ–∫ –º–∏—Ç—Ç—î–≤–æ –≤–∏–±—É—Ö–Ω–µ. –¢–æ–º—É –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º "–≤—ñ–¥—á—É–≤–∞—î" —Ü–µ–π –≤–∏–±—É—Ö –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —ñ –∑–º—É—à–µ–Ω–∏–π —Ç—Ä–∏–º–∞—Ç–∏ –∫—Ä–æ–∫ –º—ñ–∫—Ä–æ—Å–∫–æ–ø—ñ—á–Ω–∏–º.</p>
                </div>
            </details>
        </section>
    </div>
</div>

<script>
    // ==========================================
    // 1. –ú–û–î–ï–õ–Ü –¢–ê –ï–¢–ê–õ–û–ù–ò
    // ==========================================
    
    function generateGroundTruth(f, y0, T, dt=0.002) {
        const tArr = [0];
        const yArr = [y0[0]];
        let t = 0;
        let y = [...y0];
        while(t < T) {
            const k1 = f(t, y);
            const k2 = f(t + dt/2, y.map((v,i)=>v + k1[i]*dt/2));
            const k3 = f(t + dt/2, y.map((v,i)=>v + k2[i]*dt/2));
            const k4 = f(t + dt, y.map((v,i)=>v + k3[i]*dt));
            y = y.map((v,i) => v + (dt/6)*(k1[i] + 2*k2[i] + 2*k3[i] + k4[i]));
            t += dt;
            tArr.push(t);
            yArr.push(y[0]);
        }
        return { t: tArr, y: yArr };
    }

    const presets = {
        decay: {
            label: "–°–ø–∞–¥–Ω–∞ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞",
            tex: "$y' = -y$",
            f: (t, y) => [-y[0]],
            getExact: (T) => {
                const t=[], y=[]; 
                for(let i=0; i<=T; i+=T/200) { t.push(i); y.push(Math.exp(-i)); }
                return {t, y};
            },
            y0: [1], defaultT: 10,
            hint: "–ü—Ä–æ—Å—Ç–∞ –∑–∞–¥–∞—á–∞. –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫ —Ç—É—Ç –±—É–¥–µ —à–≤–∏–¥–∫–æ –∑—Ä–æ—Å—Ç–∞—Ç–∏, –±–æ –∫—Ä–∏–≤–∞ —Å—Ç–∞—î –ø–æ–ª–æ–≥–æ—é, —ñ –Ω–µ–º–∞—î –ø—Ä–æ–±–ª–µ–º –∑—ñ —Å—Ç—ñ–π–∫—ñ—Å—Ç—é."
        },
        growth: {
            label: "–ó—Ä–æ—Å—Ç–∞—é—á–∞ –µ–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞",
            tex: "$y' = y$",
            f: (t, y) => [y[0]],
            getExact: (T) => {
                const t=[], y=[];
                for(let i=0; i<=T; i+=T/200) { t.push(i); y.push(0.1*Math.exp(i)); }
                return {t, y};
            },
            y0: [0.1], defaultT: 5,
            hint: "–ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫ –±—É–¥–µ –∑–º–µ–Ω—à—É–≤–∞—Ç–∏—Å—å –∑ —á–∞—Å–æ–º, —â–æ–± –∫–æ–º–ø–µ–Ω—Å—É–≤–∞—Ç–∏ —Å—Ç—Ä—ñ–º–∫–µ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó."
        },
        damped_osc: {
            label: "–ó–∞–≥–∞—Å–∞—é—á–∏–π –æ—Å—Ü–∏–ª—è—Ç–æ—Ä",
            tex: "$y'' + 0.5y' + 5y = 0$",
            f: (t, y) => [y[1], -5*y[0] - 0.5*y[1]], 
            getExact: (T) => {
                const t=[], y=[];
                const a=0.25, b=Math.sqrt(4.9375);
                for(let i=0; i<=T; i+=T/500) { t.push(i); y.push(Math.exp(-a*i)*(Math.cos(b*i)+(a/b)*Math.sin(b*i))); }
                return {t, y};
            },
            y0: [1, 0], defaultT: 15,
            hint: "–Ü–¥–µ–∞–ª—å–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∫—Ä–æ–∫—É! –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É: –Ω–∞ –ø—ñ–∫–∞—Ö —Ç–æ—á–∫–∏ –≥—É—Å—Ç—ñ (–∫—Ä–æ–∫ –º–∞–ª–∏–π), –∞ –º—ñ–∂ –Ω–∏–º–∏ ‚Äî —Ä—ñ–¥–∫—ñ (–∫—Ä–æ–∫ –≤–µ–ª–∏–∫–∏–π)."
        },
        vanderpol: {
            label: "–û—Å—Ü–∏–ª—è—Ç–æ—Ä –í–∞–Ω –¥–µ—Ä –ü–æ–ª—è",
            tex: "$y'' - 4(1-y^2)y' + y = 0$",
            f: (t, y) => [y[1], 4 * (1 - y[0]*y[0]) * y[1] - y[0]],
            getExact: (T) => generateGroundTruth((t, y) => [y[1], 4*(1-y[0]*y[0])*y[1]-y[0]], [2, 0], T),
            y0: [2, 0], defaultT: 20,
            hint: "<b>–ñ–æ—Ä—Å—Ç–∫–∞ –∑–∞–¥–∞—á–∞!</b> –ù–∞ –ø–æ–ª–æ–≥–∏—Ö –¥—ñ–ª—è–Ω–∫–∞—Ö –∫—Ä–æ–∫ –ù–ï —Ä–æ—Å—Ç–µ. –¶–µ —Ç–æ–º—É, —â–æ —è–≤–Ω–∏–π –º–µ—Ç–æ–¥ –æ–±–º–µ–∂–µ–Ω–∏–π <i>—Å—Ç—ñ–π–∫—ñ—Å—Ç—é</i>, –∞ –Ω–µ —Ç–æ—á–Ω—ñ—Å—Ç—é. –Ø–∫–±–∏ –≤—ñ–Ω –≤–∏—Ä—ñ—Å, —Ä—ñ—à–µ–Ω–Ω—è –± –≤–∏–±—É—Ö–Ω—É–ª–æ."
        },
        stiff_decay: {
            label: "–®–≤–∏–¥–∫–∞ —Ä–µ–ª–∞–∫—Å–∞—Ü—ñ—è",
            tex: "$y' = -50(y - \\sin t) + \\cos t$",
            f: (t, y) => [-50 * (y[0] - Math.sin(t)) + Math.cos(t)],
            getExact: (T) => {
                const t=[], y=[];
                for(let i=0; i<=T; i+=T/500) { t.push(i); y.push(Math.sin(i) + Math.exp(-50*i)); }
                return {t, y};
            },
            y0: [1], defaultT: 5,
            hint: "–¢—É—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫ –±—É–¥–µ –¥—É–∂–µ –º–∞–ª–∏–º –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –ª—ñ–Ω—ñ—è —Å—Ç–∞–Ω–µ —Å–∏–Ω—É—Å–æ—ó–¥–æ—é. –ü—Ä–∏—á–∏–Ω–∞ —Ç–∞ —Å–∞–º–∞ ‚Äî –æ–±–º–µ–∂–µ–Ω–Ω—è —Å—Ç—ñ–π–∫–æ—Å—Ç—ñ."
        },
        logistic: {
            label: "–õ–æ–≥—ñ—Å—Ç–∏—á–Ω–µ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è",
            tex: "$y' = y(1 - y/10)$",
            f: (t, y) => [y[0] * (1 - y[0] / 10)],
            getExact: (T) => {
                const t=[], y=[];
                for(let i=0; i<=T; i+=T/200) { t.push(i); y.push(10/(1+99*Math.exp(-i))); }
                return {t, y};
            },
            y0: [0.1], defaultT: 12,
            hint: "–¢—É—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π –∫—Ä–æ–∫ –ø—Ä–∞—Ü—é—î –∫–ª–∞—Å–∏—á–Ω–æ: –º–∞–ª–∏–π –Ω–∞ –ø—ñ–¥–π–æ–º—ñ, –≤–µ–ª–∏–∫–∏–π –Ω–∞ –ø–ª–∞—Ç–æ (–Ω–∞—Å–∏—á–µ–Ω–Ω—ñ)."
        },
        hyperbola: {
            label: "–°–∏–Ω–≥—É–ª—è—Ä–Ω—ñ—Å—Ç—å",
            tex: "$y' = y^2$",
            f: (t, y) => [y[0]*y[0]],
            getExact: (T) => {
                const t=[], y=[];
                for(let i=0; i<=T; i+=0.002) { if(i>=0.99) break; t.push(i); y.push(1/(1-i)); }
                return {t, y};
            },
            y0: [1], defaultT: 0.95,
            hint: "–ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –º–µ—Ç–æ–¥ –±—É–¥–µ –∑–º–µ–Ω—à—É–≤–∞—Ç–∏ –∫—Ä–æ–∫ –¥–æ –Ω—É–ª—è, –Ω–∞–º–∞–≥–∞—é—á–∏—Å—å –Ω–∞–º–∞–ª—é–≤–∞—Ç–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É –∞—Å–∏–º–ø—Ç–æ—Ç—É. <b>–ö–æ–ª–∏ –∫—Ä–æ–∫ —Å—Ç–∞—î –º–µ–Ω—à–∏–º –∑–∞ 1e-7, —Å–∏–º—É–ª—è—Ü—ñ—è –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è.</b>"
        }
    };

    // ==========================================
    // 2. –Ø–î–†–û SOLVER
    // ==========================================
    function add(v1, v2) { return v1.map((x, i) => x + v2[i]); }
    function scale(v, s) { return v.map(x => x * s); }

    const Solvers = {
        euler_explicit: (f, t0, y0, h, duration) => {
            let t=t0, y=[...y0];
            const res={t:[t], y:[y]};
            while(t<duration) {
                y = add(y, scale(f(t, y), h));
                t+=h;
                res.t.push(t); res.y.push(y);
                if(Math.abs(y[0])>1e6 || !isFinite(y[0])) break;
            }
            return res;
        },
        euler_implicit: (f, t0, y0, h, duration) => {
            let t=t0, y=[...y0];
            const res={t:[t], y:[y]};
            while(t<duration) {
                let t_next = t+h;
                let y_next = [...y];
                for(let iter=0; iter<10; iter++) {
                    const f_val = f(t_next, y_next);
                    const F = y_next.map((v, i) => v - y[i] - h * f_val[i]);
                    const delta = 1e-5;
                    const y_pert = [...y_next];
                    for(let k=0; k<y.length; k++) {
                        y_pert[k]+=delta;
                        const dfdy = (f(t_next, y_pert)[k] - f_val[k])/delta;
                        y_pert[k]-=delta;
                        y_next[k] -= F[k] / ((1 - h*dfdy) || 1e-9);
                    }
                    if(Math.abs(F[0]) < 1e-6) break;
                }
                y=y_next; t=t_next;
                res.t.push(t); res.y.push(y);
                if(Math.abs(y[0])>1e6 || !isFinite(y[0])) break;
            }
            return res;
        },
        rk4: (f, t0, y0, h, duration) => {
            let t=t0, y=[...y0];
            const res={t:[t], y:[y]};
            while(t<duration) {
                const k1=f(t, y);
                const k2=f(t+h/2, add(y, scale(k1, h/2)));
                const k3=f(t+h/2, add(y, scale(k2, h/2)));
                const k4=f(t+h, add(y, scale(k3, h)));
                y = add(y, scale(add(add(k1, scale(k2, 2)), add(scale(k3, 2), k4)), h/6));
                t+=h;
                res.t.push(t); res.y.push(y);
                if(Math.abs(y[0])>1e6 || !isFinite(y[0])) break;
            }
            return res;
        },
        rk_adaptive: (f, t0, y0, h_init, duration) => {
            let t=t0, y=[...y0], h=h_init;
            const res={t:[t], y:[y]};
            const tol=1e-4; 
            
            while(t < duration) {
                if(t+h > duration) h = duration-t;
                
                // Step Doubling
                const rk = (tc, yc, hc) => {
                    const k1=f(tc, yc);
                    const k2=f(tc+hc/2, add(yc, scale(k1, hc/2)));
                    const k3=f(tc+hc/2, add(yc, scale(k2, hc/2)));
                    const k4=f(tc+hc, add(yc, scale(k3, hc)));
                    return add(yc, scale(add(add(k1, scale(k2, 2)), add(scale(k3, 2), k4)), hc/6));
                };
                
                const y1 = rk(t, y, h);       // One big step
                const y2 = rk(t+h/2, rk(t, y, h/2), h/2); // Two small steps
                
                let err = 0;
                for(let k=0; k<y.length; k++) err = Math.max(err, Math.abs(y1[k]-y2[k]));
                if(err === 0) err = 1e-20; 
                
                // Formula: h_new = h * S * (Tol/Err)^(1/5)
                let scaleFactor = 0.9 * Math.pow(tol/err, 0.2);
                scaleFactor = Math.min(Math.max(scaleFactor, 0.1), 10.0);
                
                const h_new = h * scaleFactor;
                
                if(err < tol) {
                    // Accept step
                    t += h;
                    y = y2; 
                    res.t.push(t); res.y.push(y);
                }
                
                // Update h for next attempt
                h = h_new;
                
                // --- BUG FIX FOR FREEZING ---
                // If step becomes extremely small (singularity hit), ABORT.
                // Do not clamp min to 1e-5, allow it to go low, but stop if too low.
                if (h < 1e-7) {
                    break; // Stop simulation, we hit a wall
                }
                
                // Clamp max step only
                if(h > 2.0) h = 2.0;
                
                if(res.t.length > 5000) break; 
                if(Math.abs(y[0]) > 1e12) break;
            }
            return res;
        }
    };

    // ==========================================
    // 3. UI & PLOTTING
    // ==========================================
    const stepSlider = document.getElementById('stepSlider');
    const durationSlider = document.getElementById('durationSlider');
    const presetSelect = document.getElementById('presetSelect');
    const methodSelect = document.getElementById('methodSelect');
    const hintBox = document.getElementById('hintBox');

    function getStepFromSlider(val) {
        const minv = Math.log(0.001), maxv = Math.log(1.5);
        const s = (maxv - minv) / 100;
        return Math.exp(minv + s * val);
    }
    function setSliderFromStep(step) {
         const minv = Math.log(0.001), maxv = Math.log(1.5);
         const s = (maxv - minv) / 100;
         return (Math.log(step) - minv) / s;
    }

    function updateSimulation() {
        const pKey = presetSelect.value;
        const mKey = methodSelect.value;
        const h = getStepFromSlider(stepSlider.value);
        const T = parseFloat(durationSlider.value);
        
        document.getElementById('stepValDisplay').innerText = h.toFixed(4);
        document.getElementById('durationDisplay').innerText = T.toFixed(1);
        
        const stepLabel = document.getElementById('stepLabel');
        stepLabel.innerHTML = mKey === 'rk_adaptive' ? "–ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∫—Ä–æ–∫ ($h_0$)" : "–ö—Ä–æ–∫ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞–Ω–Ω—è ($h$)";
        if(window.MathJax) MathJax.typesetPromise([stepLabel]);

        const sys = presets[pKey];
        const res = Solvers[mKey](sys.f, 0, sys.y0, h, T);
        const truth = sys.getExact(T);
        
        // Viewport clamping to Truth
        let minY = Infinity, maxY = -Infinity;
        for(let v of truth.y) { if(v<minY) minY=v; if(v>maxY) maxY=v; }
        if(!isFinite(minY)) minY = -10; if(!isFinite(maxY)) maxY = 10;
        if(minY===maxY) { minY-=1; maxY+=1; }
        const pad = (maxY-minY)*0.2;
        const range = [Math.max(minY-pad, -1000), Math.min(maxY+pad, 1000)];

        const traceExact = {
            x: truth.t, y: truth.y, mode: 'lines', name: '–ï—Ç–∞–ª–æ–Ω',
            line: { color: '#2c3e50', width: 3 }
        };
        const traceNum = {
            x: res.t, y: res.y.map(v=>v[0]), mode: 'markers+lines', name: '–ß–∏—Å–µ–ª—å–Ω–∏–π',
            marker: { size: 4, color: '#e74c3c', opacity: 0.8 },
            line: { color: 'rgba(231, 76, 60, 0.4)', width: 1 }
        };

        const layout = {
            margin: { t: 20, r: 20, b: 40, l: 60 },
            showlegend: false,
            xaxis: { title: '$t$' },
            yaxis: { title: '$y(t)$', range: range },
            hovermode: 'closest', template: 'plotly_white'
        };

        Plotly.react('plotDiv', [traceExact, traceNum], layout, {responsive: true});
        document.getElementById('stepCount').innerText = res.t.length;
        
        let errTxt = "calc...";
        if(res.y.length < 5000 && Math.abs(res.y[res.y.length-1][0]) < 1e5) {
             errTxt = "OK";
             if(Math.abs(res.y[res.y.length-1][0]) > 1e4) errTxt = "High";
        } else { errTxt = "Overflow"; }
        document.getElementById('maxError').innerText = errTxt;

        if(sys.hint) {
            hintBox.style.display = 'block';
            hintBox.innerHTML = "üí° " + sys.hint;
        } else hintBox.style.display = 'none';
    }

    stepSlider.addEventListener('input', updateSimulation);
    durationSlider.addEventListener('input', updateSimulation);
    methodSelect.addEventListener('change', updateSimulation);
    presetSelect.addEventListener('change', () => {
        const p = presets[presetSelect.value];
        const fd = document.getElementById('formulaDisplay');
        fd.innerHTML = p.tex;
        if(window.MathJax) MathJax.typesetPromise([fd]);
        durationSlider.value = p.defaultT;
        updateSimulation();
    });

    setSliderFromStep(0.1);
    presetSelect.dispatchEvent(new Event('change'));
</script>
</body>
</html>