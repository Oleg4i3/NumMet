<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∞–≥—Ä–∞–Ω–∂</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['\\(', '\\)']], displayMath: [['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>

    <style>
        /* --- GLOBAL & TRANSITIONS --- */
        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            transition: background 0.5s ease, color 0.5s ease;
            font-family: 'Segoe UI', sans-serif;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.5s ease;
            position: relative;
        }

        /* --- THEME 1: ACADEMIC (Notebook) --- */
        body.theme-study {
            background-color: #f0f2f5;
            color: #2c3e50;
            font-family: 'Georgia', serif;
        }
        .theme-study .container {
            background: #ffffff;
            background-image: linear-gradient(#e1e1e1 1px, transparent 1px), linear-gradient(90deg, #e1e1e1 1px, transparent 1px);
            background-size: 20px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #d1d1d1;
        }
        .theme-study h2 { border-left: 5px solid #34495e; color: #2c3e50; }
        .theme-study .btn-action { background: #34495e; color: white; border-radius: 2px; }
        .theme-study .info-box { background: #f9f9f9; color: #333; }
        
    /* --- THEME 2: SECRET (Mission Impossible / Nuclear Football) --- */
        body.theme-secret {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Segoe UI', 'Roboto', Helvetica, Arial, sans-serif;
            background-image: radial-gradient(circle at center, #1c1c1c 0%, #000000 100%);
        }
        .theme-secret .container {
            background: #1e1e1e;
            border: 1px solid #333;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            border-top: 4px solid #d32f2f; /* Red alert line */
        }
        
        /* Typography & Headers */
       .theme-secret h2 {
            text-transform: uppercase;
            font-weight: 900;
            font-style: italic; /* <--- –î–û–î–ê–ù–û –ö–£–†–°–ò–í */
            letter-spacing: 2px;
            color: #d32f2f; /* Danger Red */
            border-bottom: 2px solid #d32f2f;
            text-shadow: 0 0 10px rgba(211, 47, 47, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .theme-secret h2::after {
            content: "‚ö† TOP SECRET // EYES ONLY";
            font-size: 0.6rem;
            background: #d32f2f;
            color: black;
            padding: 2px 6px;
            border-radius: 2px;
            vertical-align: middle;
        }

        /* Buttons & Inputs */
        .theme-secret .btn-action {
            background: linear-gradient(180deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            border: 1px solid #ff5252;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .theme-secret .btn-action:hover {
            background: #f44336;
            box-shadow: 0 0 15px rgba(244, 67, 54, 0.6);
        }
        .theme-secret input {
            background: #000;
            color: #d32f2f;
            border: 1px solid #555;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        /* Info Boxes */
        .theme-secret .info-box {
            background: rgba(40, 40, 40, 0.9);
            /*border-left: 4px solid #ffeb3b; //Warning Yellow */
            color: #ccc;
            font-family: 'Courier New', monospace;
        }

        /* Tab Navigation */
        .theme-secret .tab { background: #2c2c2c; color: #888; border-bottom: 1px solid #444; }
        .theme-secret .tab.active { 
            background: #1e1e1e; 
            color: #d32f2f; 
            border-top: 3px solid #d32f2f;
            border-bottom: none;
        }

        /* Graph Area */
        .theme-secret .graph-wrapper {
            background: #111;
            border: 1px solid #444;
            /* Grid overlay effect */
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .theme-secret .controls {
            background: #252525;
            border: 1px solid #333;
            border-radius: 4px;
        }

        /* Keys (Chips) */
        .theme-secret .key-card {
            background: #000;
            border: 1px solid #555;
            color: #03a9f4; /* Cyan for tech data */
            font-family: 'Orbitron', 'Courier New', sans-serif;
            position: relative;
            overflow: hidden;
        }
        .theme-secret .key-card:hover { border-color: #03a9f4; box-shadow: 0 0 10px rgba(3, 169, 244, 0.3); }
        .theme-secret .key-card.selected {
            background: rgba(3, 169, 244, 0.2);
            border: 1px solid #03a9f4;
            color: #fff;
        }
        /* Corner marker for keys */
        .theme-secret .key-card::before {
            content: ''; position: absolute; top: 0; right: 0;
            width: 0; height: 0; 
            border-style: solid; border-width: 0 10px 10px 0; 
            border-color: transparent #555 transparent transparent;
        }

        /* Red Button Area */
        .theme-secret .red-button-ui {
            background: radial-gradient(circle at 30% 30%, #ff1744, #b71c1c);
            border: 3px solid #5d4037; /* Dark bezel */
            box-shadow: 
                0 0 0 4px #222, /* Inner gap */
                0 0 0 6px #d32f2f, /* Danger ring */
                0 0 20px rgba(255, 0, 0, 0.6); /* Glow */
            color: white;
            font-size: 2.5rem;
        }
        /* Hazard Strip Effect for Spoiler Summary */
        .theme-secret summary {
            background: repeating-linear-gradient(
                45deg,
                #222,
                #222 10px,
                #333 10px,
                #333 20px
            );
            color: #fff;
            text-transform: uppercase;
            font-size: 0.9rem;
            border: 1px solid #444;
        }
		
        /* --- THEME 3: QR (Coffee Shop) --- */
        body.theme-qr {
            background-color: #f3e5ab; /* Parchment */
            color: #5d4037;
            font-family: 'Verdana', sans-serif;
        }
        .theme-qr .container {
            background: #fff8e1;
            box-shadow: 0 10px 30px rgba(93, 64, 55, 0.2);
            border: none;
            /* Coffee Stain Effect */
            background-image: radial-gradient(circle at 80% 20%, rgba(121, 85, 72, 0.1) 0%, rgba(121, 85, 72, 0.05) 40%, transparent 70%);
        }
        .theme-qr h2 { color: #795548; font-weight: normal; border-left: none; text-decoration: underline wavy #ffab91; }
        .theme-qr .btn-action { background: #ffab91; color: #3e2723; border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .theme-qr .btn-action:hover { background: #ffccbc; transform: translateY(-2px); }
        .theme-qr .info-box { background: #efebe9; border-radius: 12px; border: 1px solid #d7ccc8; color: #4e342e; }
        .theme-qr .packet { border-radius: 50%; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }

        /* --- COMMON UI --- */
        .tabs { display: flex; overflow: hidden; }
        .tab {
            flex: 1; padding: 20px; border: none; cursor: pointer; font-size: 1rem; font-weight: bold;
            transition: 0.3s; opacity: 0.7;
        }
        .tab:hover { opacity: 1; }
        .tab.active { opacity: 1; text-decoration: underline; }
        
        /* Tab Colors based on Theme Logic (JS sets inline, but here are defaults) */
        .theme-study .tab { background: #e0e0e0; color: #333; }
        .theme-study .tab.active { background: #fff; border-top: 3px solid #34495e; }
        
        .theme-secret .tab { background: #111; color: #005500; border-bottom: 1px solid #00ff00; }
        .theme-secret .tab.active { background: #001100; color: #00ff00; border: 1px solid #00ff00; border-bottom: none; }
        
        .theme-qr .tab { background: #d7ccc8; color: #5d4037; }
        .theme-qr .tab.active { background: #fff8e1; color: #3e2723; }

        .content { display: none; padding: 30px; animation: fadeIn 0.5s; }
        .content.active { display: block; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

        .controls { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; margin-bottom: 20px; padding: 15px; border-radius: 8px; }
        .theme-study .controls { background: #fff; border: 1px solid #ccc; }
        .theme-secret .controls { background: rgba(0, 50, 0, 0.3); border: 1px solid #004400; }
        .theme-qr .controls { background: rgba(255, 255, 255, 0.6); border-radius: 20px; }

        .graph-wrapper { position: relative; height: 400px; width: 100%; border-radius: 8px; overflow: hidden; background: white; }
        .theme-secret .graph-wrapper { background: #000; border: 1px solid #004400; }
        .theme-qr .graph-wrapper { background: #fff; border: 4px solid #fff; box-shadow: inset 0 0 20px rgba(0,0,0,0.05); }

        button { padding: 10px 20px; border: none; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        input { padding: 8px; border-radius: 4px; width: 80px; text-align: center; }

        /* Specific UI Elements */
        .spoiler { margin-top: 20px; border-radius: 4px; overflow: hidden; }
        .spoiler summary { padding: 10px; cursor: pointer; font-weight: bold; list-style: none; }
        .spoiler-body { padding: 15px; border-top: 1px solid rgba(0,0,0,0.1); }
        
        .theme-study .spoiler { border: 1px solid #ccc; }
        .theme-study summary { background: #e9e9e9; }
        
        .theme-secret .spoiler { border: 1px solid #00ff00; }
        .theme-secret summary { background: #002200; color: #00ff00; }
        .theme-secret summary::marker { color: #00ff00; }
        
        .theme-qr .spoiler { background: #fff3e0; border-left: 4px solid #ffab91; }
        .theme-qr summary { color: #d84315; }

        /* Secret Keys */
        .key-card { padding: 10px; margin: 5px; cursor: pointer; border: 1px solid transparent; min-width: 60px; text-align: center; }
        .theme-secret .key-card { border: 1px solid #005500; color: #008800; }
        .theme-secret .key-card:hover { border-color: #00ff00; box-shadow: 0 0 10px #00ff00; }
        .theme-secret .key-card.selected { background: #00ff00; color: black; font-weight: bold; box-shadow: 0 0 15px #00ff00; }

        /* Red Button */
        .red-button-ui {
            width: 80px; height: 80px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; cursor: pointer; transition: 0.2s; margin: 0 auto;
            border: 4px solid #333;
        }
        .theme-secret .red-button-ui {
            background: radial-gradient(circle at 30% 30%, #ff0000, #550000);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            border-color: #220000;
            color: white;
        }
        .theme-secret .red-button-ui:active { transform: scale(0.95); }

        /* QR Packets */
        .packet {
            width: 60px; height: 70px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; cursor: pointer; transition: 0.3s; margin: 5px;
        }
        .theme-qr .packet { background: #fff; border: 2px solid #8d6e63; color: #5d4037; }
        .theme-qr .packet.parity { background: #fff9c4; border-color: #fbc02d; }
        .theme-qr .packet.damaged { background: #3e2723; color: #ffab91; transform: rotate(10deg); text-decoration: line-through; border-color: #3e2723; }
        .theme-qr .packet.recovered { background: #c8e6c9; border-color: #2e7d32; animation: pop 0.5s; }
        @keyframes pop { 50% { transform: scale(1.2); } }

    </style>
</head>
<body class="theme-study">

<div class="container">
    <div class="tabs">
        <button class="tab active" onclick="setTab('study')">1. –¢–µ–æ—Ä—ñ—è</button>
        <button class="tab" onclick="setTab('secret')">2. –°–ø—ñ–ª—å–Ω–∏–π —Å–µ–∫—Ä–µ—Ç</button>
        <button class="tab" onclick="setTab('qr')">3. –ö–æ–¥–∏ –†—ñ–¥–∞-–°–æ–ª–æ–º–æ–Ω–∞</button>
    </div>

    <!-- TAB 1: ACADEMIC -->
    <div id="study" class="content active">
        <h3>–Ü–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ–π–Ω–∏–π –ø–æ–ª—ñ–Ω–æ–º –õ–∞–≥—Ä–∞–Ω–∂–∞</h3>
        
                
        <div class="info-box">
            <strong>–°—É—Ç—å –º–µ—Ç–æ–¥—É:</strong> –ß–µ—Ä–µ–∑ –±—É–¥—å-—è–∫—ñ \( n \) —Ç–æ—á–æ–∫ –º–æ–∂–Ω–∞ –ø—Ä–æ–≤–µ—Å—Ç–∏ <em>—î–¥–∏–Ω–∏–π</em> —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –ø–æ–ª—ñ–Ω–æ–º —Å—Ç–µ–ø–µ–Ω—è \( n-1 \).
            <br>–õ–∞–≥—Ä–∞–Ω–∂ –ø—Ä–∏–¥—É–º–∞–≤ —Å–ø–æ—Å—ñ–± –∑–∞–ø–∏—Å–∞—Ç–∏ —Ñ–æ—Ä–º—É–ª—É —Ü—å–æ–≥–æ –ø–æ–ª—ñ–Ω–æ–º–∞ –±–µ–∑ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ä—ñ–≤–Ω—è–Ω—å.
        </div>

        <details class="spoiler">
            <summary>–§–æ—Ä–º—É–ª–∞</summary>
			
			<div class="math-block">
                <p>–û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è: —á–µ—Ä–µ–∑ –±—É–¥—å-—è–∫—ñ \( n \) —Ç–æ—á–æ–∫ –º–æ–∂–Ω–∞ –ø—Ä–æ–≤–µ—Å—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –ø–æ–ª—ñ–Ω–æ–º —Å—Ç–µ–ø–µ–Ω—è \( n-1 \).</p>
                <p>–§–æ—Ä–º—É–ª–∞ –ø–æ–ª—ñ–Ω–æ–º–∞ \( L(x) \):</p>
                \[ L(x) = \sum_{j=0}^{k} y_j \ell_j(x) \]
                <p>–î–µ –±–∞–∑–∏—Å–Ω—ñ –ø–æ–ª—ñ–Ω–æ–º–∏ \( \ell_j(x) \) –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è —è–∫:</p>
                \[ \ell_j(x) = \prod_{i=0, i \neq j}^{k} \frac{x - x_i}{x_j - x_i} \]
                <p>–¶—è –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –¥–æ–∑–≤–æ–ª—è—î "–≤–≥–∞–¥—É–≤–∞—Ç–∏" –∑–Ω–∞—á–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó –º—ñ–∂ —Ç–æ—á–∫–∞–º–∏ (—ñ–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è) –∞–±–æ –≤—ñ–¥–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é, —è–∫—â–æ —á–∞—Å—Ç–∏–Ω–∞ —Ç–æ—á–æ–∫ –≤—Ç—Ä–∞—á–µ–Ω–∞.</p>
            </div>
			
            <div class="spoiler-body">
                <p>–§–æ—Ä–º—É–ª–∞ –õ–∞–≥—Ä–∞–Ω–∂–∞ –±—É–¥—É—î—Ç—å—Å—è –∑ "—Ü–µ–≥–ª–∏–Ω–æ–∫" ‚Äî –±–∞–∑–∏—Å–Ω–∏—Ö –ø–æ–ª—ñ–Ω–æ–º—ñ–≤ \( \ell_j(x) \).
                              –¶–µ —Ö–∏—Ç—Ä–∏–π –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ–º–∏–∫–∞—á:</p>
                <ul>
                    <li>–Ø–∫—â–æ \( x = x_j \) (–Ω–∞—à–∞ —Ç–æ—á–∫–∞), –¥—Ä—ñ–± —Å—Ç–∞—î \( 1 \).</li>
                    <li>–Ø–∫—â–æ \( x = x_i \) (—á—É–∂–∞ —Ç–æ—á–∫–∞), —á–∏—Å–µ–ª—å–Ω–∏–∫ —Å—Ç–∞—î \( 0 \), —ñ –≤–µ—Å—å –≤–∏—Ä–∞–∑ –∑–∞–Ω—É–ª—è—î—Ç—å—Å—è.</li>
                </ul>
                <p>–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—î–º–æ –≤–∏—Å–æ—Ç—É \( y_j \), –ø–æ–º–Ω–æ–∂–µ–Ω—É –Ω–∞ —Ü–µ–π –ø–µ—Ä–µ–º–∏–∫–∞—á, —ñ –≥—Ä–∞—Ñ—ñ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ —É—Å—ñ —Ç–æ—á–∫–∏.</p>
            </div>
        </details>

        <details class="spoiler">
            <summary>–û–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å</summary>
            <div class="spoiler-body">
                <p>–ß–æ–º—É –± –Ω–µ –∑–∞–ø–∏—Å–∞—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ä—ñ–≤–Ω—è–Ω—å, –ø—ñ–¥—Å—Ç–∞–≤–ª—è—é—á—ñ –≤—ñ–¥–æ–º—ñ —Ç–æ—á–∫–∏ —É –ø–æ–ª—ñ–Ω–æ–º, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ \( y = ax^2 + bx + c \) —ñ –Ω–µ –∑–Ω–∞–π—Ç–∏ \( a, b, c \)?</p>
                <ul>
                    <li><strong>–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:</strong> –†–æ–∑–≤'—è–∑–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ (–º–µ—Ç–æ–¥ –ì–∞—É—Å–∞) –≤–∏–º–∞–≥–∞—î \( O(n^3) \) –æ–ø–µ—Ä–∞—Ü—ñ–π. –õ–∞–≥—Ä–∞–Ω–∂ –¥–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ \( O(n^2) \).</li>
                    <li><strong>–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å:</strong> –ú–∞—Ç—Ä–∏—Ü—ñ –í–∞–Ω–¥–µ—Ä–º–æ–Ω–¥–∞ (—è–∫—ñ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø—Ä–∏ –°–õ–ê–†) –¥—É–∂–µ "–ø—Ä–∏–º—Ö–ª–∏–≤—ñ" –¥–æ —Ç–æ—á–Ω–æ—Å—Ç—ñ —á–∏—Å–µ–ª. –ö–æ–º–ø'—é—Ç–µ—Ä —à–≤–∏–¥–∫–æ –ø–æ–º–∏–ª–∏—Ç—å—Å—è. –§–æ—Ä–º—É–ª–∞ –õ–∞–≥—Ä–∞–Ω–∂–∞ –Ω–∞–±–∞–≥–∞—Ç–æ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—à–∞.</li>
                </ul>
            </div>
        </details>

        <div class="controls">
            <span>–ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫, —â–æ–± –¥–æ–¥–∞—Ç–∏ —Ç–æ—á–∫–∏:</span>
            <button class="btn-action" onclick="study.clear()">–°—Ç–µ—Ä—Ç–∏</button>
        </div>
        
        <div class="graph-wrapper">
            <canvas id="chartStudy"></canvas>
        </div>

       
    </div>

    <!-- TAB 2: SECRET -->
    <div id="secret" class="content">
        <h2>–°–•–ï–ú–ê –†–û–ó–ü–û–î–Ü–õ–£ –°–ï–ö–†–ï–¢–£ –®–ê–ú–Ü–†–ê</h2>
		   <p>
			–£—è–≤—ñ—Ç—å, —â–æ –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –Ω–∞ "—á–µ—Ä–≤–æ–Ω—É –∫–Ω–æ–ø–∫—É", –ø–æ—Ç—Ä—ñ–±–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è —ñ –ø—Ä–∏—Å—É—Ç–Ω—ñ—Å—Ç—å –Ω–µ –º–µ–Ω—à–µ —Ç—Ä—å–æ—Ö –≥–µ–Ω–µ—Ä–∞–ª—ñ–≤.</p>
         <p>  –ú–µ—Ç–æ–¥ —Ä–æ–∑–ø–æ–¥—ñ–ª—É —Å–µ–∫—Ä—Ç–µ—Ç—É –¥–æ–∑–≤–æ–ª—è—î —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ —Å–µ–∫—Ä–µ—Ç (–∫–ª—é—á, –ø–∞—Ä–æ–ª—å, –∫–æ–¥ –¥–æ—Å—Ç—É–ø—É) \( S \) –Ω–∞ \( n \) —á–∞—Å—Ç–∏–Ω —Ç–∞–∫, —â–æ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±—É–¥—å-—è–∫–∏—Ö \( k \) —á–∞—Å—Ç–∏–Ω.
            –ß–∞—Å—Ç–∏–Ω–∏ —Å–µ–∫—Ä–µ—Ç–∞ - —Ç–æ—á–∫–∏ –ø–æ–ª—ñ–Ω–æ–º–∞ –õ–∞–≥—Ä–∞–Ω–∂–∞. –°–µ–∫—Ä–µ—Ç ‚Äî —Ü–µ —Ç–æ—á–∫–∞ –ø–µ—Ä–µ—Ç–∏–Ω—É –≥—Ä–∞—Ñ—ñ–∫–∞ –∑ –≤—ñ—Å—Å—é Y (\( x=0 \)).
        </p>
        
		 <div class="info-box" style="border-color: var(--accent-red); background: rgba(255, 107, 107, 0.1);">
            <strong>–ú–µ—Ç–∞:</strong> –†–æ–∑–¥—ñ–ª–∏—Ç–∏ "–∫–æ–¥ –¥–æ—Å—Ç—É–ø—É" –º—ñ–∂ –ª—é–¥—å–º–∏ —Ç–∞–∫, —â–æ–± –æ–∫—Ä–µ–º–æ –Ω—ñ—Ö—Ç–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–≤, –∞–ª–µ –≥—Ä—É–ø–∞ –º–æ–≥–ª–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∫–æ–¥.
            <br><strong>–°–ø–æ—Å—ñ–±:</strong> –°–µ–∫—Ä–µ—Ç ‚Äî —Ü–µ —Ç–æ—á–∫–∞ –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫—É, –¥–µ \( x=0 \). –ú–∏ –±—É–¥—É—î–º–æ –ø–æ–ª—ñ–Ω–æ–º –õ–∞–≥—Ä–∞–Ω–∂–∞, —â–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç, —ñ —Ä–æ–∑–¥–∞—î–º–æ –ª—é–¥—è–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–æ—á–æ–∫ \( (1, y_1), (2, y_2)... \). –Ø–∫—â–æ —Ü–µ –ª—ñ–Ω—ñ–π–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è (–ø—Ä—è–º–∞), –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±—É–¥—å-—è–∫–∏—Ö –¥–≤–∞—Ö —Ç–æ—á–æ–∫, —è–∫—â–æ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞ (–ø–∞—Ä–∞–±–æ–ª–∞) - –±—É–¥—å-—è–∫–∏—Ö —Ç—Ä—å–æ—Ö —Ç–æ—á–æ–∫ —ñ —Ç.–¥.
        </div>
		
     


		<details class="spoiler">
            <summary>üîê –°–µ–∫—Ä–µ—Ç–Ω—ñ –¥–µ—Ç–∞–ª—ñ</summary>
            <div class="spoiler-body">
                <p>–Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –∑–≤–∏—á–∞–π–Ω–∏–π –ø–æ–ª—ñ–Ω–æ–º –õ–∞–≥—Ä–∞–Ω–∂–∞, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ n-1 –∫–ª—é—á–∞–º–∏ –∑ n –º–æ–∂–µ –ø—Ä–∏–±–ª–∏–∑–Ω–æ –≤–≥–∞–¥–∞—Ç–∏ —Å–µ–∫—Ä–µ—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü—ñ—î—é –∑–∞ –ú–ù–ö –ø–æ–ª—ñ–Ω–æ–º–æ–º –º–µ–Ω—à–æ–≥–æ —Å—Ç–µ–ø–µ–Ω—è). –¢–∞–∫–æ–∂ —á–∏—Å–ª–∞ –º–æ–∂—É—Ç—å —Å—Ç–∞–≤–∞—Ç–∏ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–µ–ª–∏–∫–∏–º–∏, —â–æ –Ω–µ —Ç—ñ–ª—å–∫–∏ —É—Å–∫–ª–∞–¥–Ω—é—î –æ–±—á–∏—Å–ª–µ–Ω–Ω—è, –∞–ª–µ —ñ –¥–∞—î –≤—Ä–∞–∑–ª–∏–≤—ñ—Ç—å —á–µ—Ä–µ–∑ side-channel –∞—Ç–∞–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ –∞–Ω–∞–ª—ñ–∑ —á–∞—Å—É –æ–±—á–∏—Å–ª–µ–Ω—å).</p>
                <p>–¢–æ–º—É –≤ –±–ª–æ–∫—á–µ–π–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å <strong>–ü–æ–ª—è –ì–∞–ª—É–∞ (Finite Fields)</strong>. –¶–µ —Å–≤—ñ—Ç, –¥–µ –Ω–µ–º–∞—î –¥—Ä–æ–±—ñ–≤, –∞ –≥—Ä–∞—Ñ—ñ–∫ –≤–∏–≥–ª—è–¥–∞—î —è–∫ —Ö–º–∞—Ä–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —Ç–æ—á–æ–∫ (–±—ñ–ª–∏–π —à—É–º). –¢–∞–º –Ω–µ–º–æ–∂–ª–∏–≤–æ "–Ω–∞–±–ª–∏–∑–∏—Ç–∏—Å—è" –¥–æ —Å–µ–∫—Ä–µ—Ç—É ‚Äî —Ç–∏ –∞–±–æ –∑–Ω–∞—î—à –π–æ–≥–æ —Ç–æ—á–Ω–æ, –∞–±–æ –Ω–µ –∑–Ω–∞—î—à –∑–æ–≤—Å—ñ–º.</p>
            </div>
        </details>
		
		
        <div class="controls" style="justify-content: center;">
            <div>
                <label>*SECRET CODE:</label>
                <input type="number" id="secretVal" value="42" min="0" max="999">
            </div>
            <div>
                <label>THRESHOLD (–º—ñ–Ω.–∫—ñ–ª—å–∫.–∫–ª—é—á—ñ–≤):</label>
                <input type="number" id="threshold" value="3" min="2" max="5">
            </div>
            <button class="btn-action" onclick="secret.generate()">GENERATE KEYS</button>
        </div>

        <div id="keysArea" style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; min-height: 50px;">
            <span style="color: #005500; font-family: monospace;">Awaiting generation...</span>
        </div>

        <div style="display: flex; gap: 20px; align-items: flex-start; flex-wrap: wrap;">
            <div class="graph-wrapper" style="flex-grow: 1; min-width: 300px;">
                <canvas id="chartSecret"></canvas>
            </div>
            <div style="width: 150px; text-align: center; background: #050505; padding: 20px; border: 1px solid #004400;">
                <div style="color: #00ff00; margin-bottom: 10px;">ACCESS CONTROL</div>
                <div id="redBtn" class="red-button-ui" onclick="secret.restore()">üîí</div>
                <div id="secretResult" style="margin-top: 15px; font-weight: bold; font-size: 1.5rem; color: #004400; font-family: monospace;">---</div>
            </div>
        </div>
    </div>

    <!-- TAB 3: QR -->
    <div id="qr" class="content">
        <h2>–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö (Reed-Solomon)</h2>
        
		
		 <div class="info-box" style="border-color: var(--accent-yellow); background: rgba(254, 202, 87, 0.1);">
            <strong>–ú–µ—Ç–∞:</strong> –ü–µ—Ä–µ–¥–∞—Ç–∏ –¥–∞–Ω—ñ —Ç–∞–∫, —â–æ–± –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—ñ –Ω–æ—Å—ñ—è (—Ñ—ã–∑–∏—á–Ω—ñ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –¥–∏—Å–∫—É, –±—Ä—É–¥ –Ω–∞ QR, –∑–∞–≤–∞–¥–∏ –≤ –∫–∞–Ω–∞–ª—ñ –∑–≤'—è–∑–∫—É) —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –Ω–µ –∑–Ω–∏–∫–ª–∞.
            <br><strong>–°–ø–æ—Å—ñ–±:</strong> –î–∞–Ω—ñ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É—é—Ç—å—Å—è —è–∫ —Ç–æ—á–∫–∏. –ú–∏ –¥–æ–¥–∞—î–º–æ "–∑–∞–π–≤—ñ" —Ç–æ—á–∫–∏. –Ø–∫—â–æ —á–∞—Å—Ç–∏–Ω–∞ —Ç–æ—á–æ–∫ –∑–Ω–∏–∫–∞—î, –º–∏ –±—É–¥—É—î–º–æ –ø–æ–ª—ñ–Ω–æ–º —á–µ—Ä–µ–∑ —Ç—ñ, —â–æ –ª–∏—à–∏–ª–∏—Å—è, —ñ –æ–±—á–∏—Å–ª—é—î–º–æ –≤—Ç—Ä–∞—á–µ–Ω—ñ. 
			–£ –ø—Ä–∏–∫–ª–∞–¥—ñ –Ω–∏–∂—á–µ –º–∏ –º–æ–∂–µ–º–æ –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –ø–∞—Ä–∞–±–æ–ª—É –∑–∞ –±—É–¥—å-—è–∫–∏–º–∏ —Ç—Ä—å–æ–º–∞ —Ç–æ—á–∫–∞–º–∏ –∑ –ø'—è—Ç–∏.
			</div>
		
        <div class="info-box" style="background: rgba(255,255,255,0.7);">
            <p>–£—è–≤—ñ—Ç—å, —â–æ –≤–∏ –ø—Ä–æ–ª–∏–ª–∏ –∫–∞–≤—É –Ω–∞ QR-–∫–æ–¥. –ß–æ–º—É –≤—ñ–Ω –≤—Å–µ —â–µ –ø—Ä–∞—Ü—é—î?
            <br>–ë–æ QR-–∫–æ–¥ –º—ñ—Å—Ç–∏—Ç—å "–∑–∞–π–≤—ñ" —Ç–æ—á–∫–∏, —è–∫—ñ –ª–µ–∂–∞—Ç—å –Ω–∞ —Ç—ñ–π —Å–∞–º—ñ–π –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ–π –∫—Ä–∏–≤—ñ–π, —â–æ –π –¥–∞–Ω—ñ.</p>
        </div>

        <div class="controls">
            <button class="btn-action" style="background: #a1887f; color: white;" onclick="qr.init()">–ù–æ–≤—ñ –¥–∞–Ω—ñ</button>
            <div style="flex-grow: 1; text-align: center; font-style: italic; color: #795548;">
                –ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –±–ª–æ–∫–∏, —â–æ–± "–∑–∞–ø–ª—è–º—É–≤–∞—Ç–∏" —ó—Ö:
            </div>
            <button class="btn-action" onclick="qr.repair()">üõ†Ô∏è –í–∏–ø—Ä–∞–≤–∏—Ç–∏</button>
        </div>

        <div id="packetsContainer" style="display: flex; gap: 10px; justify-content: center; margin: 20px 0; flex-wrap: wrap;"></div>
        
        <!-- NEW GRAPH FOR QR -->
        <div class="graph-wrapper" style="height: 450px; margin-bottom: 20px;">
            <canvas id="chartQR"></canvas>
        </div>

        <details class="spoiler">
            <summary>‚òï –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –≤ —Ä–µ–∞–ª—å–Ω–∏—Ö –∫–æ–¥–∞—Ö –∫–æ—Ä–µ–∫—Ü—ñ—ó –ø–æ–º–∏–ª–æ–∫</summary>
            <div class="spoiler-body">
                <p>–£ —Ü—å–æ–º—É —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–≤–∏—á–∞–π–Ω—ñ —á–∏—Å–ª–∞ —Ç–∞ –ø–∞—Ä–∞–±–æ–ª–∏. –¶–µ –Ω–∞–æ—á–Ω–æ, –∞–ª–µ –º–∞—î –ø—Ä–æ–±–ª–µ–º—É: —á–∏—Å–ª–∞ –º–æ–∂—É—Ç—å —Å—Ç–∞—Ç–∏ –¥—É–∂–µ –≤–µ–ª–∏–∫–∏–º–∏ –∞–±–æ –¥—Ä–æ–±–æ–≤–∏–º–∏.</p>
                <p><strong>–£ —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ (–ö–æ–¥–∏ –†—ñ–¥–∞-–°–æ–ª–æ–º–æ–Ω–∞)</strong> –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å <em>–ü–æ–ª—è –ì–∞–ª—É–∞ (Galois Fields)</em>. –¶–µ "–∫—ñ–ª—å—Ü–µ–≤–∞" –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (—è–∫ –≥–æ–¥–∏–Ω–Ω–∏–∫, –¥–µ –ø—ñ—Å–ª—è 12 –π–¥–µ 1). </p>
                <ul>
                    <li>–£ –ü–æ–ª—è—Ö –ì–∞–ª—É–∞ –Ω–µ–º–∞—î –¥—Ä–æ–±—ñ–≤ (—Ç–æ—á–Ω—ñ—Å—Ç—å —ñ–¥–µ–∞–ª—å–Ω–∞).</li>
                    <li>–ì—Ä–∞—Ñ—ñ–∫ —É –ø–æ–ª—ñ –ì–∞–ª—É–∞ –≤–∏–≥–ª—è–¥–∞—î –Ω–µ —è–∫ –ø–ª–∞–≤–Ω–∞ –ª—ñ–Ω—ñ—è, –∞ —è–∫ —Ö–º–∞—Ä–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —Ç–æ—á–æ–∫ ("–±—ñ–ª–∏–π —à—É–º").</li>
                    <li>–ê–ª–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ –Ω–∏—Ö –≤—Å–µ –æ–¥–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å "–ø–æ–ª—ñ–Ω–æ–º", —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –≤—Ç—Ä–∞—á–µ–Ω—ñ –±–∞–π—Ç–∏.</li>
                </ul>
            </div>
        </details>
    </div>

</div>

<script>
    // --- MATH UTILS ---
    const MathCore = {
        interpolate: (points, xTarget) => {
            let result = 0;
            const n = points.length;
            for (let i = 0; i < n; i++) {
                let term = points[i].y;
                for (let j = 0; j < n; j++) {
                    if (i !== j) {
                        term *= (xTarget - points[j].x) / (points[i].x - points[j].x);
                    }
                }
                result += term;
            }
            return result;
        },
        // Helper to mimic rounding needed for stable integer simulation
        round: (num) => Math.round(num * 1000) / 1000
    };

    // --- TAB 1: STUDY (Notebook) ---
    const study = {
        points: [],
        chart: null,
        init: () => {
            const ctx = document.getElementById('chartStudy').getContext('2d');
            study.chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        { label: '–¢–æ—á–∫–∏', data: [], backgroundColor: '#2c3e50', pointRadius: 7 },
                        { label: '–ü–æ–ª—ñ–Ω–æ–º', data: [], type: 'line', borderColor: '#2980b9', borderWidth: 2, pointRadius: 0, tension: 0.4, borderDash: [5, 5] }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { min: 0, max: 10, grid: {color: '#ccc'} },
                        y: { min: 0, max: 10, grid: {color: '#ccc'} }
                    },
                    plugins: { legend: { labels: { font: { family: 'Georgia' } } } },
                    onClick: (e) => study.addPoint(e)
                }
            });
        },
        addPoint: (e) => {
            const chart = study.chart;
            const canvasPos = Chart.helpers.getRelativePosition(e, chart);
            const x = parseFloat(chart.scales.x.getValueForPixel(canvasPos.x).toFixed(1));
            const y = parseFloat(chart.scales.y.getValueForPixel(canvasPos.y).toFixed(1));
            if(study.points.some(p => Math.abs(p.x - x) < 0.2)) return; 
            study.points.push({x, y});
            study.points.sort((a,b) => a.x - b.x);
            study.update();
        },
        update: () => {
            study.chart.data.datasets[0].data = study.points;
            if(study.points.length > 1) {
                const curve = [];
                for(let x=0; x<=10; x+=0.1) {
                    curve.push({x, y: MathCore.interpolate(study.points, x)});
                }
                study.chart.data.datasets[1].data = curve;
                study.chart.data.datasets[1].borderDash = [];
            } else {
                study.chart.data.datasets[1].data = [];
            }
            study.chart.update();
        },
        clear: () => { study.points = []; study.update(); }
    };

    // --- TAB 2: SECRET (X-Files) ---
// --- TAB 2: SECRET (X-Files) ---
    const secret = {
        anchors: [],
        keys: [],
        selected: [],
        chart: null,
        
     init: () => {
            const ctx = document.getElementById('chartSecret').getContext('2d');
            secret.chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        { 
                            label: 'TARGET (Secret)', 
                            data: [], 
                            backgroundColor: 'rgba(255, 23, 68, 1)', 
                            borderColor: '#ff1744',
                            borderWidth: 3,
                            pointStyle: 'crossRot', // –•—Ä–µ—Å—Ç–∏–∫
                            pointRadius: 12,
                            pointHoverRadius: 15,
                            order: 0 
                        },
                        { 
                            label: 'Active Keys', 
                            data: [], 
                            backgroundColor: '#03a9f4', 
                            pointRadius: 6,
                            pointStyle: 'rectRounded',
                            order: 1
                        },
                        { 
                            label: 'Trajectory', 
                            data: [], 
                            type: 'line', 
                            borderColor: 'rgba(3, 169, 244, 0.6)', 
                            borderWidth: 2, 
                            pointRadius: 0, 
                            borderDash: [5, 5],
                            tension: 0.4,
                            order: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            type: 'linear', 
                            min: -1, 
                            max: 13, 
                            grid: {
                                // –ú–∞–ª—é—î–º–æ —á–µ—Ä–≤–æ–Ω—É –ª—ñ–Ω—ñ—é, —è–∫—â–æ –∑–Ω–∞—á–µ–Ω–Ω—è –±–ª–∏–∑—å–∫–µ –¥–æ 0
                                color: (ctx) => Math.abs(ctx.tick.value) < 0.001 ? 'rgba(211, 47, 47, 0.8)' : '#333',
                                lineWidth: (ctx) => Math.abs(ctx.tick.value) < 0.001 ? 2 : 1,
                                borderColor: '#555'
                            },
                            ticks: { 
                                color: '#888',
                                stepSize: 1 // <--- –ì–ê–†–ê–ù–¢–£–Ñ, —â–æ –ª—ñ–Ω—ñ—è –Ω–∞ 0 –±—É–¥–µ –Ω–∞–º–∞–ª—å–æ–≤–∞–Ω–∞
                            } 
                        },
                        y: { 
                            grid: {
                                // –¢–µ —Å–∞–º–µ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ—ó –ª—ñ–Ω—ñ—ó (–≤—ñ—Å—å X)
                                color: (ctx) => Math.abs(ctx.tick.value) < 0.001 ? 'rgba(211, 47, 47, 0.8)' : '#333',
                                lineWidth: (ctx) => Math.abs(ctx.tick.value) < 0.001 ? 2 : 1,
                                borderColor: '#555'
                            },
                            ticks: { color: '#888' }
                        }
                    },
                    plugins: { legend: { display: false } }
                },
                // --- –ù–û–í–ò–ô –ë–õ–û–ö: –í–∏–≤–µ–¥–µ–Ω–Ω—è —á–∏—Å–ª–∞ –±—ñ–ª—è —Ö—Ä–µ—Å—Ç–∏–∫–∞ ---
                plugins: [{
                    id: 'hudLabel',
                    afterDatasetsDraw(chart) {
                        const { ctx } = chart;
                        const meta = chart.getDatasetMeta(0); // –Ü–Ω–¥–µ–∫—Å 0 - —Ü–µ –Ω–∞—à Target (Secret)
                        
                        // –Ø–∫—â–æ —î –¥–∞–Ω—ñ (—Å–µ–∫—Ä–µ—Ç –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ)
                        if (meta.data.length > 0) {
                            const point = meta.data[0];
                            const value = chart.data.datasets[0].data[0]?.y;
                            
                            if (point.x != null && point.y != null && value !== undefined) {
                                ctx.save();
                                ctx.font = 'bold 14px "Courier New"'; // –¢–µ—Ö–Ω—ñ—á–Ω–∏–π —à—Ä–∏—Ñ—Ç
                                ctx.fillStyle = '#ff1744';           // –ß–µ—Ä–≤–æ–Ω–∏–π –∫–æ–ª—ñ—Ä
                                ctx.textAlign = 'left';
                                ctx.textBaseline = 'middle';
                                
                                // –ú–∞–ª—é—î–º–æ —Ç–µ–∫—Å—Ç —Ç—Ä–æ—Ö–∏ –ø—Ä–∞–≤—ñ—à–µ (+15px) –≤—ñ–¥ —Ö—Ä–µ—Å—Ç–∏–∫–∞
                                ctx.fillText(`SEC: ${value}`, point.x + 15, point.y);
                                ctx.restore();
                            }
                        }
                    }
                }]
            });
        },
    /* old version
		generate: () => {
            const s = parseInt(document.getElementById('secretVal').value);
            const k = parseInt(document.getElementById('threshold').value);
            const n = 6; 

            // –ì–µ–Ω–µ—Ä—É—î–º–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏
            let coeffs = [s];
            for(let i=1; i<k; i++) {
                let c = Math.floor(Math.random() * 40) - 20;
                if (c === 0) c = 1; 
                coeffs.push(c);
            }

            // –ì–µ–Ω–µ—Ä—É—î–º–æ –∫–ª—é—á—ñ
            secret.keys = [];
            for(let x=1; x<=n; x++) {
                let y = 0;
                for(let i=0; i<k; i++) {
                    y += coeffs[i] * Math.pow(x, i);
                }
                secret.keys.push({x: x, y: y});
            }
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π —Å–µ–∫—Ä–µ—Ç
            secret.anchors = [{x: 0, y: s}];

            secret.selected = [];
            secret.renderKeys();
            secret.updateChart(false);
            
            // –°–∫–∏–¥–∞—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            const btn = document.getElementById('redBtn');
            btn.style.background = 'radial-gradient(circle at 30% 30%, #ff0000, #550000)';
            btn.innerHTML = 'üîí';
            document.getElementById('secretResult').innerText = "LOCKED";
            document.getElementById('secretResult').style.color = "#004400";
        },*/
		
	generate: () => {
            const s = parseInt(document.getElementById('secretVal').value);
            const k = parseInt(document.getElementById('threshold').value);
            const n = 6; 

            // --- 1. –ü–£–õ –ß–ò–°–ï–õ [1..12] ---
            let pool = Array.from({length: 12}, (_, i) => i + 1);
            
            // –ü–µ—Ä–µ–º—ñ—à—É—î–º–æ
            for (let i = pool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pool[i], pool[j]] = [pool[j], pool[i]];
            }

            // --- 2. –ö–û–†–ï–ù–Ü ---
            let roots = [];
            const rootsCount = Math.max(0, k - 2);
            for(let i = 0; i < rootsCount; i++) roots.push(pool.pop());

            // --- 3. –ö–õ–Æ–ß–Ü ---
            let keyXCoords = [];
            for(let i = 0; i < n; i++) keyXCoords.push(pool.pop());
            keyXCoords.sort((a, b) => a - b);

            const possibleMultipliers = k > 3 ? [-1, 1] : [-2, -1, 1, 2];
            const C = possibleMultipliers[Math.floor(Math.random() * possibleMultipliers.length)];

            // --- 4. –û–ë–ß–ò–°–õ–ï–ù–ù–Ø Y ---
            secret.keys = [];
            for(let x of keyXCoords) {
                let term = x; 
                for(let r of roots) term *= (x - r);
                let y = (C * term) + s;
                secret.keys.push({x: x, y: y});
            }
            
            secret.anchors = [{x: 0, y: s}];
            secret.selected = [];
            secret.renderKeys();
            secret.updateChart(false);
            
            const btn = document.getElementById('redBtn');
            btn.innerHTML = 'üîí';
            document.getElementById('secretResult').innerText = "LOCKED";
            document.getElementById('secretResult').style.color = "#d32f2f";
        },
		
		
		
        renderKeys: () => {
            const container = document.getElementById('keysArea');
            container.innerHTML = '';
            secret.keys.forEach((key, idx) => {
                const el = document.createElement('div');
                el.className = 'key-card';
                el.innerHTML = `KEY ${key.x}<br><small>${key.y}</small>`;
                el.onclick = () => secret.toggle(idx, el);
                container.appendChild(el);
            });
        },

        toggle: (idx, el) => {
            if (secret.selected.includes(idx)) {
                secret.selected = secret.selected.filter(i => i !== idx);
                el.classList.remove('selected');
            } else {
                secret.selected.push(idx);
                el.classList.add('selected');
            }
            secret.updateChart(false);
        },

        updateChart: (unlocked, secretValue) => {
            const pointsToShow = secret.selected.map(i => secret.keys[i]);
            secret.chart.data.datasets[1].data = pointsToShow;
            secret.chart.options.scales.x.min = -1;

            if (unlocked) {
                // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –∑—ñ—Ä–∫–∏
                const val = (secretValue !== undefined) ? secretValue : secret.anchors[0].y;
                
                // 1. –ü—Ä–∏–º—É—Å–æ–≤–æ –æ–Ω–æ–≤–ª—é—î–º–æ –º–∞—Å–∏–≤ –¥–∞–Ω–∏—Ö –¥–ª—è –∑—ñ—Ä–∫–∏
                secret.chart.data.datasets[0].data = [{x: 0, y: val}];
                
                // 2. –ë—É–¥—É—î–º–æ –∫—Ä–∏–≤—É
                const k = parseInt(document.getElementById('threshold').value);
                const source = pointsToShow.slice(0, k);
                
                const curve = [];
                for(let x=-0.5; x<=13; x+=0.1) {
                    curve.push({x: x, y: MathCore.interpolate(source, x)});
                }
                secret.chart.data.datasets[2].data = curve;
            } else {
                secret.chart.data.datasets[0].data = [];
                secret.chart.data.datasets[2].data = [];
            }
            secret.chart.update();
        },

        restore: () => {
            const k = parseInt(document.getElementById('threshold').value);
            const btn = document.getElementById('redBtn');
            const resText = document.getElementById('secretResult');

            if (secret.selected.length < k) {
                alert(`ACCESS DENIED. Need ${k} keys.`);
                return;
            }

            // –Ü–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü—ñ—è
            const points = secret.selected.map(i => secret.keys[i]);
            const restoredVal = Math.round(MathCore.interpolate(points, 0));
            const actualSecret = secret.anchors[0].y;

            if (restoredVal === actualSecret) {
                btn.style.background = 'radial-gradient(circle at 30% 30%, #00ff00, #005500)';
                btn.innerHTML = 'üîì';
                resText.innerText = restoredVal;
                resText.style.color = "#00ff00";
                resText.style.textShadow = "0 0 10px #00ff00";
                
                // –ü–µ—Ä–µ–¥–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è —è–≤–Ω–æ!
                secret.updateChart(true, restoredVal);
            } else {
                resText.innerText = "ERROR";
                resText.style.color = "red";
            }
        }
    };
	
    // --- TAB 3: QR (Coffee) ---
    const qr = {
        data: [],
        damaged: [],
        chart: null,
      
        init: () => {
		// 1. –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–æ–Ω—É
            const bgImage = new Image();
            bgImage.src = 'coffee.png'; // –§–∞–π–ª –º–∞—î –±—É—Ç–∏ –ø–æ—Ä—É—á –∑ HTML

            const bgPlugin = {
                id: 'coffee_bg',
                beforeDraw: (chart) => {
                    if (bgImage.complete) {
                        const ctx = chart.ctx;
                        const {top, left, width, height} = chart.chartArea;
                        ctx.save();
                        ctx.globalAlpha = 0.2; // –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å (0.4 = 40%)
                        ctx.drawImage(bgImage, left, top, width, height);
                        ctx.restore();
                    } else {
                        bgImage.onload = () => chart.draw();
                    }
                }
            };
            // New Chart for QR visualization
            if (!qr.chart) {
                const ctx = document.getElementById('chartQR').getContext('2d');
                qr.chart = new Chart(ctx, {
                    type: 'scatter',
					plugins: [bgPlugin],
                    data: {
                        datasets: [
                            { label: '–î–∞–Ω—ñ', data: [], backgroundColor: '#5d4037', pointRadius: 6 },
                            { label: 'Parity', data: [], backgroundColor: '#fbc02d', pointRadius: 6, pointStyle: 'triangle' },
                            { label: '–ö—Ä–∏–≤–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è', data: [], type: 'line', borderColor: '#8d6e63', borderWidth: 2, pointRadius: 0, tension: 0.4 }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { x: { display: false }, y: { display: false } }, // Minimalist "coffee napkin" sketch look
                        plugins: { legend: { display: true } }
                    }
                });
            }

            const vals = [10, 25, 15]; // Static-ish base values but can be random
            const dataPoints = vals.map((v, i) => ({x: i+1, y: Math.floor(Math.random()*20)+10}));
            
            // Calculate Parity x=4, x=5
            const p1 = Math.round(MathCore.interpolate(dataPoints, 4));
            const p2 = Math.round(MathCore.interpolate(dataPoints, 5));

            qr.data = [
                {id: 1, val: dataPoints[0].y, type: 'data'},
                {id: 2, val: dataPoints[1].y, type: 'data'},
                {id: 3, val: dataPoints[2].y, type: 'data'},
                {id: 4, val: p1, type: 'parity'},
                {id: 5, val: p2, type: 'parity'}
            ];
            qr.damaged = [];
            qr.render();
            qr.updateChart();
        },
				
				
				
        render: () => {
            const container = document.getElementById('packetsContainer');
            container.innerHTML = '';
            qr.data.forEach((p, idx) => {
                const el = document.createElement('div');
                const isBad = qr.damaged.includes(idx);
                el.className = `packet ${p.type} ${isBad ? 'damaged' : ''} ${p.recovered ? 'recovered' : ''}`;
                
                el.innerHTML = `
                    <small style="opacity:0.6">#${p.id}</small>
                    <span style="font-size: 1.1rem">${isBad ? '?' : p.val}</span>
                `;
                
                if (!isBad && !p.recovered) {
                    el.onclick = () => { qr.damaged.push(idx); qr.render(); qr.updateChart(); };
                }
                container.appendChild(el);
            });
        },

      updateChart: () => {
            // Filter only visible points
            const healthyData = qr.data.slice(0,3).filter((d,i) => !qr.damaged.includes(i)).map(d => ({x: d.id, y: d.val}));
            const healthyParity = qr.data.slice(3,5).filter((d,i) => !qr.damaged.includes(i+3)).map(d => ({x: d.id, y: d.val}));
            
            qr.chart.data.datasets[0].data = healthyData;
            qr.chart.data.datasets[1].data = healthyParity;

            // Draw line if we have enough points (3)
            const allHealthy = [...healthyData, ...healthyParity];
            if (allHealthy.length >= 3) {
                const curve = [];
                for(let x=1; x<=5; x+=0.1) {
                    curve.push({x: x, y: MathCore.interpolate(allHealthy, x)});
                }
                qr.chart.data.datasets[2].data = curve;
            } else {
                qr.chart.data.datasets[2].data = [];
            }
            qr.chart.update();
        },

        repair: () => {
            const healthy = qr.data.filter((d, i) => !qr.damaged.includes(i)).map(d => ({x: d.id, y: d.val}));

            if (healthy.length < 3) {
                alert("–ù–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –∫–∞–≤–∏! –ù–µ–º–æ–∂–ª–∏–≤–æ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏.");
                return;
            }

            qr.damaged.forEach(idx => {
                const targetX = qr.data[idx].id;
                const restored = Math.round(MathCore.interpolate(healthy, targetX));
                qr.data[idx].val = restored;
                qr.data[idx].recovered = true;
            });
            qr.damaged = [];
            qr.render();
            qr.updateChart(); // Full curve will appear
            
            setTimeout(() => {
                qr.data.forEach(d => delete d.recovered);
                qr.render();
            }, 2000);
        }
    };

    // --- THEME SWITCHER ---
    function setTab(name) {
        // Toggle Content
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.getElementById(name).classList.add('active');
        
        // Toggle UI Classes
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        const activeIdx = ['study', 'secret', 'qr'].indexOf(name);
        document.querySelectorAll('.tab')[activeIdx].classList.add('active');

        // Switch Global Theme
        document.body.className = `theme-${name}`;
    }

    window.onload = () => {
        study.init();
        secret.init();
        qr.init();
    };
</script>

</body>
</html>