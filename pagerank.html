<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PageRank Simulator</title>
    
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: { fontCache: 'global' }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --theory-color: #e74c3c;
            --bg-color: #f4f4f9;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column; /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏–π —Å—Ç–µ–∫: —Å–ø–æ—á–∞—Ç–∫—É —Ç–µ–æ—Ä—ñ—è, –ø–æ—Ç—ñ–º –≤—Å–µ —ñ–Ω—à–µ */
            height: 100vh;
            background-color: var(--bg-color);
            color: #333;
            overflow: hidden; 
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≤–µ—Ä—Ö–Ω—å–æ—ó –ø–∞–Ω–µ–ª—ñ (—Å–ø–æ–π–ª–µ—Ä–∞) */
        details {
            background: #fff;
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0; 
            max-height: 95vh; 
            overflow-y: auto;
            z-index: 20;
        }

        /* --- –ù–û–í–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† --- */
        /* –í—ñ–Ω —Ç—Ä–∏–º–∞—î –°–∞–π–¥–±–∞—Ä —ñ –ì—Ä–∞—Ñ—ñ–∫–∏ –≤ —Ä—è–¥–æ–∫ */
        .app-wrapper {
            display: flex; 
            flex-direction: row; /* –°–∞–π–¥–±–∞—Ä –∑–ª—ñ–≤–∞, –ö–æ–Ω—Ç–µ–Ω—Ç —Å–ø—Ä–∞–≤–∞ */
            flex: 1; /* –ó–∞–π–º–∞—î –≤–µ—Å—å –ø—Ä–æ—Å—Ç—ñ—Ä, —â–æ –ª–∏—à–∏–≤—Å—è */
            overflow: hidden;
            height: 100%;
            width: 100%;
        }

        .sidebar {
            width: 350px;
            min-width: 350px;
            background: #fff;
            padding: 15px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 10;
            height: 100%; 
            box-sizing: border-box; /* –í–∞–∂–ª–∏–≤–æ –¥–ª—è –≤—ñ–¥—Å—Ç—É–ø—ñ–≤ */
        }

        h2, h3 { margin: 0 0 5px 0; color: var(--primary-color); font-size: 1.1em; }
        label { font-weight: bold; font-size: 0.85em; display: block; margin-bottom: 3px; }
        
        textarea {
            width: 100%;
            height: 120px;
            font-family: monospace;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9em;
            resize: vertical;
        }

        input[type="range"] { width: 100%; }
        
        .controls { display: flex; gap: 5px; margin-top: 5px; }
        
        button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: background 0.2s;
        }

        .btn-start { background: var(--accent-color); color: white; }
        .btn-stop { background: #e67e22; color: white; }
        .btn-reset { background: #95a5a6; color: white; }
        .btn-apply { background: var(--primary-color); color: white; width: 100%; margin-top: 5px;}

        .main-content {
            flex: 1;
            display: grid;
            grid-template-rows: 55% 45%;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 10px;
            height: 100%; /* –ù–∞ –≤—Å—é –≤–∏—Å–æ—Ç—É –æ–±–≥–æ—Ä—Ç–∫–∏ */
            box-sizing: border-box;
        }

        .panel {
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .graph-panel { grid-column: 1 / 2; grid-row: 1 / 2; }
        .google-matrix-panel { grid-column: 2 / 3; grid-row: 1 / 2; }
        .bar-chart-panel { grid-column: 1 / 2; grid-row: 2 / 3; }
        .line-chart-panel { grid-column: 2 / 3; grid-row: 2 / 3; }

        #network-viz { width: 100%; height: 100%; border: 1px solid #eee; }
        #googleMatrixOutput { overflow: auto; height: 100%; font-family: monospace; font-size: 0.8em; }
        .chart-container { position: relative; height: 100%; width: 100%; }

        table.g-matrix { border-collapse: collapse; width: 100%; }
        table.g-matrix td, table.g-matrix th { border: 1px solid #ddd; padding: 4px; text-align: center; }
        table.g-matrix th { background: #f0f0f0; position: sticky; top: 0; }
        
        .stat-value { font-weight: bold; color: var(--accent-color); }
        .math-block { margin-bottom: 10px; font-size: 0.85em; background: #fffbe6; padding: 5px; border-left: 3px solid #f1c40f;}
    </style>
</head>
<body>
<details style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
    <summary style="cursor: pointer; font-weight: bold; color: #2c3e50; font-size: 1.1em;">
        üìö –¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞
    </summary>
    
    <div style="margin-top: 15px; line-height: 1.6; color: #333;">
        <h3>–ê–ª–≥–æ—Ä–∏—Ç–º PageRank</h3>
        <p>
            <strong>PageRank</strong> ‚Äî —Ü–µ –∞–ª–≥–æ—Ä–∏—Ç–º, —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π –õ–∞—Ä—Ä—ñ –ü–µ–π–¥–∂–µ–º —Ç–∞ –°–µ—Ä–≥—ñ—î–º –ë—Ä—ñ–Ω–æ–º (–∑–∞—Å–Ω–æ–≤–Ω–∏–∫–∞–º–∏ Google) –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–æ–∫. –í –æ—Å–Ω–æ–≤—ñ –∞–ª–≥–æ—Ä–∏—Ç–º—É –ª–µ–∂–∏—Ç—å —ñ–¥–µ—è "–≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏": –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ A –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É B –≤–≤–∞–∂–∞—î—Ç—å—Å—è –≥–æ–ª–æ—Å–æ–º —Å—Ç–æ—Ä—ñ–Ω–∫–∏ A –∑–∞ –≤–∞–∂–ª–∏–≤—ñ—Å—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫–∏ B.
        </p>
        <p>
            –ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–æ–∑–≥–ª—è–¥–∞—î—Ç—å—Å—è —è–∫ –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∏–π –≥—Ä–∞—Ñ, –∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –º–æ–¥–µ–ª—é—î—Ç—å—Å—è —è–∫ <strong>–≤–∏–ø–∞–¥–∫–æ–≤–µ –±–ª—É–∫–∞–Ω–Ω—è (Random Walk)</strong>.
        </p>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

        <h3>–õ–∞–Ω—Ü—é–≥–∏ –ú–∞—Ä–∫–æ–≤–∞ —Ç–∞ –ú–∞—Ç—Ä–∏—Ü—ñ</h3>
        <p>
            –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ–ª—é—î—Ç—å—Å—è —è–∫ –¥–∏—Å–∫—Ä–µ—Ç–Ω–∏–π –ª–∞–Ω—Ü—é–≥ –ú–∞—Ä–∫–æ–≤–∞ –∑ $N$ —Å—Ç–∞–Ω–∞–º–∏ (–≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏).
        </p>
        
        <h4>–ö—Ä–æ–∫ 1: –ú–∞—Ç—Ä–∏—Ü—è –°—É–º—ñ–∂–Ω–æ—Å—Ç—ñ ($A$)</h4>
        <p>–ü–æ–∫–∞–∑—É—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≥—Ä–∞—Ñ–∞. $A_{ij} = 1$, —è–∫—â–æ —î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ $j$ –Ω–∞ $i$, —ñ–Ω–∞–∫—à–µ $0$.</p>
        
        <h4>–ö—Ä–æ–∫ 2: –°—Ç–æ—Ö–∞—Å—Ç–∏—á–Ω–∞ –ú–∞—Ç—Ä–∏—Ü—è ($S$)</h4>
        <p>–¶–µ –º–∞—Ç—Ä–∏—Ü—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤. –ú–∏ –Ω–æ—Ä–º—É—î–º–æ —Å—Ç–æ–≤–ø—Ü—ñ –º–∞—Ç—Ä–∏—Ü—ñ $A$ —Ç–∞–∫, —â–æ–± —Å—É–º–∞ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –∫–æ–∂–Ω–æ–º—É —Å—Ç–æ–≤–ø—Ü—ñ –¥–æ—Ä—ñ–≤–Ω—é–≤–∞–ª–∞ 1 (–∞–±–æ —Ä—è–¥–∫–∏, –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–æ—Ç–∞—Ü—ñ—ó; —Ç—É—Ç —ñ –¥–∞–ª—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–æ—Ç–∞—Ü—ñ—é –≤–µ–∫—Ç–æ—Ä—ñ–≤-—Å—Ç–æ–≤–ø—Ü—ñ–≤).<br>
        –Ø–∫—â–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ $j$ –º–∞—î $k$ –≤–∏—Ö—ñ–¥–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å, —Ç–æ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É $i$ –¥–æ—Ä—ñ–≤–Ω—é—î:</p>
        $$S_{ij} = \frac{1}{k}$$

        <h4>–ö—Ä–æ–∫ 3: Google –ú–∞—Ç—Ä–∏—Ü—è ($G$)</h4>
        <p>–ó–≤–∏—á–∞–π–Ω–æ–≥–æ –±–ª—É–∫–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —á–µ—Ä–µ–∑ –¥–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏:</p>
        <ul>
            <li><strong>–¢—É–ø–∏–∫–∏ (Dangling Nodes):</strong> –°—Ç–æ—Ä—ñ–Ω–∫–∏ –±–µ–∑ –≤–∏—Ö—ñ–¥–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å –ø–æ–≥–ª–∏–Ω–∞—é—Ç—å –≤–∞–≥—É.</li>
            <li><strong>–ü–∞—Å—Ç–∫–∏ (Spider Traps):</strong> –¶–∏–∫–ª–∏, –∑ —è–∫–∏—Ö –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–π—Ç–∏.</li>
        </ul>
        <p>–†—ñ—à–µ–Ω–Ω—è ‚Äî <strong>–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—è</strong>. –ó –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é $\alpha$ (–∑–∞–∑–≤–∏—á–∞–π 0.85) –º–∞–Ω–¥—Ä—ñ–≤–Ω–∏–∫ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –ø–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—é, –∞ –∑ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é $(1-\alpha)$ ‚Äî —Ç–µ–ª–µ–ø–æ—Ä—Ç—É—î—Ç—å—Å—è –Ω–∞ –≤–∏–ø–∞–¥–∫–æ–≤—É —Å—Ç–æ—Ä—ñ–Ω–∫—É.</p>
        
        <div style="background: #f8f9fa; padding: 10px; border-left: 4px solid #3498db;">
            <strong>–§–æ—Ä–º—É–ª–∞ Google –ú–∞—Ç—Ä–∏—Ü—ñ:</strong>
            $$G = \alpha S + (1-\alpha) \frac{1}{N} \mathbf{E}$$
        </div>
        <p>–î–µ:</p>
        <ul>
            <li>$G$ ‚Äî —Ä–µ–∑—É–ª—å—Ç—É—é—á–∞ –º–∞—Ç—Ä–∏—Ü—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π.</li>
            <li>$\alpha$ (alpha) ‚Äî –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–µ–º–ø—Ñ—É–≤–∞–Ω–Ω—è (damping factor).</li>
            <li>$S$ ‚Äî —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–Ω–∞ –º–∞—Ç—Ä–∏—Ü—è –≥—Ä–∞—Ñ–∞.</li>
            <li>$N$ ‚Äî –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—É–∑–ª—ñ–≤.</li>
            <li>$\mathbf{E}$ ‚Äî –º–∞—Ç—Ä–∏—Ü—è, —â–æ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –æ–¥–∏–Ω–∏—Ü—å (–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω—É —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—é –¥–æ –±—É–¥—å-—è–∫–æ–≥–æ –≤—É–∑–ª–∞).</li>
        </ul>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

        <h3>–í–ª–∞—Å–Ω—ñ –≤–µ–∫—Ç–æ—Ä–∏ (Eigenvectors)</h3>
        <p>
            –ú–∏ —à—É–∫–∞—î–º–æ —Ç–∞–∫–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π (–≤–µ–∫—Ç–æ—Ä $\mathbf{v}$), —è–∫–∏–π –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∫—Ä–æ–∫—É –±–ª—É–∫–∞–Ω–Ω—è. –£ –ª—ñ–Ω—ñ–π–Ω—ñ–π –∞–ª–≥–µ–±—Ä—ñ —Ü–µ –∑–∞–ø–∏—Å—É—î—Ç—å—Å—è —è–∫:
        </p>
        $$G \mathbf{v} = \lambda \mathbf{v}$$
        <p>
            –î–µ $\lambda = 1$. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ PageRank ‚Äî —Ü–µ <strong>–≥–æ–ª–æ–≤–Ω–∏–π –≤–ª–∞—Å–Ω–∏–π –≤–µ–∫—Ç–æ—Ä</strong> (principal eigenvector) –º–∞—Ç—Ä–∏—Ü—ñ $G$, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–ª–∞—Å–Ω–æ–º—É —á–∏—Å–ª—É 1.
        </p>
        <p>
            –ó–≥—ñ–¥–Ω–æ –∑ <em>—Ç–µ–æ—Ä–µ–º–æ—é –ü–µ—Ä—Ä–æ–Ω–∞-–§—Ä–æ–±–µ–Ω—ñ—É—Å–∞</em>, —è–∫—â–æ –º–∞—Ç—Ä–∏—Ü—è $G$ –¥–æ–¥–∞—Ç–Ω–∞ (–≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ > 0, —â–æ –≥–∞—Ä–∞–Ω—Ç—É—î—Ç—å—Å—è —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—î—é), —Ç–æ —Ç–∞–∫–∏–π –≤–µ–∫—Ç–æ—Ä —ñ—Å–Ω—É—î, –≤—ñ–Ω —î–¥–∏–Ω–∏–π, —ñ –≤—Å—ñ –π–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –¥–æ–¥–∞—Ç–Ω—ñ.
        </p>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

        <h3>–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ç–∞ –¢–µ–º–∞—Ç–∏—á–Ω–∏–π PageRank</h3>
        <p>
            –£ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ–π —Ñ–æ—Ä–º—É–ª—ñ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—è —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∞: –≤–µ–∫—Ç–æ—Ä —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—ó $\mathbf{e} = [\frac{1}{N}, \dots, \frac{1}{N}]^T$.
            –û–¥–Ω–∞–∫ –º–∏ –º–æ–∂–µ–º–æ –∑–º—ñ–Ω–∏—Ç–∏ –≤–µ–∫—Ç–æ—Ä —Ä–æ–∑–ø–æ–¥—ñ–ª—É —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—ó $\mathbf{v}_{teleport}$.
        </p>
        $$G_{personalized} = \alpha S + (1-\alpha) \mathbf{v}_{teleport} \cdot \mathbf{1}^T$$
		 ($\mathbf{1}^T$ - —Ü–µ –≤–µ–∫—Ç–æ—Ä-—Å—Ç–æ–≤–ø—á–∏–∫, –¥–µ –≤—Å—ñ —á–∏—Å–ª–∞ ‚Äî —Ü–µ 1)
        
        <ul>
            <li><strong>Personalized PageRank:</strong> –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ–¥–∞–≤ —Å—Ç–æ—Ä—ñ–Ω–∫—É $A$ –≤ –∑–∞–∫–ª–∞–¥–∫–∏, –º–∏ –º–æ–∂–µ–º–æ –∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫, —â–æ–± –ø—Ä–∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—ó –≤—ñ–Ω –∑ –Ω–∞–±–∞–≥–∞—Ç–æ –±—ñ–ª—å—à–æ—é –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é –ø–æ—Ç—Ä–∞–ø–ª—è–≤ –Ω–∞ $A$. –¶–µ "–ø–µ—Ä–µ–∫–æ—à—É—î" –≤–µ—Å—å —Ä–æ–∑–ø–æ–¥—ñ–ª –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ –≤ —Å—Ç–æ—Ä–æ–Ω—É —ñ–Ω—Ç–µ—Ä–µ—Å—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.</li>
            <li><strong>Topic-Sensitive PageRank:</strong> –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∫—ñ–ª—å–∫–∞ –≤–µ–∫—Ç–æ—Ä—ñ–≤ $\mathbf{v}_{topic}$ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è —Å–ø–æ—Ä—Ç—É, –Ω–∞—É–∫–∏, –Ω–æ–≤–∏–Ω). –Ø–∫—â–æ –ø–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç —Å—Ç–æ—Å—É—î—Ç—å—Å—è "—Ç–µ–Ω—ñ—Å—É", –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤–µ–∫—Ç–æ—Ä —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—ó, –¥–µ –≤–∞–≥–∞ –∑–æ—Å–µ—Ä–µ–¥–∂–µ–Ω–∞ –Ω–∞ —Å–ø–æ—Ä—Ç–∏–≤–Ω–∏—Ö —Å–∞–π—Ç–∞—Ö.</li>
        </ul>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

        <h3>–ú–µ—Ç–æ–¥ c—Ç–µ–ø–µ–Ω–µ–≤–∏—Ö —ñ—Ç–µ—Ä–∞—Ü—ñ–π (Power Iteration)</h3>
        <p>
            –Ø–∫ –∑–Ω–∞–π—Ç–∏ —Ü–µ–π –≤–ª–∞—Å–Ω–∏–π –≤–µ–∫—Ç–æ—Ä $\mathbf{v}$ –¥–ª—è –≥—ñ–≥–∞–Ω—Ç—Å—å–∫–æ—ó –º–∞—Ç—Ä–∏—Ü—ñ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É? –ü—Ä—è–º–µ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è (—á–µ—Ä–µ–∑ –¥–µ—Ç–µ—Ä–º—ñ–Ω–∞–Ω—Ç –∞–±–æ —Ä–æ–∑–∫–ª–∞–¥ –ì–∞—É—Å–∞) –Ω–µ–º–æ–∂–ª–∏–≤–µ –¥–ª—è $N > 10^9$.
        </p>
        <p>
            –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —á–∏—Å–µ–ª—å–Ω–∏–π –º–µ—Ç–æ–¥ <strong>Power Iteration</strong>.
        </p>
        <ol>
            <li>–ë–µ—Ä–µ–º–æ –¥–æ–≤—ñ–ª—å–Ω–∏–π –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–µ–∫—Ç–æ—Ä $\mathbf{x}^{(0)}$ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª).</li>
            <li>–ú–Ω–æ–∂–∏–º–æ –π–æ–≥–æ –Ω–∞ –º–∞—Ç—Ä–∏—Ü—é $G$: 
                $$\mathbf{x}^{(k+1)} = G \mathbf{x}^{(k)}$$
            </li>
            <li>–ü–æ–≤—Ç–æ—Ä—é—î–º–æ –∫—Ä–æ–∫ 2 –±–∞–≥–∞—Ç–æ —Ä–∞–∑—ñ–≤.</li>
        </ol>
        <p>
            <strong>P–≤'—è–∑–æ–∫ Power Iteration –∑ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º Page Rank</strong> 
            –¢–µ, —â–æ –≤–∏ –±–∞—á–∏—Ç–µ –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫—É "–ï–≤–æ–ª—é—Ü—ñ—è —É —á–∞—Å—ñ" –≤ —Å–∏–º—É–ª—è—Ç–æ—Ä—ñ ‚Äî —Ü–µ —ñ —î –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –º–µ—Ç–æ–¥—É Power Iteration!
        </p>
        <ul>
            <li>–ö–æ–∂–µ–Ω –∫—Ä–æ–∫ –º–∞–Ω–¥—Ä—ñ–≤–Ω–∏–∫–∞ (–∞–±–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –º–∞—Å) –Ω–∞–±–ª–∏–∂–∞—î –≤–µ–∫—Ç–æ—Ä $\mathbf{x}$ –¥–æ —Å—Ç–∞—Ü—ñ–æ–Ω–∞—Ä–Ω–æ–≥–æ —Å—Ç–∞–Ω—É.</li>
            <li>–®–≤–∏–¥–∫—ñ—Å—Ç—å –∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ $\lambda_2$ (–¥—Ä—É–≥–æ–≥–æ –∑–∞ –º–æ–¥—É–ª–µ–º –≤–ª–∞—Å–Ω–æ–≥–æ —á–∏—Å–ª–∞). –ß–∏–º –º–µ–Ω—à–µ $\alpha$, —Ç–∏–º —à–≤–∏–¥—à–µ –∑–±—ñ–∂–Ω—ñ—Å—Ç—å (—Ç–∏–º –±—ñ–ª—å—à–∏–π —Ä–æ–∑—Ä–∏–≤ –º—ñ–∂ $\lambda_1=1$ —Ç–∞ $|\lambda_2| \approx \alpha$).</li>
        </ul>
    </div>
</details>

<div class="app-wrapper">

    <div class="sidebar">
        <h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
        
        <div class="math-block">
            –í–≤–µ–¥—ñ—Ç—å –º–∞—Ç—Ä–∏—Ü—é –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤ \(S\).<br>
            <strong>–í–∞–∂–ª–∏–≤–æ:</strong> –°—É–º–∞ –∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞ –º–∞—î –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ 1.0 (–∞–±–æ 0 –¥–ª—è —Ç—É–ø–∏–∫—ñ–≤).
        </div>

        <div>
            <label for="stochMatrix">–ú–∞—Ç—Ä–∏—Ü—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π (S):</label>
            <textarea id="stochMatrix">
0.0 0.1 0.1 0.8
0.0 0.0 0.9 0.1
0.1 0.5 0.0 0.4
0.0 0.0 1.0 0.0</textarea>
            <button class="btn-apply" onclick="initSimulation()">–ü–æ–±—É–¥—É–≤–∞—Ç–∏ –≥—Ä–∞—Ñ</button>
        </div>

        <hr>

        <div>
            <label>–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—è (\(\alpha\)): <span id="dampingVal" class="stat-value">0.85</span></label>
            <input type="range" id="damping" min="0" max="1" step="0.05" value="0.85" oninput="updateDampingDisplay()">
        </div>

        <div>
            <label>–®–≤–∏–¥–∫—ñ—Å—Ç—å (–º—Å): <span id="speedVal" class="stat-value">100</span></label>
            <input type="range" id="speed" min="10" max="1000" step="10" value="100" oninput="updateSpeedDisplay()">
        </div>

        <div class="controls">
            <button class="btn-start" onclick="startSimulation()">–°—Ç–∞—Ä—Ç</button>
            <button class="btn-stop" onclick="stopSimulation()">–°—Ç–æ–ø</button>
            <button class="btn-reset" onclick="resetStats()">–°–∫–∏–¥–∞–Ω–Ω—è</button>
        </div>

        <div style="margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
            <div style="font-size: 0.9em;">–ö—Ä–æ–∫—ñ–≤: <span id="stepCount" class="stat-value">0</span></div>
            <div style="font-size: 0.9em;">–ü–æ–¥—ñ—è: <span id="eventStatus" style="font-style: italic; color:#666;">-</span></div>
        </div>
    </div>
    <div class="main-content">
        <div class="panel graph-panel">
            <h3>–ì—Ä–∞—Ñ</h3>
            <div id="network-viz"></div>
        </div>

        <div class="panel google-matrix-panel">
            <h3>Google –ú–∞—Ç—Ä–∏—Ü—è (G)</h3>
            <div id="googleMatrixOutput"></div>
        </div>

        <div class="panel bar-chart-panel">
            <h3>–†–æ–∑–ø–æ–¥—ñ–ª vs –¢–µ–æ—Ä—ñ—è (–ß–µ—Ä–≤–æ–Ω–∏–π –∫–æ–Ω—Ç—É—Ä)</h3>
            <div class="chart-container">
                <canvas id="barChart"></canvas>
            </div>
        </div>

        <div class="panel line-chart-panel">
            <h3>–ï–≤–æ–ª—é—Ü—ñ—è —É —á–∞—Å—ñ</h3>
            <div class="chart-container">
                <canvas id="lineChart"></canvas>
            </div>
        </div>
    </div>
    </div> 
<script>
    // --- Global Variables ---
    let network = null;
    let nodesDataSet = null; 
    let numNodes = 0;
    
    let stochMatrix = []; // S
    let googleMatrix = []; // G
    let stationaryDist = []; // Theoretical limit (Eigenvector)
    
    let isRunning = false;
    let timer = null;
    let currentNodeIndex = 0;
    
    let visitCounts = [];
    let totalSteps = 0;

    let barChart = null;
    let lineChart = null;

    // --- Config ---
    const MIN_NODE_SIZE = 15;
    const MAX_NODE_SIZE = 45;

    window.onload = function() {
        initSimulation();
    };

    function updateDampingDisplay() {
        document.getElementById('dampingVal').innerText = document.getElementById('damping').value;
        // –û–Ω–æ–≤–ª—é—î–º–æ –º–∞—Ç—Ä–∏—Ü—é —ñ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∞—Ñ–∞
        calculateMatrices();
        updateChartsData(); 
    }

    function updateSpeedDisplay() {
        document.getElementById('speedVal').innerText = document.getElementById('speed').value;
        if(isRunning) {
            stopSimulation();
            startSimulation();
        }
    }

    function initSimulation() {
        stopSimulation();
        if(!parseMatrix()) return; // Validation happens here
        
        calculateMatrices();
        createGraph(); // Create graph only on full reset/apply
        initCharts();
        resetStats();
    }

    // --- 1. Parsing User Input & Validation ---
    function parseMatrix() {
        const raw = document.getElementById('stochMatrix').value.trim();
        const rows = raw.split('\n');
        let tempMatrix = [];
        
        rows.forEach(row => {
            const cols = row.trim().split(/\s+/).map(Number);
            if (cols.length > 0) tempMatrix.push(cols);
        });

        numNodes = tempMatrix.length;
        if (numNodes === 0 || tempMatrix.some(r => r.length !== numNodes)) {
            alert("–ü–æ–º–∏–ª–∫–∞: –ú–∞—Ç—Ä–∏—Ü—è –º–∞—î –±—É—Ç–∏ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ—é!");
            return false;
        }

        // Strict Validation
        stochMatrix = [];
        for (let i = 0; i < numNodes; i++) {
            let row = tempMatrix[i];
            let sum = row.reduce((a, b) => a + b, 0);
            
            // Allow 0.0 (Dangling node) or approximately 1.0
            if (sum !== 0 && Math.abs(sum - 1.0) > 0.01) {
                alert(`–ü–æ–º–∏–ª–∫–∞ —É —Ä—è–¥–∫—É ${i+1}: –°—É–º–∞ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π –¥–æ—Ä—ñ–≤–Ω—é—î ${sum.toFixed(3)}, –∞ –º–∞—î –±—É—Ç–∏ 1.0 (–∞–±–æ 0 –¥–ª—è —Ç—É–ø–∏–∫–∞).`);
                return false;
            }
            stochMatrix.push(row);
        }
        return true;
    }

    // --- 2. Math: G Matrix & Eigenvector ---
    function calculateMatrices() {
        if(numNodes === 0) return;
        const alpha = parseFloat(document.getElementById('damping').value);
        googleMatrix = [];
        const teleportProb = (1 - alpha) / numNodes;

        // Calculate G
        for (let i = 0; i < numNodes; i++) {
            let rowSum = stochMatrix[i].reduce((a,b)=>a+b, 0);
            let gRow = [];
            for (let j = 0; j < numNodes; j++) {
                let sVal = stochMatrix[i][j];
                if (rowSum === 0) {
                    gRow.push(1.0 / numNodes); // Dangling -> 1/N
                } else {
                    gRow.push((alpha * sVal) + teleportProb);
                }
            }
            googleMatrix.push(gRow);
        }

        // Calculate Stationary Distribution (Power Iteration)
        // We look for vector v such that v * G = v
        let v = new Array(numNodes).fill(1.0 / numNodes);
        for(let iter = 0; iter < 100; iter++) {
            let nextV = new Array(numNodes).fill(0);
            for(let i = 0; i < numNodes; i++) { // from node
                for(let j = 0; j < numNodes; j++) { // to node
                    // v[j] += v[i] * G[i][j] (Row vector multiplication)
                    nextV[j] += v[i] * googleMatrix[i][j];
                }
            }
            v = nextV;
        }
        stationaryDist = v.map(val => val * 100); // Convert to %

        renderGoogleMatrix();
    }

    function renderGoogleMatrix() {
        const container = document.getElementById('googleMatrixOutput');
        let html = '<table class="g-matrix"><thead><tr><th></th>';
        for(let i=0; i<numNodes; i++) html += `<th>${String.fromCharCode(65+i)}</th>`;
        html += '</tr></thead><tbody>';

        for (let i = 0; i < numNodes; i++) {
            html += `<tr><th>${String.fromCharCode(65+i)}</th>`;
            for (let j = 0; j < numNodes; j++) {
                let bg = googleMatrix[i][j] > (2/numNodes) ? '#d4e6f1' : '#fff';
                html += `<td style="background:${bg}">${googleMatrix[i][j].toFixed(3)}</td>`;
            }
            html += '</tr>';
        }
        html += '</tbody></table>';
        container.innerHTML = html;
    }

    // --- 3. Visualization (Vis.js - Stabilized) ---
    function createGraph() {
        const nodes = [];
        const edges = [];

        for (let i = 0; i < numNodes; i++) {
            nodes.push({ 
                id: i, 
                label: String.fromCharCode(65 + i), 
                value: 1, 
                scaling: { min: MIN_NODE_SIZE, max: MAX_NODE_SIZE },
                color: { background: '#97c2fc', border: '#2b7ce9' }
            });

            for (let j = 0; j < numNodes; j++) {
                const weight = stochMatrix[i][j];
                if (weight > 0.01) { 
                    edges.push({ 
                        from: i, to: j, arrows: 'to', 
                        width: weight * 4, 
                        color: { opacity: 0.5, color: '#848484' }
                    });
                }
            }
        }

        nodesDataSet = new vis.DataSet(nodes);
        const container = document.getElementById('network-viz');
        const data = { nodes: nodesDataSet, edges: edges };
        
        const options = {
            layout: {
                randomSeed: 2 // FIXED SEED
            },
            nodes: { 
                shape: 'dot', 
                font: { size: 16, strokeWidth: 2, strokeColor: '#fff', vadjust: -40 } 
            },
            physics: {
                enabled: true,
                solver: 'forceAtlas2Based',
                forceAtlas2Based: { 
                    gravitationalConstant: -50, 
                    springLength: 100, 
                    damping: 0.9 
                },
                stabilization: {
                    enabled: true,
                    iterations: 1000, 
                    updateInterval: 25
                }
            },
            interaction: { zoomView: false, dragView: true }
        };
        
        if (network) network.destroy();
        network = new vis.Network(container, data, options);

        network.on("stabilizationIterationsDone", function () {
            network.setOptions( { physics: false } );
        });
    }

    // --- 4. Charts (Updated Bar Chart) ---
    function initCharts() {
        const labels = Array.from({length: numNodes}, (_, i) => String.fromCharCode(65 + i));
        
        // Bar Chart
        const ctxBar = document.getElementById('barChart').getContext('2d');
        if(barChart) barChart.destroy();
        
        barChart = new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '–°–∏–º—É–ª—è—Ü—ñ—è',
                        data: new Array(numNodes).fill(0),
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1,
                        order: 2
                    },
                    {
                        label: '–¢–µ–æ—Ä—ñ—è (Stationary)',
                        data: stationaryDist, 
                        backgroundColor: 'transparent',
                        borderColor: '#e74c3c',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        type: 'bar', 
                        order: 1 
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: { 
                    x: { stacked: true }, 
                    y: { beginAtZero: true, max: 100 } 
                },
                plugins: { legend: { display: true } }
            }
        });

        // Line Chart
        const ctxLine = document.getElementById('lineChart').getContext('2d');
        if(lineChart) lineChart.destroy();

        const datasets = labels.map((label, index) => ({
            label: label,
            data: [],
            borderColor: `hsl(${(index * 360) / numNodes}, 70%, 50%)`,
            borderWidth: 1.5,
            pointRadius: 0,
            fill: false
        }));

        lineChart = new Chart(ctxLine, {
            type: 'line',
            data: { labels: [], datasets: datasets },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: { y: { beginAtZero: true, max: 100 }, x: { display: false } },
                elements: { line: { tension: 0.1 } }
            }
        });
    }

    function updateChartsData() {
        if (!barChart) return;
        barChart.data.datasets[1].data = stationaryDist;
        barChart.update();
    }

    // --- 5. Simulation Logic ---
    function resetStats() {
        visitCounts = new Array(numNodes).fill(0);
        totalSteps = 0;
        document.getElementById('stepCount').innerText = 0;
        
        barChart.data.datasets[0].data.fill(0);
        barChart.update();
        
        lineChart.data.labels = [];
        lineChart.data.datasets.forEach(d => d.data = []);
        lineChart.update();

        nodesDataSet.update(nodesDataSet.get().map(n => ({id: n.id, value: 1})));

        currentNodeIndex = Math.floor(Math.random() * numNodes);
        highlightNode(currentNodeIndex);
    }

    function startSimulation() {
        if(isRunning) return;
        isRunning = true;
        const speed = parseInt(document.getElementById('speed').value);
        timer = setInterval(step, speed);
    }

    function stopSimulation() {
        isRunning = false;
        clearInterval(timer);
    }

    function step() {
        totalSteps++;
        const alpha = parseFloat(document.getElementById('damping').value);
        let nextNode = -1;
        let eventType = "";

        const currentRowProbs = stochMatrix[currentNodeIndex];
        const isDangling = currentRowProbs.every(p => p === 0);
        const rand = Math.random();

        if (isDangling) {
             nextNode = Math.floor(Math.random() * numNodes);
             eventType = "–¢—É–ø–∏–∫ -> –°—Ç—Ä–∏–±–æ–∫";
        } 
        else if (rand > alpha) {
            nextNode = Math.floor(Math.random() * numNodes);
            eventType = "–¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü—ñ—è";
        } else {
            let r = Math.random();
            let accumulated = 0;
            for(let i=0; i<numNodes; i++) {
                accumulated += currentRowProbs[i];
                if (r <= accumulated) {
                    nextNode = i;
                    break;
                }
            }
            if (nextNode === -1) nextNode = numNodes - 1;
            eventType = "–ü–µ—Ä–µ—Ö—ñ–¥";
        }

        currentNodeIndex = nextNode;
        visitCounts[currentNodeIndex]++;

        highlightNode(currentNodeIndex);
        updateStatsUI(eventType);
        updateVisAndCharts();
    }

    function highlightNode(id) {
        const updates = nodesDataSet.get().map(node => ({
            id: node.id,
            color: { 
                background: node.id === id ? '#e74c3c' : '#97c2fc',
                border: node.id === id ? '#c0392b' : '#2b7ce9'
            }
        }));
        nodesDataSet.update(updates);
    }

    function updateVisAndCharts() {
        const percentages = visitCounts.map(c => (c / totalSteps) * 100);

        // Update Node Sizes
        const sizeUpdates = percentages.map((pct, idx) => ({
            id: idx,
            value: pct > 0 ? pct : 1
        }));
        nodesDataSet.update(sizeUpdates);

        // Update Bar Chart
        barChart.data.datasets[0].data = percentages;
        barChart.update();

        // Update Line Chart
        if (totalSteps % 2 === 0) {
            lineChart.data.labels.push(totalSteps);
            percentages.forEach((pct, idx) => {
                lineChart.data.datasets[idx].data.push(pct);
            });
            if (lineChart.data.labels.length > 50) {
                lineChart.data.labels.shift();
                lineChart.data.datasets.forEach(d => d.data.shift());
            }
            lineChart.update();
        }
    }

    function updateStatsUI(msg) {
        document.getElementById('stepCount').innerText = totalSteps;
        document.getElementById('eventStatus').innerText = msg;
    }
	
	
	// --- –í–°–¢–ê–í–ò–¢–ò –í –ö–Ü–ù–¶–Ü –°–ö–†–ò–ü–¢–ê ---
    
    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ —Å–ø–æ–π–ª–µ—Ä —ñ –∫–Ω–æ–ø–∫—É
    const spoiler = document.querySelector('details');
    const buildBtn = document.querySelector('.btn-apply');

    // –ö–æ–ª–∏ —Å–ø–æ–π–ª–µ—Ä –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è...
    spoiler.addEventListener('toggle', function() {
        // –ß–µ–∫–∞—î–º–æ 300–º—Å, –ø–æ–∫–∏ "—Ä–æ–∑'—ó–¥—É—Ç—å—Å—è" –±–ª–æ–∫–∏
        setTimeout(function() {
            // –ù–∞—Ç–∏—Å–∫–∞—î–º–æ –∫–Ω–æ–ø–∫—É –ø—Ä–æ–≥—Ä–∞–º–Ω–æ
            buildBtn.click();
        }, 300);
    });
</script>
</body>
</html>